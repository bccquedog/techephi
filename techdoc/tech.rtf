{\rtf1\ansi\ansicpg1252\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 HelveticaNeue;}
{\colortbl;\red255\green255\blue255;\red255\green255\blue255;\red31\green31\blue31;}
{\*\expandedcolortbl;;\cssrgb\c100000\c100000\c100000;\cssrgb\c16471\c16471\c16471\c32941;}
\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\fs24 \cf2 \cb3 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 // Enhanced Firebase Service with Technical Improvements\
class FirebaseService \{\
  constructor() \{\
    this.currentUser = null;\
    this.isAuthenticated = false;\
    this.dataManager = dataManager;\
    this.errorHandler = errorHandler;\
  \}\
\
  // Enhanced authentication with error handling\
  async signInWithEmailAndPassword(email, password) \{\
    try \{\
      loadingManager.setLoading('auth', true, 'Signing in...');\
      \
      // Simulate API call delay\
      await new Promise(resolve => setTimeout(resolve, 1000));\
      \
      if (email && password) \{\
        const user = \{\
          uid: Math.random().toString(36).substr(2, 9),\
          email: email,\
          displayName: email.split('@')[0],\
          role: this.determineRole(email)\
        \};\
        \
        this.currentUser = user;\
        this.isAuthenticated = true;\
        \
        // Persist auth state\
        this.dataManager.setItem('currentUser', user);\
        \
        return \{ user \};\
      \}\
      \
      throw new Error('Invalid email or password');\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'signIn', email \});\
      throw error;\
    \} finally \{\
      loadingManager.setLoading('auth', false);\
    \}\
  \}\
\
  async createUserWithEmailAndPassword(email, password, role = 'client') \{\
    try \{\
      loadingManager.setLoading('auth', true, 'Creating account...');\
      \
      await new Promise(resolve => setTimeout(resolve, 1000));\
      \
      const user = \{\
        uid: Math.random().toString(36).substr(2, 9),\
        email: email,\
        displayName: email.split('@')[0],\
        role: role\
      \};\
      \
      // Save user profile\
      await this.setUserProfile(user.uid, \{\
        email: user.email,\
        displayName: user.displayName,\
        role: user.role,\
        createdAt: new Date().toISOString()\
      \});\
      \
      this.currentUser = user;\
      this.isAuthenticated = true;\
      \
      // Persist auth state\
      this.dataManager.setItem('currentUser', user);\
      \
      return \{ user \};\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'createUser', email, role \});\
      throw error;\
    \} finally \{\
      loadingManager.setLoading('auth', false);\
    \}\
  \}\
\
  async signOut() \{\
    try \{\
      this.currentUser = null;\
      this.isAuthenticated = false;\
      this.dataManager.setItem('currentUser', null);\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'signOut' \});\
      throw error;\
    \}\
  \}\
\
  // Enhanced data operations with caching and error handling\
  async setUserProfile(uid, data) \{\
    try \{\
      const profiles = this.dataManager.getItem('userProfiles') || \{\};\
      profiles[uid] = data;\
      this.dataManager.setItem('userProfiles', profiles);\
      return data;\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'setUserProfile', uid \});\
      throw error;\
    \}\
  \}\
\
  async getUserProfile(uid) \{\
    try \{\
      const profiles = this.dataManager.getItem('userProfiles') || \{\};\
      return profiles[uid] || null;\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'getUserProfile', uid \});\
      return null;\
    \}\
  \}\
\
  async getJobs() \{\
    try \{\
      const jobs = this.dataManager.getItem('jobs');\
      if (jobs) return jobs;\
\
      // Initialize with default data if empty\
      const defaultJobs = await this.initializeDefaultJobs();\
      this.dataManager.setItem('jobs', defaultJobs);\
      return defaultJobs;\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'getJobs' \});\
      return [];\
    \}\
  \}\
\
  async createJob(jobData) \{\
    try \{\
      const jobs = await this.getJobs();\
      const newJob = \{\
        ...jobData,\
        id: Math.max(...jobs.map(j => j.id), 0) + 1,\
        createdAt: new Date().toISOString(),\
        status: 'pending',\
        progress: 0\
      \};\
      \
      jobs.push(newJob);\
      this.dataManager.setItem('jobs', jobs);\
      return newJob;\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'createJob', jobData \});\
      throw error;\
    \}\
  \}\
\
  // Enhanced operations with consistent error handling pattern\
  async getInvoices() \{\
    try \{\
      const invoices = this.dataManager.getItem('invoices');\
      if (invoices) return invoices;\
\
      const defaultInvoices = await this.initializeDefaultInvoices();\
      this.dataManager.setItem('invoices', defaultInvoices);\
      return defaultInvoices;\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'getInvoices' \});\
      return [];\
    \}\
  \}\
\
  async getClients() \{\
    try \{\
      const clients = this.dataManager.getItem('clients');\
      if (clients) return clients;\
\
      const defaultClients = await this.initializeDefaultClients();\
      this.dataManager.setItem('clients', defaultClients);\
      return defaultClients;\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'getClients' \});\
      return [];\
    \}\
  \}\
\
  async getContractors() \{\
    try \{\
      const contractors = this.dataManager.getItem('contractors');\
      if (contractors) return contractors;\
\
      const defaultContractors = await this.initializeDefaultContractors();\
      this.dataManager.setItem('contractors', defaultContractors);\
      return defaultContractors;\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'getContractors' \});\
      return [];\
    \}\
  \}\
\
  // Initialize default data with better error handling\
  async initializeDefaultJobs() \{\
    return [\
      \{\
        id: 1,\
        title: 'Network Infrastructure Setup',\
        description: 'Complete network overhaul for small office',\
        status: 'in-progress',\
        priority: 'high',\
        client: 'Acme Corp',\
        clientEmail: 'client@acme.com',\
        contractor: 'John Smith',\
        contractorEmail: 'john@techephi.com',\
        dueDate: '2025-08-15',\
        createdAt: '2025-08-01',\
        value: 8500,\
        estimatedHours: 40,\
        progress: 35\
      \},\
      \{\
        id: 3,\
        title: 'Security Audit',\
        description: 'Comprehensive security assessment and penetration testing',\
        status: 'completed',\
        priority: 'high',\
        client: 'Finance Pro LLC',\
        clientEmail: 'security@financepro.com',\
        contractor: 'Sarah Johnson',\
        contractorEmail: 'sarah@techephi.com',\
        dueDate: '2025-08-05',\
        createdAt: '2025-07-20',\
        value: 12000,\
        estimatedHours: 60,\
        progress: 100\
      \}\
    ];\
  \}\
\
  async initializeDefaultInvoices() \{\
    return [\
      \{\
        id: 'INV-001',\
        invoiceNumber: 'INV-2025-001',\
        jobId: 3,\
        jobTitle: 'Security Audit',\
        clientEmail: 'security@financepro.com',\
        clientName: 'Finance Pro LLC',\
        amount: 12000,\
        taxAmount: 960,\
        totalAmount: 12960,\
        status: 'paid',\
        dueDate: '2025-08-20',\
        paidDate: '2025-08-18',\
        createdAt: '2025-08-05',\
        items: [\
          \{ description: 'Security Assessment', quantity: 1, rate: 8000, amount: 8000 \},\
          \{ description: 'Penetration Testing', quantity: 1, rate: 4000, amount: 4000 \}\
        ],\
        notes: 'Payment received via bank transfer. Thank you for your business.'\
      \}\
    ];\
  \}\
\
  async initializeDefaultClients() \{\
    return [\
      \{\
        id: 1,\
        name: 'Acme Corporation',\
        email: 'client@acme.com',\
        phone: '+1 (555) 123-4567',\
        address: '123 Business Ave, Suite 100',\
        totalJobs: 5,\
        activeJobs: 2,\
        totalSpent: 45000\
      \},\
      \{\
        id: 2,\
        name: 'Tech Solutions Inc',\
        email: 'admin@techsolutions.com',\
        phone: '+1 (555) 987-6543',\
        address: '456 Innovation Drive',\
        totalJobs: 8,\
        activeJobs: 1,\
        totalSpent: 23500\
  \}\
\
  async initializeDefaultContractors() \{\
    return [\
      \{\
        id: 1,\
        name: 'John Smith',\
        email: 'john@techephi.com',\
        phone: '+1 (555) 111-2222',\
        specialties: ['Network Security', 'Infrastructure'],\
        activeJobs: 3,\
        completedJobs: 15,\
        rating: 4.8\
      \},\
      \{\
        id: 2,\
        name: 'Sarah Johnson',\
        email: 'sarah@techephi.com',\
        phone: '+1 (555) 333-4444',\
        specialties: ['Cybersecurity', 'Penetration Testing'],\
        activeJobs: 2,\
        completedJobs: 22,\
        rating: 4.9\
      \}\
    ];\
  \}\
\
  determineRole(email) \{\
    if (email.includes('admin') || email.includes('@techephi.com')) \{\
      return 'admin';\
    \} else if (email.includes('contractor') || email.includes('john@') || email.includes('sarah@')) \{\
      return 'contractor';\
    \}\
    return 'client';\
  \}\
\
  onAuthStateChanged(callback) \{\
    try \{\
      // Simulate auth state persistence\
      const savedUser = this.dataManager.getItem('currentUser');\
      if (savedUser) \{\
        this.currentUser = savedUser;\
        this.isAuthenticated = true;\
        callback(savedUser);\
      \} else \{\
        callback(null);\
      \}\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'onAuthStateChanged' \});\
      callback(null);\
    \}\
  \}\
\
  // Task Management Methods\
  async getTasks(jobId) \{\
    try \{\
      const tasks = this.dataManager.getItem(`tasks_$\{jobId\}`) || [];\
      return tasks;\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'getTasks', jobId \});\
      return [];\
    \}\
  \}\
\
  async createTask(jobId, taskData) \{\
    try \{\
      const tasks = await this.getTasks(jobId);\
      const newTask = \{\
        id: Math.random().toString(36).substr(2, 9),\
        jobId,\
        ...taskData,\
        createdAt: new Date().toISOString(),\
        status: 'pending',\
        progress: 0,\
        timeEntries: [],\
        approvals: [],\
        dependencies: []\
      \};\
\
      tasks.push(newTask);\
      this.dataManager.setItem(`tasks_$\{jobId\}`, tasks);\
      return newTask;\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'createTask', jobId, taskData \});\
      throw error;\
    \}\
  \}\
\
  async updateTask(jobId, taskId, updates) \{\
    try \{\
      const tasks = await this.getTasks(jobId);\
      const taskIndex = tasks.findIndex(task => task.id === taskId);\
      \
      if (taskIndex !== -1) \{\
        tasks[taskIndex] = \{ ...tasks[taskIndex], ...updates, updatedAt: new Date().toISOString() \};\
        this.dataManager.setItem(`tasks_$\{jobId\}`, tasks);\
        \
        // Update job progress when task is updated\
        await this.updateJobProgress(jobId);\
        \
        return tasks[taskIndex];\
      \}\
      return null;\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'updateTask', jobId, taskId, updates \});\
      throw error;\
    \}\
  \}\
\
  async createNotification(userEmail, notification) \{\
    try \{\
      const notifications = await this.getNotifications(userEmail);\
      const newNotification = \{\
        id: Math.random().toString(36).substr(2, 9),\
        ...notification,\
        timestamp: new Date().toISOString(),\
        read: false,\
        deliveryStatus: \{\
          browser: false,\
          email: false,\
          sms: false\
        \}\
      \};\
      \
      notifications.unshift(newNotification);\
      this.dataManager.setItem(`notifications_$\{userEmail\}`, notifications);\
      \
      // Get user preferences for this notification type\
      const preferences = await this.getNotificationPreferences(userEmail);\
      \
      // Send notifications based on preferences and urgency\
      await this.sendMultiChannelNotification(userEmail, newNotification, preferences);\
      \
      return newNotification;\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'createNotification', userEmail, notification \});\
      throw error;\
    \}\
  \}\
\
  async markNotificationAsRead(userEmail, notificationId) \{\
    try \{\
      const notifications = await this.getNotifications(userEmail);\
      const notification = notifications.find(n => n.id === notificationId);\
      if (notification) \{\
        notification.read = true;\
        this.dataManager.setItem(`notifications_$\{userEmail\}`, notifications);\
      \}\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'markNotificationAsRead', userEmail, notificationId \});\
    \}\
  \}\
\
  async markAllNotificationsAsRead(userEmail) \{\
    try \{\
      const notifications = await this.getNotifications(userEmail);\
      notifications.forEach(n => n.read = true);\
      this.dataManager.setItem(`notifications_$\{userEmail\}`, notifications);\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'markAllNotificationsAsRead', userEmail \});\
    \}\
  \}\
\
  async sendMultiChannelNotification(userEmail, notification, preferences) \{\
    // Mock implementation - in production this would integrate with real services\
    console.log('Sending multi-channel notification:', \{ userEmail, notification, preferences \});\
    return true;\
  \}\
\
  async getNotificationPreferences(userEmail) \{\
    try \{\
      const defaultPreferences = \{\
        browser: \{ message: true, invoice: true, job: true \},\
        email: \{ message: false, invoice: true, job: true \},\
        sms: \{ message: false, invoice: false, job: false \}\
      \};\
      \
      const saved = this.dataManager.getItem(`notificationPrefs_$\{userEmail\}`);\
      return saved || defaultPreferences;\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'getNotificationPreferences', userEmail \});\
      return \{\
        browser: \{ message: true, invoice: true, job: true \},\
        email: \{ message: false, invoice: true, job: true \},\
        sms: \{ message: false, invoice: false, job: false \}\
      \};\
    \}\
  \}\
\
  async updateNotificationPreferences(userEmail, preferences) \{\
    try \{\
      this.dataManager.setItem(`notificationPrefs_$\{userEmail\}`, preferences);\
      return preferences;\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'updateNotificationPreferences', userEmail \});\
      throw error;\
    \}\
  \}\
\
  // Initialize default projects and other methods\
  async initializeDefaultProjects() \{\
    try \{\
      const jobs = await this.getJobs();\
      \
      for (const job of jobs.slice(0, 2)) \{\
        const existingTasks = await this.getTasks(job.id);\
        \
        if (existingTasks.length === 0) \{\
          const sampleTasks = this.generateSampleTasks(job);\
          \
          for (const taskData of sampleTasks) \{\
            await this.createTask(job.id, taskData);\
          \}\
        \}\
      \}\
    \} catch (error) \{\
      this.errorHandler.logError(error, \{ operation: 'initializeDefaultProjects' \});\
    \}\
  \}\
\
  generateSampleTasks(job) \{\
    const taskTemplates = \{\
      'Network Infrastructure Setup': [\
        \{\
          title: 'Site Survey and Assessment',\
          description: 'Conduct thorough site survey and current network assessment',\
          assignedTo: 'john@techephi.com',\
          estimatedHours: 8,\
          priority: 'high',\
          weight: 2,\
          progress: 100,\
          status: 'completed'\
        \},\
        \{\
          title: 'Equipment Procurement',\
          description: 'Order and receive all necessary network equipment',\
          assignedTo: 'admin@techephi.com',\
          estimatedHours: 4,\
          priority: 'medium',\
          weight: 1,\
          progress: 75,\
          status: 'in-progress'\
        \}\
      ]\
    \};\
\
    return taskTemplates[job.title] || [\
      \{\
        title: 'Initial Planning',\
        description: 'Project planning and requirements gathering',\
        assignedTo: job.contractorEmail || 'john@techephi.com',\
        estimatedHours: 4,\
        priority: 'medium',\
        weight: 1,\
        progress: 50,\
        status: 'in-progress'\
      \}\
    ];\
  \}\
\
  calculateJobProgress(job, events) \{\
    const completedEvents = events.filter(e => e.status === 'completed').length;\
    const totalEvents = events.length || 1;\
    const baseProgress = (completedEvents / totalEvents) * 80;\
    \
    const statusProgress = \{\
      'pending': 0,\
      'in-progress': 20,\
      'completed': 100,\
      'cancelled': 0\
    \};\
\
    return Math.min(100, baseProgress + statusProgress[job.status]);\
  \}\
\}\
\}\
\
// Enhanced UI Components with Better UX\
\
// Responsive Container Component\
const ResponsiveContainer = (\{ children, className = '', maxWidth = '7xl' \}) => \{\
  const \{ isMobile, isTablet \} = useResponsive();\
  \
  const maxWidths = \{\
    'sm': 'max-w-sm',\
    'md': 'max-w-md',\
    'lg': 'max-w-lg',\
    'xl': 'max-w-xl',\
    '2xl': 'max-w-2xl',\
    '3xl': 'max-w-3xl',\
    '4xl': 'max-w-4xl',\
    '5xl': 'max-w-5xl',\
    '6xl': 'max-w-6xl',\
    '7xl': 'max-w-7xl'\
  \};\
\
  const padding = isMobile ? 'px-4' : isTablet ? 'px-6' : 'px-8';\
\
  return (\
    <div className=\{`mx-auto $\{maxWidths[maxWidth]\} $\{padding\} $\{className\}`\}>\
      \{children\}\
    </div>\
  );\
\};\
\
// Enhanced Loading States Component\
const DataLoader = (\{ \
  loading, \
  error, \
  data, \
  children, \
  loadingComponent, \
  errorComponent,\
  emptyComponent,\
  retryAction \
\}) => \{\
  if (loading) \{\
    return loadingComponent || (\
      <div className="flex items-center justify-center h-64">\
        <LoadingSpinner size="lg" message="Loading data..." />\
      </div>\
    );\
  \}\
\
  if (error) \{\
    return errorComponent || (\
      <div className="flex items-center justify-center h-64">\
        <div className="text-center">\
          <AlertCircle className="w-12 h-12 text-red-500 mx-auto mb-4" />\
          <h3 className="text-lg font-semibold text-gray-900 mb-2">Something went wrong</h3>\
          <p className="text-gray-600 mb-4">\{error.message || 'Failed to load data'\}</p>\
          \{retryAction && (\
            <Button onClick=\{retryAction\} variant="secondary">\
              Try Again\
            </Button>\
          )\}\
        </div>\
      </div>\
    );\
  \}\
\
  if (!data || (Array.isArray(data) && data.length === 0)) \{\
    return emptyComponent || (\
      <div className="text-center py-12">\
        <div className="text-gray-400 mb-4">\
          <svg className="w-12 h-12 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">\
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth=\{1\} d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2 2v-5m16 0h-2M4 13h2m13-8l-4-4m0 0L9 5m6-6v4" />\
          </svg>\
        </div>\
        <h3 className="text-lg font-medium text-gray-900 mb-2">No data available</h3>\
        <p className="text-gray-600">There's nothing to display at the moment.</p>\
      </div>\
    );\
  \}\
\
  return children;\
\};\
\
// Enhanced Form Components with Better Validation\
const FormField = (\{ \
  label, \
  error, \
  required, \
  children, \
  helpText,\
  className = '' \
\}) => \{\
  return (\
    <div className=\{`space-y-1 $\{className\}`\}>\
      \{label && (\
        <label className="block text-sm font-medium text-gray-700">\
          \{label\}\
          \{required && <span className="text-red-500 ml-1">*</span>\}\
        </label>\
      )\}\
      \{children\}\
      \{helpText && !error && (\
        <p className="text-xs text-gray-500">\{helpText\}</p>\
      )\}\
      \{error && (\
        <p className="text-xs text-red-600 flex items-center gap-1">\
          <AlertCircle className="w-3 h-3" />\
          \{error\}\
        </p>\
      )\}\
    </div>\
  );\
\};\
\
// Enhanced Input with better states\
const Input = React.forwardRef((\{ \
  className = '', \
  error, \
  loading, \
  icon: Icon,\
  rightIcon: RightIcon,\
  ...props \
\}, ref) => \{\
  const baseClasses = "w-full px-3 py-2 border rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed";\
  const errorClasses = error ? "border-red-300 focus:ring-red-500" : "border-gray-300";\
  const iconPadding = Icon ? "pl-10" : "";\
  const rightIconPadding = RightIcon ? "pr-10" : "";\
\
  return (\
    <div className="relative">\
      \{Icon && (\
        <Icon className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />\
      )\}\
      <input\
        ref=\{ref\}\
        className=\{`$\{baseClasses\} $\{errorClasses\} $\{iconPadding\} $\{rightIconPadding\} $\{className\}`\}\
        \{...props\}\
      />\
      \{RightIcon && (\
        <RightIcon className="absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />\
      )\}\
      \{loading && (\
        <div className="absolute right-3 top-1/2 transform -translate-y-1/2">\
          <LoadingSpinner size="sm" />\
        </div>\
      )\}\
    </div>\
  );\
\});\
\
// Enhanced Modal with better responsive behavior\
const EnhancedModal = (\{ \
  isOpen, \
  onClose, \
  title, \
  children, \
  size = 'md',\
  closeOnOverlayClick = true,\
  showCloseButton = true\
\}) => \{\
  const \{ isMobile \} = useResponsive();\
  \
  const sizes = \{\
    sm: 'max-w-md',\
    md: 'max-w-lg',\
    lg: 'max-w-2xl',\
    xl: 'max-w-4xl',\
    full: 'max-w-7xl'\
  \};\
\
  const mobileClasses = isMobile ? 'mx-4 max-h-[90vh] overflow-y-auto' : 'mx-auto';\
\
  useEffect(() => \{\
    if (isOpen) \{\
      document.body.style.overflow = 'hidden';\
    \} else \{\
      document.body.style.overflow = 'unset';\
    \}\
\
    return () => \{\
      document.body.style.overflow = 'unset';\
    \};\
  \}, [isOpen]);\
\
  if (!isOpen) return null;\
\
  return (\
    <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">\
      <div \
        className="fixed inset-0" \
        onClick=\{closeOnOverlayClick ? onClose : undefined\}\
      />\
      <div className=\{`bg-white rounded-xl $\{sizes[size]\} w-full $\{mobileClasses\} relative z-10`\}>\
        \{(title || showCloseButton) && (\
          <div className="flex items-center justify-between p-6 border-b border-gray-200">\
            \{title && <h2 className="text-lg font-semibold text-gray-900">\{title\}</h2>\}\
            \{showCloseButton && (\
              <button\
                onClick=\{onClose\}\
                className="text-gray-400 hover:text-gray-600 transition-colors"\
              >\
                <X className="w-5 h-5" />\
              </button>\
            )\}\
          </div>\
        )\}\
        <div className="p-6">\
          \{children\}\
        </div>\
      </div>\
    </div>\
  );\
\};\
\
// Enhanced Table Component\
const Table = (\{ columns, data, loading, emptyMessage = "No data available" \}) => \{\
  const \{ isMobile \} = useResponsive();\
\
  if (loading) \{\
    return (\
      <div className="bg-white rounded-lg border border-gray-200 p-8">\
        <LoadingSpinner size="lg" message="Loading table data..." />\
      </div>\
    );\
  \}\
\
  if (isMobile) \{\
    // Mobile card view\
    return (\
      <div className="space-y-4">\
        \{data.map((row, index) => (\
          <Card key=\{index\} className="p-4">\
            \{columns.map((column) => (\
              <div key=\{column.key\} className="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">\
                <span className="text-sm font-medium text-gray-600">\{column.label\}</span>\
                <span className="text-sm text-gray-900">\
                  \{column.render ? column.render(row[column.key], row) : row[column.key]\}\
                </span>\
              </div>\
            ))\}\
          </Card>\
        ))\}\
        \{data.length === 0 && (\
          <div className="text-center py-8 text-gray-500">\
            \{emptyMessage\}\
          </div>\
        )\}\
      </div>\
    );\
  \}\
\
  // Desktop table view\
  return (\
    <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">\
      <div className="overflow-x-auto">\
        <table className="w-full">\
          <thead className="bg-gray-50 border-b border-gray-200">\
            <tr>\
              \{columns.map((column) => (\
                <th key=\{column.key\} className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">\
                  \{column.label\}\
                </th>\
              ))\}\
            </tr>\
          </thead>\
          <tbody className="divide-y divide-gray-200">\
            \{data.map((row, index) => (\
              <tr key=\{index\} className="hover:bg-gray-50">\
                \{columns.map((column) => (\
                  <td key=\{column.key\} className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">\
                    \{column.render ? column.render(row[column.key], row) : row[column.key]\}\
                  </td>\
                ))\}\
              </tr>\
            ))\}\
          </tbody>\
        </table>\
      </div>\
      \{data.length === 0 && (\
        <div className="text-center py-8 text-gray-500">\
          \{emptyMessage\}\
        </div>\
      )\}\
    </div>\
  );\
\};\
      \{\
        id: 2,\
        title: 'Server Maintenance',\
        description: 'Quarterly server maintenance and updates',\
        status: 'pending',\
        priority: 'medium',\
        client: 'Tech Solutions Inc',\
        clientEmail: 'admin@techsolutions.com',\
        contractor: null,\
        contractorEmail: null,\
        dueDate: '2025-08-10',\
        createdAt: '2025-07-28',\
        value: 2500,\
        estimatedHours: 8,\
        progress: 0\
      // Approvals Tab\
const ApprovalsTab = (\{ approvals, jobId, userRole, onUpdate \}) => \{\
  const [showCreateApproval, setShowCreateApproval] = useState(false);\
\
  const handleApprovalAction = async (approvalId, stageId, decision, comments) => \{\
    try \{\
      await firebase.processApproval(jobId, approvalId, stageId, decision, comments);\
      onUpdate();\
    \} catch (error) \{\
      console.error('Error processing approval:', error);\
    \}\
  \};\
\
  return (\
    <div className="space-y-6">\
      <div className="flex justify-between items-center">\
        <div>\
          <h3 className="text-lg font-semibold text-gray-900">Approval Workflows</h3>\
          <p className="text-gray-600">Multi-stage approvals for project milestones</p>\
        </div>\
        \{userRole === 'admin' && (\
          <Button onClick=\{() => setShowCreateApproval(true)\}>\
            <Plus className="w-4 h-4" />\
            Request Approval\
          </Button>\
        )\}\
      </div>\
\
      \{/* Approval Requests */\}\
      <div className="space-y-4">\
        \{approvals.map((approval) => (\
          <Card key=\{approval.id\} className="p-6">\
            <div className="flex items-start justify-between mb-4">\
              <div>\
                <h4 className="font-semibold text-gray-900">\{approval.title\}</h4>\
                <p className="text-gray-600 mt-1">\{approval.description\}</p>\
                <div className="flex items-center gap-2 mt-2">\
                  <Badge variant=\{getStatusColor(approval.status)\}>\{approval.status\}</Badge>\
                  <span className="text-sm text-gray-500">\
                    Created \{new Date(approval.createdAt).toLocaleDateString()\}\
                  </span>\
                </div>\
              </div>\
            </div>\
\
            \{/* Approval Stages */\}\
            <div className="space-y-3">\
              <h5 className="font-medium text-gray-900">Approval Stages</h5>\
              \{approval.stages.map((stage, index) => (\
                <div key=\{stage.id\} className="flex items-center gap-4 p-3 bg-gray-50 rounded-lg">\
                  <div className=\{`w-8 h-8 rounded-full flex items-center justify-center $\{\
                    stage.status === 'approved' ? 'bg-green-500 text-white' :\
                    stage.status === 'rejected' ? 'bg-red-500 text-white' :\
                    stage.status === 'pending' ? 'bg-blue-500 text-white' : 'bg-gray-300 text-gray-600'\
                  \}`\}>\
                    \{index + 1\}\
                  </div>\
                  \
                  <div className="flex-1">\
                    <div className="flex items-center justify-between">\
                      <div>\
                        <p className="font-medium text-gray-900">\{stage.title\}</p>\
                        <p className="text-sm text-gray-600">Approver: \{stage.approverEmail\}</p>\
                      </div>\
                      <Badge variant=\{getStatusColor(stage.status)\}>\{stage.status\}</Badge>\
                    </div>\
                    \
                    \{stage.comments && (\
                      <p className="text-sm text-gray-600 mt-1 italic">"\{stage.comments\}"</p>\
                    )\}\
                    \
                    \{stage.approvedAt && (\
                      <p className="text-xs text-gray-500 mt-1">\
                        \{stage.status\} on \{new Date(stage.approvedAt).toLocaleDateString()\}\
                      </p>\
                    )\}\
                  </div>\
\
                  \{/* Approval Actions */\}\
                  \{stage.status === 'pending' && stage.approverEmail === user?.email && (\
                    <div className="flex items-center gap-2">\
                      <ApprovalActionModal\
                        stage=\{stage\}\
                        onApprove=\{(comments) => handleApprovalAction(approval.id, stage.id, 'approved', comments)\}\
                        onReject=\{(comments) => handleApprovalAction(approval.id, stage.id, 'rejected', comments)\}\
                      />\
                    </div>\
                  )\}\
                </div>\
              ))\}\
            </div>\
          </Card>\
        ))\}\
      </div>\
\
      \{approvals.length === 0 && (\
        <Card className="p-12 text-center">\
          <CheckCircle className="w-12 h-12 text-gray-400 mx-auto mb-4" />\
          <h3 className="text-lg font-medium text-gray-900 mb-2">No approval requests</h3>\
          <p className="text-gray-600 mb-4">Create approval workflows for important project decisions</p>\
          \{userRole === 'admin' && (\
            <Button onClick=\{() => setShowCreateApproval(true)\}>\
              <Plus className="w-4 h-4" />\
              Create First Approval\
            </Button>\
          )\}\
        </Card>\
      )\}\
    </div>\
  );\
\};\
\
// Modal Components\
const TaskModal = (\{ isOpen, onClose, task, onSubmit, jobId \}) => \{\
  const [formData, setFormData] = useState(\{\
    title: '',\
    description: '',\
    assignedTo: '',\
    estimatedHours: '',\
    priority: 'medium',\
    weight: 1,\
    dependencies: []\
  \});\
  const [contractors, setContractors] = useState([]);\
\
  useEffect(() => \{\
    if (isOpen) \{\
      loadContractors();\
      if (task) \{\
        setFormData(\{\
          title: task.title || '',\
          description: task.description || '',\
          assignedTo: task.assignedTo || '',\
          estimatedHours: task.estimatedHours || '',\
          priority: task.priority || 'medium',\
          weight: task.weight || 1,\
          dependencies: task.dependencies || []\
        \});\
      \}\
    \}\
  \}, [isOpen, task]);\
\
  const loadContractors = async () => \{\
    try \{\
      const contractorsData = await firebase.getContractors();\
      setContractors(contractorsData);\
    \} catch (error) \{\
      console.error('Error loading contractors:', error);\
    \}\
  \};\
\
  const handleSubmit = (e) => \{\
    e.preventDefault();\
    if (task) \{\
      onSubmit(task.id, formData);\
    \} else \{\
      onSubmit(formData);\
    \}\
    onClose();\
  \};\
\
  return (\
    <Modal isOpen=\{isOpen\} onClose=\{onClose\} title=\{task ? 'Edit Task' : 'Create New Task'\}>\
      <form onSubmit=\{handleSubmit\} className="space-y-4">\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">Title</label>\
          <input\
            type="text"\
            value=\{formData.title\}\
            onChange=\{(e) => setFormData(prev => (\{ ...prev, title: e.target.value \}))\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            required\
          />\
        </div>\
\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>\
          <textarea\
            value=\{formData.description\}\
            onChange=\{(e) => setFormData(prev => (\{ ...prev, description: e.target.value \}))\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            rows=\{3\}\
            required\
          />\
        </div>\
\
        <div className="grid grid-cols-2 gap-4">\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">Assigned To</label>\
            <select\
              value=\{formData.assignedTo\}\
              onChange=\{(e) => setFormData(prev => (\{ ...prev, assignedTo: e.target.value \}))\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              required\
            >\
              <option value="">Select contractor</option>\
              \{contractors.map(contractor => (\
                <option key=\{contractor.id\} value=\{contractor.email\}>\{contractor.name\}</option>\
              ))\}\
            </select>\
          </div>\
\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">Priority</label>\
            <select\
              value=\{formData.priority\}\
              onChange=\{(e) => setFormData(prev => (\{ ...prev, priority: e.target.value \}))\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            >\
              <option value="low">Low</option>\
              <option value="medium">Medium</option>\
              <option value="high">High</option>\
            </select>\
          </div>\
        </div>\
\
        <div className="grid grid-cols-2 gap-4">\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">Estimated Hours</label>\
            <input\
              type="number"\
              value=\{formData.estimatedHours\}\
              onChange=\{(e) => setFormData(prev => (\{ ...prev, estimatedHours: parseInt(e.target.value) \}))\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              min="1"\
              required\
            />\
          </div>\
\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">Weight</label>\
            <input\
              type="number"\
              value=\{formData.weight\}\
              onChange=\{(e) => setFormData(prev => (\{ ...prev, weight: parseInt(e.target.value) \}))\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              min="1"\
              max="10"\
              required\
            />\
          </div>\
        </div>\
\
        <div className="flex gap-3 pt-4">\
          <Button type="submit" className="flex-1">\
            \{task ? 'Update' : 'Create'\} Task\
          </Button>\
          <Button type="button" variant="secondary" onClick=\{onClose\}>\
            Cancel\
          </Button>\
        </div>\
      </form>\
    </Modal>\
  );\
\};\
\
const TimeEntryModal = (\{ isOpen, onClose, task, tasks, onSubmit \}) => \{\
  const \{ user \} = useAuth();\
  const [formData, setFormData] = useState(\{\
    taskId: '',\
    date: new Date().toISOString().split('T')[0],\
    hours: '',\
    description: '',\
    contractor: user?.email || ''\
  \});\
\
  useEffect(() => \{\
    if (isOpen && task) \{\
      setFormData(prev => (\{ ...prev, taskId: task.id \}));\
    \}\
  \}, [isOpen, task]);\
\
  const handleSubmit = (e) => \{\
    e.preventDefault();\
    onSubmit(formData);\
    onClose();\
    setFormData(\{\
      taskId: '',\
      date: new Date().toISOString().split('T')[0],\
      hours: '',\
      description: '',\
      contractor: user?.email || ''\
    \});\
  \};\
\
  return (\
    <Modal isOpen=\{isOpen\} onClose=\{onClose\} title="Log Time Entry">\
      <form onSubmit=\{handleSubmit\} className="space-y-4">\
        <div>\
          <select\
            value=\{formData.taskId\}\
            onChange=\{(e) => setFormData(prev => (\{ ...prev, taskId: e.target.value \}))\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            required\
          >\
            <option value="">Select task</option>\
            \{tasks.map(task => (\
              <option key=\{task.id\} value=\{task.id\}>\{task.title\}</option>\
            ))\}\
          </select>\
        </div>\
\
        <div className="grid grid-cols-2 gap-4">\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">Date</label>\
            <input\
              type="date"\
              value=\{formData.date\}\
              onChange=\{(e) => setFormData(prev => (\{ ...prev, date: e.target.value \}))\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              required\
            />\
          </div>\
\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">Hours</label>\
            <input\
              type="number"\
              step="0.25"\
              value=\{formData.hours\}\
              onChange=\{(e) => setFormData(prev => (\{ ...prev, hours: parseFloat(e.target.value) \}))\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              min="0.25"\
              max="24"\
              required\
            />\
          </div>\
        </div>\
\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>\
          <textarea\
            value=\{formData.description\}\
            onChange=\{(e) => setFormData(prev => (\{ ...prev, description: e.target.value \}))\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            rows=\{3\}\
            placeholder="What did you work on?"\
            required\
          />\
        </div>\
\
        <div className="flex gap-3 pt-4">\
          <Button type="submit" className="flex-1">\
            Log Time\
          </Button>\
          <Button type="button" variant="secondary" onClick=\{onClose\}>\
            Cancel\
          </Button>\
        </div>\
      </form>\
    </Modal>\
  );\
\};\
\
const ApprovalActionModal = (\{ stage, onApprove, onReject \}) => \{\
  const [isOpen, setIsOpen] = useState(false);\
  const [action, setAction] = useState('');\
  const [comments, setComments] = useState('');\
\
  const handleSubmit = (e) => \{\
    e.preventDefault();\
    if (action === 'approve') \{\
      onApprove(comments);\
    \} else if (action === 'reject') \{\
      onReject(comments);\
    \}\
    setIsOpen(false);\
    setComments('');\
    setAction('');\
  \};\
\
  return (\
    <>\
      <Button \
        size="sm" \
        onClick=\{() => \{\
          setAction('approve');\
          setIsOpen(true);\
        \}\}\
      >\
        Approve\
      </Button>\
      <Button \
        variant="danger" \
        size="sm"\
        onClick=\{() => \{\
          setAction('reject');\
          setIsOpen(true);\
        \}\}\
      >\
        Reject\
      </Button>\
\
      <Modal \
        isOpen=\{isOpen\} \
        onClose=\{() => setIsOpen(false)\} \
        title=\{`$\{action === 'approve' ? 'Approve' : 'Reject'\} $\{stage.title\}`\}\
      >\
        <form onSubmit=\{handleSubmit\} className="space-y-4">\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Comments \{action === 'reject' ? '(required)' : '(optional)'\}\
            </label>\
            <textarea\
              value=\{comments\}\
              onChange=\{(e) => setComments(e.target.value)\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              rows=\{3\}\
              placeholder=\{action === 'approve' ? 'Optional approval comments...' : 'Please explain why you are rejecting this request...'\}\
              required=\{action === 'reject'\}\
            />\
          </div>\
\
          <div className="flex gap-3 pt-4">\
            <Button \
              type="submit" \
              variant=\{action === 'approve' ? 'success' : 'danger'\}\
              className="flex-1"\
            >\
              \{action === 'approve' ? 'Approve' : 'Reject'\}\
            </Button>\
            <Button type="button" variant="secondary" onClick=\{() => setIsOpen(false)\}>\
              Cancel\
            </Button>\
          </div>\
        </form>\
      </Modal>\
    </>\
  );\
\};\
\
// Enhanced Jobs View with Project Management\
const EnhancedJobsView = () => \{\
  const \{ user \} = useAuth();\
  const [jobs, setJobs] = useState([]);\
  const [loading, setLoading] = useState(true);\
  const [showCreateJob, setShowCreateJob] = useState(false);\
  const [selectedJob, setSelectedJob] = useState(null);\
  const [showJobDetail, setShowJobDetail] = useState(false);\
\
  useEffect(() => \{\
    loadJobs();\
    initializeProjectData();\
  \}, [user]);\
\
  const initializeProjectData = async () => \{\
    await firebase.initializeDefaultProjects();\
  \};\
\
  const loadJobs = async () => \{\
    try \{\
      let jobsData = await firebase.getJobs();\
      \
      // Filter based on user role\
      if (user?.role === 'client') \{\
        jobsData = jobsData.filter(job => job.clientEmail === user?.email);\
      \} else if (user?.role === 'contractor') \{\
        jobsData = jobsData.filter(job => job.contractorEmail === user?.email);\
      \}\
      \
      // Load progress for each job\
      const jobsWithProgress = await Promise.all(\
        jobsData.map(async (job) => \{\
          const progress = await firebase.updateJobProgress(job.id);\
          return \{ ...job, progress \};\
        \})\
      );\
      \
      setJobs(jobsWithProgress);\
    \} catch (error) \{\
      console.error('Error loading jobs:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  const handleCreateJob = async (jobData) => \{\
    try \{\
      await firebase.createJob(jobData);\
      loadJobs();\
    \} catch (error) \{\
      console.error('Error creating job:', error);\
    \}\
  \};\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading jobs...</div>\
    </div>;\
  \}\
\
  return (\
    <div className="space-y-6">\
      \{/* Header */\}\
      <div className="flex justify-between items-center">\
        <div>\
          <h2 className="text-2xl font-bold text-gray-900">\
            \{user?.role === 'admin' ? 'Job Management' : \
             user?.role === 'contractor' ? 'Assigned Jobs' : 'My Jobs'\}\
          </h2>\
          <p className="text-gray-600">\
            \{user?.role === 'admin' ? 'Manage all client projects and assignments' :\
             user?.role === 'contractor' ? 'Track your assigned projects and tasks' :\
             'Monitor your project progress and milestones'\}\
          </p>\
        </div>\
        \{user?.role === 'admin' && (\
          <Button onClick=\{() => setShowCreateJob(true)\}>\
            <Plus className="w-4 h-4" />\
            Create Job\
          </Button>\
        )\}\
      </div>\
\
      \{/* Job Cards */\}\
      <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">\
        \{jobs.map((job) => (\
          <Card key=\{job.id\} className="p-6 cursor-pointer hover:shadow-lg transition-shadow">\
            <div className="flex items-start justify-between mb-4">\
              <div>\
                <h3 className="font-semibold text-gray-900 mb-1">\{job.title\}</h3>\
                <p className="text-sm text-gray-600 mb-2">\{job.description\}</p>\
                <div className="flex items-center gap-2">\
                  <Badge variant=\{getStatusColor(job.status)\}>\{job.status\}</Badge>\
                  <Badge variant=\{job.priority === 'high' ? 'danger' : job.priority === 'medium' ? 'warning' : 'default'\}>\
                    \{job.priority\} priority\
                  </Badge>\
                </div>\
              </div>\
              <Button \
                variant="ghost" \
                size="sm"\
                onClick=\{() => \{\
                  setSelectedJob(job.id);\
                  setShowJobDetail(true);\
                \}\}\
              >\
                <Eye className="w-4 h-4" />\
              </Button>\
            </div>\
\
            \{/* Progress Section */\}\
            <div className="mb-4">\
              <div className="flex items-center justify-between mb-2">\
                <span className="text-sm font-medium text-gray-700">Progress</span>\
                <span className="text-sm text-gray-600">\{job.progress || 0\}%</span>\
              </div>\
              <div className="w-full bg-gray-200 rounded-full h-2">\
                <div \
                  className="bg-[#3B0A69] h-2 rounded-full transition-all duration-300"\
                  style=\{\{ width: `$\{job.progress || 0\}%` \}\}\
                />\
              </div>\
            </div>\
\
            \{/* Job Details */\}\
            <div className="flex items-center justify-between text-sm text-gray-500">\
              <div className="flex items-center gap-4">\
                <div className="flex items-center gap-1">\
                  <User className="w-4 h-4" />\
                  <span>\{job.client\}</span>\
                </div>\
                <div className="flex items-center gap-1">\
                  <Calendar className="w-4 h-4" />\
                  <span>\{new Date(job.dueDate).toLocaleDateString()\}</span>\
                </div>\
              </div>\
              <div className="flex items-center gap-1">\
                <DollarSign className="w-4 h-4" />\
                <span>$\{job.value?.toLocaleString()\}</span>\
              </div>\
            </div>\
          </Card>\
        ))\}\
      </div>\
\
      \{jobs.length === 0 && (\
        <Card className="p-12 text-center">\
          <Briefcase className="w-12 h-12 text-gray-400 mx-auto mb-4" />\
          <h3 className="text-lg font-medium text-gray-900 mb-2">No jobs found</h3>\
          <p className="text-gray-600 mb-4">\
            \{user?.role === 'admin' \
              ? 'Create your first job to get started' \
              : 'No jobs assigned to you yet'\}\
          </p>\
          \{user?.role === 'admin' && (\
            <Button onClick=\{() => setShowCreateJob(true)\}>\
              <Plus className="w-4 h-4" />\
              Create First Job\
            </Button>\
          )\}\
        </Card>\
      )\}\
\
      \{/* Modals */\}\
      \{user?.role === 'admin' && (\
        <CreateJobModal \
          isOpen=\{showCreateJob\}\
          onClose=\{() => setShowCreateJob(false)\}\
          onSubmit=\{handleCreateJob\}\
        />\
      )\}\
\
      \{showJobDetail && (\
        <JobDetailView\
          jobId=\{selectedJob\}\
          onClose=\{() => \{\
            setShowJobDetail(false);\
            setSelectedJob(null);\
            loadJobs(); // Refresh jobs when closing detail view\
          \}\}\
        />\
      )\}\
    </div>\
  );\
\};// Enhanced Job Detail View with Task Management\
const JobDetailView = (\{ jobId, onClose \}) => \{\
  const \{ user \} = useAuth();\
  const [job, setJob] = useState(null);\
  const [tasks, setTasks] = useState([]);\
  const [milestones, setMilestones] = useState([]);\
  const [approvals, setApprovals] = useState([]);\
  const [activeTab, setActiveTab] = useState('overview');\
  const [loading, setLoading] = useState(true);\
  const [showTaskModal, setShowTaskModal] = useState(false);\
  const [showTimeModal, setShowTimeModal] = useState(false);\
  const [selectedTask, setSelectedTask] = useState(null);\
\
  useEffect(() => \{\
    loadJobDetails();\
  \}, [jobId]);\
\
  const loadJobDetails = async () => \{\
    try \{\
      const jobs = await firebase.getJobs();\
      const jobData = jobs.find(j => j.id === parseInt(jobId));\
      const [tasksData, milestonesData, approvalsData] = await Promise.all([\
        firebase.getTasks(jobId),\
        firebase.getMilestones(jobId),\
        firebase.getApprovals(jobId)\
      ]);\
\
      setJob(jobData);\
      setTasks(tasksData);\
      setMilestones(milestonesData);\
      setApprovals(approvalsData);\
    \} catch (error) \{\
      console.error('Error loading job details:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  const handleTaskUpdate = async (taskId, updates) => \{\
    try \{\
      await firebase.updateTask(jobId, taskId, updates);\
      loadJobDetails();\
    \} catch (error) \{\
      console.error('Error updating task:', error);\
    \}\
  \};\
\
  const handleCreateTask = async (taskData) => \{\
    try \{\
      await firebase.createTask(jobId, taskData);\
      loadJobDetails();\
    \} catch (error) \{\
      console.error('Error creating task:', error);\
    \}\
  \};\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading job details...</div>\
    </div>;\
  \}\
\
  if (!job) \{\
    return <div className="text-center text-gray-500">Job not found</div>;\
  \}\
\
  const getStatusColor = (status) => \{\
    switch (status) \{\
      case 'completed': return 'success';\
      case 'in-progress': return 'info';\
      case 'pending': return 'warning';\
      case 'blocked': return 'danger';\
      default: return 'default';\
    \}\
  \};\
\
  const calculateJobProgress = () => \{\
    if (tasks.length === 0) return 0;\
    const totalWeight = tasks.reduce((sum, task) => sum + (task.weight || 1), 0);\
    const completedWeight = tasks.reduce((sum, task) => \{\
      const weight = task.weight || 1;\
      const progress = task.progress || 0;\
      return sum + (weight * (progress / 100));\
    \}, 0);\
    return Math.round((completedWeight / totalWeight) * 100);\
  \};\
\
  const overallProgress = calculateJobProgress();\
\
  return (\
    <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">\
      <div className="bg-white rounded-xl max-w-6xl w-full max-h-[90vh] overflow-hidden">\
        \{/* Header */\}\
        <div className="flex items-center justify-between p-6 border-b border-gray-200">\
          <div>\
            <h2 className="text-2xl font-bold text-gray-900">\{job.title\}</h2>\
            <p className="text-gray-600">\{job.client\} \'95 Due: \{new Date(job.dueDate).toLocaleDateString()\}</p>\
          </div>\
          <div className="flex items-center gap-3">\
            <Badge variant=\{getStatusColor(job.status)\}>\{job.status\}</Badge>\
            <button onClick=\{onClose\} className="p-2 hover:bg-gray-100 rounded-lg">\
              <X className="w-5 h-5" />\
            </button>\
          </div>\
        </div>\
\
        \{/* Progress Bar */\}\
        <div className="p-6 border-b border-gray-200 bg-gray-50">\
          <div className="flex items-center justify-between mb-2">\
            <span className="text-sm font-medium text-gray-700">Overall Progress</span>\
            <span className="text-sm font-medium text-gray-900">\{overallProgress\}%</span>\
          </div>\
          <div className="w-full bg-gray-200 rounded-full h-3">\
            <div \
              className="bg-[#3B0A69] h-3 rounded-full transition-all duration-300"\
              style=\{\{ width: `$\{overallProgress\}%` \}\}\
            />\
          </div>\
        </div>\
\
        \{/* Tab Navigation */\}\
        <div className="border-b border-gray-200">\
          <nav className="flex space-x-8 px-6">\
            \{[\
              \{ id: 'overview', label: 'Overview', icon: BarChart3 \},\
              \{ id: 'tasks', label: `Tasks ($\{tasks.length\})`, icon: Briefcase \},\
              \{ id: 'milestones', label: `Milestones ($\{milestones.length\})`, icon: Calendar \},\
              \{ id: 'time', label: 'Time Tracking', icon: Clock \},\
              \{ id: 'approvals', label: `Approvals ($\{approvals.length\})`, icon: CheckCircle \}\
            ].map((tab) => (\
              <button\
                key=\{tab.id\}\
                onClick=\{() => setActiveTab(tab.id)\}\
                className=\{`py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 $\{\
                  activeTab === tab.id\
                    ? 'border-[#3B0A69] text-[#3B0A69]'\
                    : 'border-transparent text-gray-500 hover:text-gray-700'\
                \}`\}\
              >\
                <tab.icon className="w-4 h-4" />\
                \{tab.label\}\
              </button>\
            ))\}\
          </nav>\
        </div>\
\
        \{/* Tab Content */\}\
        <div className="flex-1 overflow-y-auto p-6">\
          \{activeTab === 'overview' && (\
            <JobOverviewTab job=\{job\} tasks=\{tasks\} milestones=\{milestones\} />\
          )\}\
          \
          \{activeTab === 'tasks' && (\
            <TasksTab \
              tasks=\{tasks\} \
              onTaskUpdate=\{handleTaskUpdate\}\
              onCreateTask=\{handleCreateTask\}\
              userRole=\{user?.role\}\
              jobId=\{jobId\}\
            />\
          )\}\
          \
          \{activeTab === 'milestones' && (\
            <MilestonesTab milestones=\{milestones\} jobId=\{jobId\} onUpdate=\{loadJobDetails\} />\
          )\}\
          \
          \{activeTab === 'time' && (\
            <TimeTrackingTab tasks=\{tasks\} jobId=\{jobId\} userRole=\{user?.role\} />\
          )\}\
          \
          \{activeTab === 'approvals' && (\
            <ApprovalsTab approvals=\{approvals\} jobId=\{jobId\} userRole=\{user?.role\} onUpdate=\{loadJobDetails\} />\
          )\}\
        </div>\
      </div>\
    </div>\
  );\
\};\
\
// Job Overview Tab\
const JobOverviewTab = (\{ job, tasks, milestones \}) => \{\
  const completedTasks = tasks.filter(t => t.status === 'completed').length;\
  const completedMilestones = milestones.filter(m => m.status === 'completed').length;\
  const totalTimeLogged = tasks.reduce((sum, task) => sum + (task.totalHours || 0), 0);\
\
  return (\
    <div className="space-y-6">\
      \{/* Key Metrics */\}\
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">\
        <MetricCard\
          title="Tasks Completed"\
          value=\{`$\{completedTasks\}/$\{tasks.length\}`\}\
          icon=\{Briefcase\}\
          color="blue"\
        />\
        <MetricCard\
          title="Milestones Hit"\
          value=\{`$\{completedMilestones\}/$\{milestones.length\}`\}\
          icon=\{Calendar\}\
          color="green"\
        />\
        <MetricCard\
          title="Time Logged"\
          value=\{`$\{totalTimeLogged\}h`\}\
          icon=\{Clock\}\
          color="purple"\
        />\
        <MetricCard\
          title="Project Value"\
          value=\{`$\{job.value?.toLocaleString()\}`\}\
          icon=\{DollarSign\}\
          color="yellow"\
        />\
      </div>\
\
      \{/* Project Description */\}\
      <Card className="p-6">\
        <h3 className="text-lg font-semibold text-gray-900 mb-3">Project Description</h3>\
        <p className="text-gray-600">\{job.description\}</p>\
      </Card>\
\
      \{/* Recent Activity */\}\
      <Card className="p-6">\
        <h3 className="text-lg font-semibold text-gray-900 mb-4">Recent Activity</h3>\
        <div className="space-y-3">\
          \{tasks.slice(0, 5).map((task) => (\
            <div key=\{task.id\} className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">\
              <div className=\{`w-2 h-2 rounded-full $\{\
                task.status === 'completed' ? 'bg-green-500' :\
                task.status === 'in-progress' ? 'bg-blue-500' : 'bg-gray-400'\
              \}`\} />\
              <div className="flex-1">\
                <p className="font-medium text-gray-900">\{task.title\}</p>\
                <p className="text-sm text-gray-500">\
                  \{task.status === 'completed' ? 'Completed' : `$\{task.progress\}% complete`\}\
                </p>\
              </div>\
              <span className="text-xs text-gray-400">\
                \{new Date(task.updatedAt || task.createdAt).toLocaleDateString()\}\
              </span>\
            </div>\
          ))\}\
        </div>\
      </Card>\
    </div>\
  );\
\};\
\
// Tasks Tab\
const TasksTab = (\{ tasks, onTaskUpdate, onCreateTask, userRole, jobId \}) => \{\
  const [showCreateTask, setShowCreateTask] = useState(false);\
  const [editingTask, setEditingTask] = useState(null);\
\
  const handleStatusChange = async (task, newStatus) => \{\
    const updates = \{ status: newStatus \};\
    if (newStatus === 'completed') \{\
      updates.progress = 100;\
      updates.completedAt = new Date().toISOString();\
    \}\
    await onTaskUpdate(task.id, updates);\
  \};\
\
  const handleProgressChange = async (task, newProgress) => \{\
    const updates = \{ progress: newProgress \};\
    if (newProgress === 100) \{\
      updates.status = 'completed';\
      updates.completedAt = new Date().toISOString();\
    \} else if (newProgress > 0 && task.status === 'pending') \{\
      updates.status = 'in-progress';\
    \}\
    await onTaskUpdate(task.id, updates);\
  \};\
\
  return (\
    <div className="space-y-6">\
      \{/* Header */\}\
      <div className="flex justify-between items-center">\
        <div>\
          <h3 className="text-lg font-semibold text-gray-900">Task Management</h3>\
          <p className="text-gray-600">Break down work into manageable tasks</p>\
        </div>\
        \{(userRole === 'admin' || userRole === 'contractor') && (\
          </Button>\
        )\}\
      </div>\
\
      \{/* Task List */\}\
      <div className="space-y-4">\
        \{tasks.map((task) => (\
          <Card key=\{task.id\} className="p-6">\
            <div className="flex items-start justify-between mb-4">\
              <div className="flex-1">\
                <div className="flex items-center gap-3 mb-2">\
                  <h4 className="font-semibold text-gray-900">\{task.title\}</h4>\
                  <Badge variant=\{getStatusColor(task.status)\}>\{task.status\}</Badge>\
                  \{task.priority && (\
                    <Badge variant=\{task.priority === 'high' ? 'danger' : task.priority === 'medium' ? 'warning' : 'default'\}>\
                      \{task.priority\}\
                    </Badge>\
                  )\}\
                </div>\
                <p className="text-gray-600 mb-3">\{task.description\}</p>\
                \
                \{/* Progress Bar */\}\
                <div className="mb-3">\
                  <div className="flex items-center justify-between mb-1">\
                    <span className="text-sm font-medium text-gray-700">Progress</span>\
                    <span className="text-sm text-gray-600">\{task.progress || 0\}%</span>\
                  </div>\
                  <div className="w-full bg-gray-200 rounded-full h-2">\
                    <div \
                      className="bg-[#3B0A69] h-2 rounded-full transition-all duration-300"\
                      style=\{\{ width: `$\{task.progress || 0\}%` \}\}\
                    />\
                  </div>\
                </div>\
\
                \{/* Task Details */\}\
                <div className="flex items-center gap-6 text-sm text-gray-500">\
                  <div className="flex items-center gap-1">\
                    <User className="w-4 h-4" />\
                    <span>\{task.assignedTo\}</span>\
                  </div>\
                  <div className="flex items-center gap-1">\
                    <Clock className="w-4 h-4" />\
                    <span>\{task.estimatedHours\}h estimated</span>\
                  </div>\
                  \{task.totalHours && (\
                    <div className="flex items-center gap-1">\
                      <Activity className="w-4 h-4" />\
                      <span>\{task.totalHours\}h logged</span>\
                    </div>\
                  )\}\
                </div>\
              </div>\
\
              \{/* Task Actions */\}\
              <div className="flex items-center gap-2">\
                \{task.status !== 'completed' && (userRole === 'admin' || task.assignedTo === user?.email) && (\
                  <>\
                    <select\
                      value=\{task.progress || 0\}\
                      onChange=\{(e) => handleProgressChange(task, parseInt(e.target.value))\}\
                      className="px-2 py-1 border border-gray-300 rounded text-sm"\
                    >\
                      <option value=\{0\}>0%</option>\
                      <option value=\{25\}>25%</option>\
                      <option value=\{50\}>50%</option>\
                      <option value=\{75\}>75%</option>\
                      <option value=\{100\}>100%</option>\
                    </select>\
                    \
                    <select\
                      value=\{task.status\}\
                      onChange=\{(e) => handleStatusChange(task, e.target.value)\}\
                      className="px-2 py-1 border border-gray-300 rounded text-sm"\
                    >\
                      <option value="pending">Pending</option>\
                      <option value="in-progress">In Progress</option>\
                      <option value="completed">Completed</option>\
                      <option value="blocked">Blocked</option>\
                    </select>\
                  </>\
                )\}\
                \
                <Button variant="ghost" size="sm" onClick=\{() => setEditingTask(task)\}>\
                  <Edit className="w-4 h-4" />\
                </Button>\
              </div>\
            </div>\
          </Card>\
        ))\}\
      </div>\
\
      \{tasks.length === 0 && (\
        <Card className="p-12 text-center">\
          <Briefcase className="w-12 h-12 text-gray-400 mx-auto mb-4" />\
          <h3 className="text-lg font-medium text-gray-900 mb-2">No tasks yet</h3>\
          <p className="text-gray-600 mb-4">Break down this job into manageable tasks</p>\
          \{(userRole === 'admin' || userRole === 'contractor') && (\
            <Button onClick=\{() => setShowCreateTask(true)\}>\
              <Plus className="w-4 h-4" />\
              Create First Task\
            </Button>\
          )\}\
        </Card>\
      )\}\
\
      \{/* Task Modal */\}\
      <TaskModal\
        isOpen=\{showCreateTask || !!editingTask\}\
        onClose=\{() => \{\
          setShowCreateTask(false);\
          setEditingTask(null);\
        \}\}\
        task=\{editingTask\}\
        onSubmit=\{editingTask ? onTaskUpdate : onCreateTask\}\
        jobId=\{jobId\}\
      />\
    </div>\
  );\
\};\
\
// Milestones Tab\
const MilestonesTab = (\{ milestones, jobId, onUpdate \}) => \{\
  const [showCreateMilestone, setShowCreateMilestone] = useState(false);\
\
  const handleMilestoneUpdate = async (milestoneId, updates) => \{\
    try \{\
      await firebase.updateMilestone(jobId, milestoneId, updates);\
      onUpdate();\
    \} catch (error) \{\
      console.error('Error updating milestone:', error);\
    \}\
  \};\
\
  return (\
    <div className="space-y-6">\
      <div className="flex justify-between items-center">\
        <div>\
          <h3 className="text-lg font-semibold text-gray-900">Project Milestones</h3>\
          <p className="text-gray-600">Track key project deliverables and deadlines</p>\
        </div>\
        <Button onClick=\{() => setShowCreateMilestone(true)\}>\
          <Plus className="w-4 h-4" />\
          Add Milestone\
        </Button>\
      </div>\
\
      \{/* Milestone Timeline */\}\
      <div className="relative">\
        <div className="absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"></div>\
        \
        <div className="space-y-6">\
          \{milestones.map((milestone, index) => (\
            <div key=\{milestone.id\} className="relative flex items-start gap-4">\
              <div className=\{`w-8 h-8 rounded-full border-4 border-white flex items-center justify-center z-10 $\{\
                milestone.status === 'completed' ? 'bg-green-500' :\
                milestone.status === 'in-progress' ? 'bg-blue-500' : 'bg-gray-300'\
              \}`\}>\
                \{milestone.status === 'completed' && (\
                  <CheckCircle className="w-4 h-4 text-white" />\
                )\}\
              </div>\
              \
              <Card className="flex-1 p-4">\
                <div className="flex items-start justify-between">\
                  <div>\
                    <h4 className="font-semibold text-gray-900">\{milestone.title\}</h4>\
                    <p className="text-gray-600 mt-1">\{milestone.description\}</p>\
                    <div className="flex items-center gap-4 mt-2 text-sm text-gray-500">\
                      <span>Due: \{new Date(milestone.dueDate).toLocaleDateString()\}</span>\
                      <span>Weight: \{milestone.weight\}%</span>\
                    </div>\
                  </div>\
                  \
                  <div className="flex items-center gap-2">\
                    <Badge variant=\{getStatusColor(milestone.status)\}>\
                      \{milestone.status\}\
                    </Badge>\
                    \{milestone.status !== 'completed' && (\
                      <Button \
                        variant="ghost" \
                        size="sm"\
                        onClick=\{() => handleMilestoneUpdate(milestone.id, \{ \
                          status: 'completed',\
                          completedAt: new Date().toISOString()\
                        \})\}\
                      >\
                        Mark Complete\
                      </Button>\
                    )\}\
                  </div>\
                </div>\
              </Card>\
            </div>\
          ))\}\
        </div>\
      </div>\
\
      \{milestones.length === 0 && (\
        <Card className="p-12 text-center">\
          <Calendar className="w-12 h-12 text-gray-400 mx-auto mb-4" />\
          <h3 className="text-lg font-medium text-gray-900 mb-2">No milestones set</h3>\
          <p className="text-gray-600 mb-4">Define key milestones to track project progress</p>\
          <Button onClick=\{() => setShowCreateMilestone(true)\}>\
            <Plus className="w-4 h-4" />\
            Create First Milestone\
          </Button>\
        </Card>\
      )\}\
    </div>\
  );\
\};\
\
// Time Tracking Tab\
const TimeTrackingTab = (\{ tasks, jobId, userRole \}) => \{\
  const [activeTimer, setActiveTimer] = useState(null);\
  const [timerStart, setTimerStart] = useState(null);\
  const [timeEntries, setTimeEntries] = useState([]);\
  const [showTimeModal, setShowTimeModal] = useState(false);\
  const [selectedTask, setSelectedTask] = useState(null);\
\
  useEffect(() => \{\
    loadTimeEntries();\
  \}, [tasks]);\
\
  const loadTimeEntries = async () => \{\
    try \{\
      const allEntries = [];\
      for (const task of tasks) \{\
        const entries = await firebase.getTimeEntries(task.id);\
        allEntries.push(...entries.map(entry => (\{ ...entry, taskTitle: task.title \})));\
      \}\
      setTimeEntries(allEntries.sort((a, b) => new Date(b.date) - new Date(a.date)));\
    \} catch (error) \{\
      console.error('Error loading time entries:', error);\
    \}\
  \};\
\
  const startTimer = (taskId) => \{\
    setActiveTimer(taskId);\
    setTimerStart(new Date());\
  \};\
\
  const stopTimer = async () => \{\
    if (activeTimer && timerStart) \{\
      const endTime = new Date();\
      const hours = (endTime - timerStart) / (1000 * 60 * 60);\
      \
      const entryData = \{\
        taskId: activeTimer,\
        date: endTime.toISOString().split('T')[0],\
        hours: Math.round(hours * 100) / 100,\
        description: 'Timer session',\
        contractor: user?.email\
      \};\
\
      try \{\
        await firebase.createTimeEntry(activeTimer, entryData);\
        setActiveTimer(null);\
        setTimerStart(null);\
        loadTimeEntries();\
      \} catch (error) \{\
        console.error('Error saving time entry:', error);\
      \}\
    \}\
  \};\
\
  const totalTimeLogged = timeEntries.reduce((sum, entry) => sum + entry.hours, 0);\
\
  return (\
    <div className="space-y-6">\
      <div className="flex justify-between items-center">\
        <div>\
          <h3 className="text-lg font-semibold text-gray-900">Time Tracking</h3>\
          <p className="text-gray-600">Log time spent on tasks and track productivity</p>\
        </div>\
        <div className="flex items-center gap-3">\
          <div className="text-right">\
            <p className="text-sm text-gray-500">Total Time Logged</p>\
            <p className="text-xl font-bold text-gray-900">\{totalTimeLogged.toFixed(1)\}h</p>\
          </div>\
          \{userRole === 'contractor' && (\
            <Button onClick=\{() => setShowTimeModal(true)\}>\
              <Plus className="w-4 h-4" />\
              Log Time\
            </Button>\
          )\}\
        </div>\
      </div>\
\
      \{/* Active Timer */\}\
      \{activeTimer && (\
        <Card className="p-4 bg-blue-50 border-blue-200">\
          <div className="flex items-center justify-between">\
            <div>\
              <p className="font-medium text-blue-900">Timer Running</p>\
              <p className="text-sm text-blue-700">\
                Task: \{tasks.find(t => t.id === activeTimer)?.title\}\
              </p>\
            </div>\
            <div className="flex items-center gap-3">\
              <TimerDisplay startTime=\{timerStart\} />\
              <Button variant="danger" onClick=\{stopTimer\}>\
                Stop Timer\
              </Button>\
            </div>\
          </div>\
        </Card>\
      )\}\
\
      \{/* Task Time Tracking */\}\
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">\
        \{tasks.map((task) => (\
          <Card key=\{task.id\} className="p-4">\
            <div className="flex items-start justify-between mb-3">\
              <div>\
                <h4 className="font-medium text-gray-900">\{task.title\}</h4>\
                <p className="text-sm text-gray-600">\
                  \{task.totalHours || 0\}h / \{task.estimatedHours\}h\
                </p>\
              </div>\
              \{userRole === 'contractor' && task.status !== 'completed' && (\
                <div className="flex items-center gap-2">\
                  \{activeTimer === task.id ? (\
                    <Button variant="danger" size="sm" onClick=\{stopTimer\}>\
                      Stop\
                    </Button>\
                  ) : (\
                    <Button size="sm" onClick=\{() => startTimer(task.id)\}>\
                      Start\
                    </Button>\
                  )\}\
                  <Button \
                    variant="ghost" \
                    size="sm"\
                    onClick=\{() => \{\
                      setSelectedTask(task);\
                      setShowTimeModal(true);\
                    \}\}\
                  >\
                    <Plus className="w-3 h-3" />\
                  </Button>\
                </div>\
              )\}\
            </div>\
            \
            \{/* Progress bar */\}\
            <div className="w-full bg-gray-200 rounded-full h-2">\
              <div \
                className=\{`h-2 rounded-full $\{\
                  (task.totalHours || 0) > task.estimatedHours ? 'bg-red-500' : 'bg-green-500'\
                \}`\}\
                style=\{\{ \
                  width: `$\{Math.min(100, ((task.totalHours || 0) / task.estimatedHours) * 100)\}%` \
                \}\}\
              />\
            </div>\
          </Card>\
        ))\}\
      </div>\
\
      \{/* Time Entries List */\}\
      <Card className="overflow-hidden">\
        <div className="p-6">\
          <h4 className="text-lg font-medium text-gray-900 mb-4">Recent Time Entries</h4>\
          <div className="overflow-x-auto">\
            <table className="w-full">\
              <thead className="bg-gray-50 border-b border-gray-200">\
                <tr>\
                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>\
                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Task</th>\
                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Hours</th>\
                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Description</th>\
                  <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Contractor</th>\
                </tr>\
              </thead>\
              <tbody className="divide-y divide-gray-200">\
                \{timeEntries.slice(0, 10).map((entry) => (\
                  <tr key=\{entry.id\} className="hover:bg-gray-50">\
                    <td className="px-4 py-3 text-sm text-gray-900">\
                      \{new Date(entry.date).toLocaleDateString()\}\
                    </td>\
                    <td className="px-4 py-3 text-sm text-gray-900">\{entry.taskTitle\}</td>\
                    <td className="px-4 py-3 text-sm text-gray-900">\{entry.hours\}h</td>\
                    <td className="px-4 py-3 text-sm text-gray-600">\{entry.description\}</td>\
                    <td className="px-4 py-3 text-sm text-gray-600">\{entry.contractor\}</td>\
                  </tr>\
                ))\}\
              </tbody>\
            </table>\
          </div>\
        </div>\
      </Card>\
\
      \{/* Time Entry Modal */\}\
      <TimeEntryModal\
        isOpen=\{showTimeModal\}\
        onClose=\{() => \{\
          setShowTimeModal(false);\
          setSelectedTask(null);\
        \}\}\
        task=\{selectedTask\}\
        tasks=\{tasks\}\
        onSubmit=\{async (entryData) => \{\
          await firebase.createTimeEntry(entryData.taskId, entryData);\
          loadTimeEntries();\
        \}\}\
      />\
    </div>\
  );\
\};\
\
// Timer Display Component\
const TimerDisplay = (\{ startTime \}) => \{\
  const [elapsed, setElapsed] = useState(0);\
\
  useEffect(() => \{\
    const interval = setInterval(() => \{\
      setElapsed(Date.now() - startTime.getTime());\
    \}, 1000);\
\
    return () => clearInterval(interval);\
  \}, [startTime]);\
\
  const hours = Math.floor(elapsed / (1000 * 60 * 60));\
  const minutes = Math.floor((elapsed % (1000 * 60 * 60)) / (1000 * 60));\
  const seconds = Math.floor((elapsed % (1000 * 60)) / 1000);\
\
  return (\
    <div className="font-mono text-lg font-bold text-blue-900">\
      \{hours.toString().padStart(2, '0')\}:\
      \{minutes.toString().padStart(2, '0')\}:\
      \{seconds.toString().padStart(2, '0')\}\
    </div>\
  );\
\};// Enhanced Notification Dropdown with Multi-Channel Status\
const NotificationDropdown = () => \{\
  const \{ notifications, unreadCount, markAsRead, markAllAsRead \} = useNotifications();\
  const [isOpen, setIsOpen] = useState(false);\
\
  const handleNotificationClick = (notification) => \{\
    if (!notification.read) \{\
      markAsRead(notification.id);\
    \}\
  \};\
\
  const getNotificationIcon = (type) => \{\
    switch (type) \{\
      case 'message': return <MessageSquare className="w-4 h-4 text-blue-500" />;\
      case 'invoice': return <DollarSign className="w-4 h-4 text-green-500" />;\
      case 'job': return <Briefcase className="w-4 h-4 text-purple-500" />;\
      case 'schedule': return <Calendar className="w-4 h-4 text-orange-500" />;\
      case 'payment': return <DollarSign className="w-4 h-4 text-green-500" />;\
      case 'system': return <Settings className="w-4 h-4 text-gray-500" />;\
      default: return <Bell className="w-4 h-4 text-gray-500" />;\
    \}\
  \};\
\
  const getUrgencyColor = (urgency) => \{\
    switch (urgency) \{\
      case 'critical': return 'border-l-red-500 bg-red-50';\
      case 'high': return 'border-l-orange-500 bg-orange-50';\
      case 'normal': return 'border-l-blue-500 bg-blue-50';\
      case 'low': return 'border-l-gray-500 bg-gray-50';\
      default: return 'border-l-gray-500 bg-gray-50';\
    \}\
  \};\
\
  const getDeliveryStatus = (notification) => \{\
    if (!notification.deliveryStatus) return null;\
    \
    const delivered = [];\
    if (notification.deliveryStatus.browser) delivered.push('Browser');\
    if (notification.deliveryStatus.email) delivered.push('Email');\
    if (notification.deliveryStatus.sms) delivered.push('SMS');\
    \
    return delivered.length > 0 ? delivered.join(', ') : 'Failed';\
  \};\
\
  return (\
    <div className="relative">\
      <button\
        onClick=\{() => setIsOpen(!isOpen)\}\
        className="p-2 rounded-lg hover:bg-gray-100 transition-colors relative"\
      >\
        <Bell className="w-5 h-5 text-gray-600" />\
        \{unreadCount > 0 && (\
          <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1.5 py-0.5 min-w-[18px] text-center">\
            \{unreadCount > 99 ? '99+' : unreadCount\}\
          </span>\
        )\}\
      </button>\
\
      \{isOpen && (\
        <>\
          <div \
            className="fixed inset-0 z-40"\
            onClick=\{() => setIsOpen(false)\}\
          />\
          <div className="absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-lg border border-gray-200 z-50">\
            <div className="p-4 border-b border-gray-200">\
              <div className="flex items-center justify-between">\
                <h3 className="font-semibold text-gray-900">Notifications</h3>\
                <div className="flex items-center gap-2">\
                  \{unreadCount > 0 && (\
                    <Button \
                      variant="ghost" \
                      size="sm"\
                      onClick=\{markAllAsRead\}\
                    >\
                      Mark all read\
                    </Button>\
                  )\}\
                  <Button\
                    variant="ghost"\
                    size="sm"\
                    onClick=\{() => setIsOpen(false)\}\
                  >\
                    <X className="w-4 h-4" />\
                  </Button>\
                </div>\
              </div>\
            </div>\
\
            <div className="max-h-96 overflow-y-auto">\
              \{notifications.length === 0 ? (\
                <div className="p-8 text-center text-gray-500">\
                  <Bell className="w-8 h-8 mx-auto mb-2 text-gray-300" />\
                  <p>No notifications yet</p>\
                </div>\
              ) : (\
                notifications.map((notification) => (\
                  <div\
                    key=\{notification.id\}\
                    onClick=\{() => handleNotificationClick(notification)\}\
                    className=\{`p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer border-l-4 $\{\
                      !notification.read ? getUrgencyColor(notification.urgency) : 'border-l-gray-200'\
                    \}`\}\
                  >\
                    <div className="flex items-start gap-3">\
                      \{getNotificationIcon(notification.type)\}\
                      <div className="flex-1 min-w-0">\
                        <div className="flex items-center justify-between mb-1">\
                          <p className=\{`text-sm $\{!notification.read ? 'font-semibold' : 'font-medium'\} text-gray-900`\}>\
                            \{notification.title\}\
                          </p>\
                          \{notification.urgency && notification.urgency !== 'normal' && (\
                            <Badge \
                              variant=\{notification.urgency === 'critical' ? 'danger' : 'warning'\} \
                              size="sm"\
                            >\
                              \{notification.urgency\}\
                            </Badge>\
                          )\}\
                        </div>\
                        <p className="text-sm text-gray-600 mb-2">\
                          \{notification.message\}\
                        </p>\
                        <div className="flex items-center justify-between text-xs text-gray-400">\
                          <span>\{new Date(notification.timestamp).toLocaleString()\}</span>\
                          \{getDeliveryStatus(notification) && (\
                            <span className="text-green-600">\
                              Sent via: \{getDeliveryStatus(notification)\}\
                            </span>\
                          )\}\
                        </div>\
                        \{notification.actionUrl && (\
                          <Button \
                            variant="ghost" \
                            size="sm" \
                            className="mt-2"\
                            onClick=\{(e) => \{\
                              e.stopPropagation();\
                              // Handle action URL navigation\
                              console.log('Navigate to:', notification.actionUrl);\
                            \}\}\
                          >\
                            \{notification.actionText || 'View Details'\}\
                            <ArrowRight className="w-3 h-3 ml-1" />\
                          </Button>\
                        )\}\
                      </div>\
                      \{!notification.read && (\
                        <div className="w-2 h-2 bg-blue-500 rounded-full mt-2" />\
                      )\}\
                    </div>\
                  </div>\
                ))\
              )\}\
            </div>\
          </div>\
        </>\
      )\}\
    </div>\
  );\
\};\
\
// Notification Preferences Management Component\
const NotificationPreferencesView = () => \{\
  const \{ preferences, updatePreferences \} = useNotifications();\
  const [localPreferences, setLocalPreferences] = useState(null);\
  const [saving, setSaving] = useState(false);\
\
  useEffect(() => \{\
    if (preferences) \{\
      setLocalPreferences(\{ ...preferences \});\
    \}\
  \}, [preferences]);\
\
  const handleChannelChange = (channel, type, enabled) => \{\
    setLocalPreferences(prev => (\{\
      ...prev,\
      [channel]: \{\
        ...prev[channel],\
        [type]: enabled\
      \}\
    \}));\
  \};\
\
  const handleQuietHoursChange = (field, value) => \{\
    setLocalPreferences(prev => (\{\
      ...prev,\
      quiet_hours: \{\
        ...prev.quiet_hours,\
        [field]: value\
      \}\
    \}));\
  \};\
\
  const handleSave = async () => \{\
    setSaving(true);\
    try \{\
      await updatePreferences(localPreferences);\
    \} catch (error) \{\
      console.error('Error saving preferences:', error);\
    \} finally \{\
      setSaving(false);\
    \}\
  \};\
\
  if (!localPreferences) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading preferences...</div>\
    </div>;\
  \}\
\
  const notificationTypes = [\
    \{ key: 'message', label: 'Messages', description: 'New messages and chat notifications' \},\
    \{ key: 'invoice', label: 'Invoices', description: 'Invoice updates and payment reminders' \},\
    \{ key: 'job', label: 'Jobs', description: 'Job assignments and status updates' \},\
    \{ key: 'payment', label: 'Payments', description: 'Payment confirmations and alerts' \},\
    \{ key: 'schedule', label: 'Schedule', description: 'Appointment reminders and changes' \},\
    \{ key: 'system', label: 'System', description: 'System maintenance and updates' \}\
  ];\
\
  return (\
    <div className="max-w-4xl mx-auto space-y-8">\
      <div>\
        <h2 className="text-2xl font-bold text-gray-900 mb-2">Notification Preferences</h2>\
        <p className="text-gray-600">Customize how and when you receive notifications</p>\
      </div>\
\
      \{/* Notification Channels */\}\
      <Card className="overflow-hidden">\
        <div className="p-6">\
          <h3 className="text-lg font-semibold text-gray-900 mb-6">Notification Channels</h3>\
          \
          <div className="overflow-x-auto">\
            <table className="w-full">\
              <thead>\
                <tr className="border-b border-gray-200">\
                <tr className="border-b border-gray-200">\
                  <th className="text-left py-3 px-4 font-medium text-gray-900">Notification Type</th>\
                  <th className="text-center py-3 px-4 font-medium text-gray-900">\
                    <div className="flex items-center justify-center gap-2">\
                      <Bell className="w-4 h-4" />\
                      Browser\
                    </div>\
                  </th>\
                  <th className="text-center py-3 px-4 font-medium text-gray-900">\
                    <div className="flex items-center justify-center gap-2">\
                      <Mail className="w-4 h-4" />\
                      Email\
                    </div>\
                  </th>\
                  <th className="text-center py-3 px-4 font-medium text-gray-900">\
                    <div className="flex items-center justify-center gap-2">\
                      <Phone className="w-4 h-4" />\
                      SMS\
                    </div>\
                  </th>\
                </tr>\
              </thead>\
              <tbody>\
                \{notificationTypes.map((type) => (\
                  <tr key=\{type.key\} className="border-b border-gray-100">\
                    <td className="py-4 px-4">\
                      <div>\
                        <div className="font-medium text-gray-900">\{type.label\}</div>\
                        <div className="text-sm text-gray-500">\{type.description\}</div>\
                      </div>\
                    </td>\
                    <td className="py-4 px-4 text-center">\
                      <input\
                        type="checkbox"\
                        checked=\{localPreferences.browser[type.key] || false\}\
                        onChange=\{(e) => handleChannelChange('browser', type.key, e.target.checked)\}\
                        className="w-4 h-4 text-[#3B0A69] border-gray-300 rounded focus:ring-[#3B0A69]"\
                      />\
                    </td>\
                    <td className="py-4 px-4 text-center">\
                      <input\
                        type="checkbox"\
                        checked=\{localPreferences.email[type.key] || false\}\
                        onChange=\{(e) => handleChannelChange('email', type.key, e.target.checked)\}\
                        className="w-4 h-4 text-[#3B0A69] border-gray-300 rounded focus:ring-[#3B0A69]"\
                      />\
                    </td>\
                    <td className="py-4 px-4 text-center">\
                      <input\
                        type="checkbox"\
                        checked=\{localPreferences.sms[type.key] || false\}\
                        onChange=\{(e) => handleChannelChange('sms', type.key, e.target.checked)\}\
                        className="w-4 h-4 text-[#3B0A69] border-gray-300 rounded focus:ring-[#3B0A69]"\
                      />\
                    </td>\
                  </tr>\
                ))\}\
              </tbody>\
            </table>\
          </div>\
        </div>\
      </Card>\
\
      \{/* Quiet Hours */\}\
      <Card className="p-6">\
        <h3 className="text-lg font-semibold text-gray-900 mb-4">Quiet Hours</h3>\
        <div className="space-y-4">\
          <div className="flex items-center gap-3">\
            <input\
              type="checkbox"\
              checked=\{localPreferences.quiet_hours.enabled\}\
              onChange=\{(e) => handleQuietHoursChange('enabled', e.target.checked)\}\
              className="w-4 h-4 text-[#3B0A69] border-gray-300 rounded focus:ring-[#3B0A69]"\
            />\
            <label className="font-medium text-gray-900">Enable quiet hours</label>\
          </div>\
          \
          \{localPreferences.quiet_hours.enabled && (\
            <div className="grid grid-cols-2 gap-4 ml-7">\
              <div>\
                <label className="block text-sm font-medium text-gray-700 mb-1">Start Time</label>\
                <input\
                  type="time"\
                  value=\{localPreferences.quiet_hours.start\}\
                  onChange=\{(e) => handleQuietHoursChange('start', e.target.value)\}\
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
                />\
              </div>\
              <div>\
                <label className="block text-sm font-medium text-gray-700 mb-1">End Time</label>\
                <input\
                  type="time"\
                  value=\{localPreferences.quiet_hours.end\}\
                  onChange=\{(e) => handleQuietHoursChange('end', e.target.value)\}\
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
                />\
              </div>\
            </div>\
          )\}\
          \
          <p className="text-sm text-gray-500 ml-7">\
            During quiet hours, only critical notifications will be sent via SMS and browser notifications will be silent.\
          </p>\
        </div>\
      </Card>\
\
      \{/* Urgency Overrides */\}\
      <Card className="p-6">\
        <h3 className="text-lg font-semibold text-gray-900 mb-4">Urgency Overrides</h3>\
        <div className="space-y-3">\
          <div className="flex items-center gap-3">\
            <input\
              type="checkbox"\
              checked=\{localPreferences.urgency_override.critical_always\}\
              onChange=\{(e) => setLocalPreferences(prev => (\{\
                ...prev,\
                urgency_override: \{\
                  ...prev.urgency_override,\
                  critical_always: e.target.checked\
                \}\
              \}))\}\
              className="w-4 h-4 text-[#3B0A69] border-gray-300 rounded focus:ring-[#3B0A69]"\
            />\
            <div>\
              <label className="font-medium text-gray-900">Always send critical alerts</label>\
              <p className="text-sm text-gray-500">Critical notifications bypass all preferences and quiet hours</p>\
            </div>\
          </div>\
          \
          <div className="flex items-center gap-3">\
            <input\
              type="checkbox"\
              checked=\{localPreferences.urgency_override.high_during_hours\}\
              onChange=\{(e) => setLocalPreferences(prev => (\{\
                ...prev,\
                urgency_override: \{\
                  ...prev.urgency_override,\
                  high_during_hours: e.target.checked\
                \}\
              \}))\}\
              className="w-4 h-4 text-[#3B0A69] border-gray-300 rounded focus:ring-[#3B0A69]"\
            />\
            <div>\
              <label className="font-medium text-gray-900">Send high priority during business hours</label>\
              <p className="text-sm text-gray-500">High priority notifications bypass quiet hours during 9 AM - 6 PM</p>\
            </div>\
          </div>\
        </div>\
      </Card>\
\
      \{/* Save Button */\}\
      <div className="flex justify-end">\
        <Button \
          onClick=\{handleSave\}\
          loading=\{saving\}\
          className="px-8"\
        >\
          Save Preferences\
        </Button>\
      </div>\
    </div>\
  );\
\};\
\
// Notification Analytics Dashboard\
const NotificationAnalyticsView = () => \{\
  const \{ getAnalytics \} = useNotifications();\
  const [analytics, setAnalytics] = useState(null);\
  const [loading, setLoading] = useState(true);\
  const [timeRange, setTimeRange] = useState(30);\
\
  useEffect(() => \{\
    loadAnalytics();\
  \}, [timeRange]);\
\
  const loadAnalytics = async () => \{\
    setLoading(true);\
    try \{\
      const data = await getAnalytics(timeRange);\
      setAnalytics(data);\
    \} catch (error) \{\
      console.error('Error loading analytics:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading analytics...</div>\
    </div>;\
  \}\
\
  if (!analytics) \{\
    return <div className="text-center text-gray-500">No analytics data available</div>;\
  \}\
\
  return (\
    <div className="space-y-6">\
      <div className="flex justify-between items-center">\
        <div>\
          <h2 className="text-2xl font-bold text-gray-900">Notification Analytics</h2>\
          <p className="text-gray-600">Track notification delivery and engagement</p>\
        </div>\
        <select\
          value=\{timeRange\}\
          onChange=\{(e) => setTimeRange(Number(e.target.value))\}\
          className="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
        >\
          <option value=\{7\}>Last 7 days</option>\
          <option value=\{30\}>Last 30 days</option>\
          <option value=\{90\}>Last 90 days</option>\
        </select>\
      </div>\
\
      \{/* Summary Cards */\}\
      <div className="grid grid-cols-1 md:grid-cols-4 gap-6">\
        <MetricCard\
          title="Total Notifications"\
          value=\{analytics.total.toString()\}\
          icon=\{Bell\}\
          color="blue"\
        />\
        <MetricCard\
          title="Unread"\
          value=\{analytics.unread.toString()\}\
          icon=\{AlertCircle\}\
          color="yellow"\
        />\
        <MetricCard\
          title="Browser Delivery"\
          value=\{`$\{analytics.deliveryRate.browser\}%`\}\
          icon=\{Bell\}\
          color="green"\
        />\
        <MetricCard\
          title="Email Delivery"\
          value=\{`$\{analytics.deliveryRate.email\}%`\}\
          icon=\{Mail\}\
          color="purple"\
        />\
      </div>\
\
      \{/* Charts */\}\
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">\
        <Card className="p-6">\
          <h3 className="text-lg font-semibold text-gray-900 mb-4">Notifications by Type</h3>\
          <div className="space-y-3">\
            \{Object.entries(analytics.byType).map(([type, count]) => (\
              <div key=\{type\} className="flex items-center justify-between">\
                <span className="capitalize text-gray-600">\{type\}</span>\
                <div className="flex items-center gap-2">\
                  <div className="w-24 bg-gray-200 rounded-full h-2">\
                    <div \
                      className="bg-[#3B0A69] h-2 rounded-full"\
                      style=\{\{ width: `$\{(count / analytics.total) * 100\}%` \}\}\
                    />\
                  </div>\
                  <span className="text-sm font-medium text-gray-900 min-w-[30px]">\{count\}</span>\
                </div>\
              </div>\
            ))\}\
          </div>\
        </Card>\
\
        <Card className="p-6">\
          <h3 className="text-lg font-semibold text-gray-900 mb-4">Delivery Success Rate</h3>\
          <div className="space-y-4">\
            \{Object.entries(analytics.deliveryRate).map(([channel, rate]) => (\
              <div key=\{channel\} className="space-y-2">\
                <div className="flex justify-between items-center">\
                  <span className="capitalize text-gray-600">\{channel\}</span>\
                  <span className="font-medium text-gray-900">\{rate\}%</span>\
                </div>\
                <div className="w-full bg-gray-200 rounded-full h-2">\
                  <div \
                    className=\{`h-2 rounded-full $\{\
                      rate >= 90 ? 'bg-green-500' : \
                      rate >= 70 ? 'bg-yellow-500' : 'bg-red-500'\
                    \}`\}\
                    style=\{\{ width: `$\{rate\}%` \}\}\
                  />\
                </div>\
              </div>\
            ))\}\
          </div>\
        </Card>\
      </div>\
    </div>\
  );\
\};\
\
// Test Notification Component\
const NotificationTestCenter = () => \{\
  const \{ createNotification, sendBulkNotification \} = useNotifications();\
  const \{ user \} = useAuth();\
  const [testData, setTestData] = useState(\{\
    type: 'message',\
    urgency: 'normal',\
    title: 'Test Notification',\
    message: 'This is a test notification to verify delivery channels.'\
  \});\
\
  const sendTestNotification = async () => \{\
    try \{\
      await createNotification(testData);\
      alert('Test notification sent successfully!');\
    \} catch (error) \{\
      alert('Failed to send test notification: ' + error.message);\
    \}\
  \};\
\
  const notificationTypes = ['message', 'invoice', 'job', 'payment', 'schedule', 'system'];\
  const urgencyLevels = ['low', 'normal', 'high', 'critical'];\
\
  return (\
    <Card className="p-6">\
      <h3 className="text-lg font-semibold text-gray-900 mb-4">Test Notification Center</h3>\
      \
      <div className="grid grid-cols-2 gap-4 mb-4">\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">Type</label>\
          <select\
            value=\{testData.type\}\
            onChange=\{(e) => setTestData(prev => (\{ ...prev, type: e.target.value \}))\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
          >\
            \{notificationTypes.map(type => (\
              <option key=\{type\} value=\{type\}>\{type\}</option>\
            ))\}\
          </select>\
        </div>\
        \
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">Urgency</label>\
          <select\
            value=\{testData.urgency\}\
            onChange=\{(e) => setTestData(prev => (\{ ...prev, urgency: e.target.value \}))\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
          >\
            \{urgencyLevels.map(level => (\
              <option key=\{level\} value=\{level\}>\{level\}</option>\
            ))\}\
          </select>\
        </div>\
      </div>\
\
      <div className="mb-4">\
        <label className="block text-sm font-medium text-gray-700 mb-1">Title</label>\
        <input\
          type="text"\
          value=\{testData.title\}\
          onChange=\{(e) => setTestData(prev => (\{ ...prev, title: e.target.value \}))\}\
          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
        />\
      </div>\
\
      <div className="mb-6">\
        <label className="block text-sm font-medium text-gray-700 mb-1">Message</label>\
        <textarea\
          value=\{testData.message\}\
          onChange=\{(e) => setTestData(prev => (\{ ...prev, message: e.target.value \}))\}\
          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
          rows=\{3\}\
        />\
      </div>\
\
      <Button onClick=\{sendTestNotification\} className="w-full">\
        <Send className="w-4 h-4" />\
        Send Test Notification\
      </Button>\
    </Card>\
  );\
\};// Calendar and Scheduling Components\
const ScheduleView = () => \{\
  const \{ user \} = useAuth();\
  const [currentView, setCurrentView] = useState('calendar');\
  const [events, setEvents] = useState([]);\
  const [loading, setLoading] = useState(true);\
  const [selectedDate, setSelectedDate] = useState(new Date());\
  const [showEventModal, setShowEventModal] = useState(false);\
  const [selectedEvent, setSelectedEvent] = useState(null);\
\
  useEffect(() => \{\
    loadEvents();\
  \}, [user, selectedDate]);\
\
  const loadEvents = async () => \{\
    try \{\
      let filters = \{\};\
      \
      if (user?.role === 'contractor') \{\
        filters.contractorEmail = user.email;\
      \} else if (user?.role === 'client') \{\
        filters.clientEmail = user.email;\
      \}\
\
      const eventsData = await firebase.getScheduleEvents(filters);\
      setEvents(eventsData);\
    \} catch (error) \{\
      console.error('Error loading events:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  const handleCreateEvent = async (eventData) => \{\
    try \{\
      await firebase.createScheduleEvent(eventData);\
      loadEvents();\
    \} catch (error) \{\
      console.error('Error creating event:', error);\
      alert(error.message);\
    \}\
  \};\
\
  const handleUpdateEvent = async (eventId, updates) => \{\
    try \{\
      await firebase.updateScheduleEvent(eventId, updates);\
      loadEvents();\
    \} catch (error) \{\
      console.error('Error updating event:', error);\
    \}\
  \};\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading schedule...</div>\
    </div>;\
  \}\
\
  return (\
    <div className="space-y-6">\
      \{/* Header */\}\
      <div className="flex justify-between items-center">\
        <div>\
          <h2 className="text-2xl font-bold text-gray-900">Schedule Management</h2>\
          <p className="text-gray-600">Manage appointments and track project timelines</p>\
        </div>\
        <div className="flex items-center gap-3">\
          <div className="flex rounded-lg border border-gray-200">\
            <button\
              onClick=\{() => setCurrentView('calendar')\}\
              className=\{`px-4 py-2 text-sm font-medium rounded-l-lg transition-colors $\{\
                currentView === 'calendar' \
                  ? 'bg-[#3B0A69] text-white' \
                  : 'text-gray-700 hover:bg-gray-50'\
              \}`\}\
            >\
              Calendar\
            </button>\
            <button\
              onClick=\{() => setCurrentView('timeline')\}\
              className=\{`px-4 py-2 text-sm font-medium rounded-r-lg transition-colors $\{\
                currentView === 'timeline' \
                  ? 'bg-[#3B0A69] text-white' \
                  : 'text-gray-700 hover:bg-gray-50'\
              \}`\}\
            >\
              Timeline\
            </button>\
          </div>\
          \{user?.role === 'admin' && (\
            <Button onClick=\{() => setShowEventModal(true)\}>\
              <Plus className="w-4 h-4" />\
              Schedule Appointment\
            </Button>\
          )\}\
        </div>\
      </div>\
\
      \{/* View Content */\}\
      \{currentView === 'calendar' ? (\
        <CalendarView \
          events=\{events\}\
          selectedDate=\{selectedDate\}\
          onDateSelect=\{setSelectedDate\}\
          onEventClick=\{(event) => \{\
            setSelectedEvent(event);\
            setShowEventModal(true);\
          \}\}\
          userRole=\{user?.role\}\
        />\
      ) : (\
        <TimelineView userRole=\{user?.role\} />\
      )\}\
\
      \{/* Event Modal */\}\
      <EventModal\
        isOpen=\{showEventModal\}\
        onClose=\{() => \{\
          setShowEventModal(false);\
          setSelectedEvent(null);\
        \}\}\
        event=\{selectedEvent\}\
        onSubmit=\{selectedEvent ? handleUpdateEvent : handleCreateEvent\}\
        userRole=\{user?.role\}\
      />\
    </div>\
  );\
\};\
\
const CalendarView = (\{ events, selectedDate, onDateSelect, onEventClick, userRole \}) => \{\
  const [viewMode, setViewMode] = useState('month');\
  const [currentDate, setCurrentDate] = useState(new Date());\
\
  const getDaysInMonth = (date) => \{\
    const year = date.getFullYear();\
    const month = date.getMonth();\
    const firstDay = new Date(year, month, 1);\
    const lastDay = new Date(year, month + 1, 0);\
    const daysInMonth = lastDay.getDate();\
    const startingDayOfWeek = firstDay.getDay();\
\
    const days = [];\
    \
    // Add empty cells for days before the first day of the month\
    for (let i = 0; i < startingDayOfWeek; i++) \{\
      days.push(null);\
    \}\
    \
    // Add days of the month\
    for (let day = 1; day <= daysInMonth; day++) \{\
      days.push(new Date(year, month, day));\
    \}\
    \
    return days;\
  \};\
\
  const getEventsForDate = (date) => \{\
    if (!date) return [];\
    return events.filter(event => \{\
      const eventDate = new Date(event.startTime);\
      return eventDate.toDateString() === date.toDateString();\
    \});\
  \};\
\
  const getEventColor = (status) => \{\
    switch (status) \{\
      case 'completed': return 'bg-green-500';\
      case 'in-progress': return 'bg-blue-500';\
      case 'scheduled': return 'bg-purple-500';\
      case 'cancelled': return 'bg-red-500';\
      default: return 'bg-gray-500';\
    \}\
  \};\
\
  const days = getDaysInMonth(currentDate);\
  const monthNames = [\
    'January', 'February', 'March', 'April', 'May', 'June',\
    'July', 'August', 'September', 'October', 'November', 'December'\
  ];\
\
  const navigateMonth = (direction) => \{\
    setCurrentDate(prev => \{\
      const newDate = new Date(prev);\
      newDate.setMonth(prev.getMonth() + direction);\
      return newDate;\
    \});\
  \};\
\
  return (\
    <Card className="p-6">\
      \{/* Calendar Header */\}\
      <div className="flex items-center justify-between mb-6">\
        <div className="flex items-center gap-4">\
          <button\
            onClick=\{() => navigateMonth(-1)\}\
            className="p-2 rounded-lg hover:bg-gray-100 transition-colors"\
          >\
            <ChevronDown className="w-5 h-5 rotate-90" />\
          </button>\
          <h3 className="text-xl font-semibold text-gray-900">\
            \{monthNames[currentDate.getMonth()]\} \{currentDate.getFullYear()\}\
          </h3>\
          <button\
            onClick=\{() => navigateMonth(1)\}\
            className="p-2 rounded-lg hover:bg-gray-100 transition-colors"\
          >\
            <ChevronDown className="w-5 h-5 -rotate-90" />\
          </button>\
        </div>\
        \
        <Button\
          variant="ghost"\
          onClick=\{() => setCurrentDate(new Date())\}\
        >\
          Today\
        </Button>\
      </div>\
\
      \{/* Calendar Grid */\}\
      <div className="grid grid-cols-7 gap-px bg-gray-200 rounded-lg overflow-hidden">\
        \{/* Day Headers */\}\
        \{['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (\
          <div key=\{day\} className="bg-gray-50 p-3 text-center text-sm font-medium text-gray-700">\
            \{day\}\
          </div>\
        ))\}\
        \
        \{/* Calendar Days */\}\
        \{days.map((date, index) => \{\
          const dayEvents = getEventsForDate(date);\
          const isToday = date && date.toDateString() === new Date().toDateString();\
          const isSelected = date && date.toDateString() === selectedDate.toDateString();\
          \
          return (\
            <div\
              key=\{index\}\
              onClick=\{() => date && onDateSelect(date)\}\
              className=\{`bg-white p-2 min-h-[120px] cursor-pointer hover:bg-gray-50 transition-colors $\{\
                isSelected ? 'ring-2 ring-[#3B0A69]' : ''\
              \}`\}\
            >\
              \{date && (\
                <>\
                  <div className=\{`text-sm font-medium mb-1 $\{\
                    isToday ? 'text-[#3B0A69] font-bold' : 'text-gray-900'\
                  \}`\}>\
                    \{date.getDate()\}\
                  </div>\
                  <div className="space-y-1">\
                    \{dayEvents.slice(0, 3).map(event => (\
                      <div\
                        key=\{event.id\}\
                        onClick=\{(e) => \{\
                          e.stopPropagation();\
                          onEventClick(event);\
                        \}\}\
                        className=\{`text-xs text-white p-1 rounded truncate cursor-pointer hover:opacity-80 $\{getEventColor(event.status)\}`\}\
                        title=\{event.title\}\
                      >\
                        \{new Date(event.startTime).toLocaleTimeString([], \{ \
                          hour: '2-digit', \
                          minute: '2-digit' \
                        \})\} \{event.title\}\
                      </div>\
                    ))\}\
                    \{dayEvents.length > 3 && (\
                      <div className="text-xs text-gray-500 text-center">\
                        +\{dayEvents.length - 3\} more\
                      </div>\
                    )\}\
                  </div>\
                </>\
              )\}\
            </div>\
          );\
        \})\}\
      </div>\
\
      \{/* Legend */\}\
      <div className="flex items-center justify-center gap-6 mt-6 text-sm">\
        <div className="flex items-center gap-2">\
          <div className="w-3 h-3 bg-purple-500 rounded"></div>\
          <span>Scheduled</span>\
        </div>\
        <div className="flex items-center gap-2">\
          <div className="w-3 h-3 bg-blue-500 rounded"></div>\
          <span>In Progress</span>\
        </div>\
        <div className="flex items-center gap-2">\
          <div className="w-3 h-3 bg-green-500 rounded"></div>\
          <span>Completed</span>\
        </div>\
        <div className="flex items-center gap-2">\
          <div className="w-3 h-3 bg-red-500 rounded"></div>\
          <span>Cancelled</span>\
        </div>\
      </div>\
    </Card>\
  );\
\};\
\
const TimelineView = (\{ userRole \}) => \{\
  const [timelines, setTimelines] = useState([]);\
  const [loading, setLoading] = useState(true);\
  const [viewRange, setViewRange] = useState('month');\
\
  useEffect(() => \{\
    loadTimelines();\
  \}, []);\
\
  const loadTimelines = async () => \{\
    try \{\
      const timelinesData = await firebase.getProjectTimelines();\
      setTimelines(timelinesData);\
    \} catch (error) \{\
      console.error('Error loading timelines:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  const getTimelineWidth = (timeline) => \{\
    const now = new Date();\
    const rangeStart = new Date(now.getFullYear(), now.getMonth() - 2, 1);\
    const rangeEnd = new Date(now.getFullYear(), now.getMonth() + 4, 0);\
    const totalDays = Math.ceil((rangeEnd - rangeStart) / (1000 * 60 * 60 * 24));\
    \
    const projectStart = Math.max(timeline.startDate.getTime(), rangeStart.getTime());\
    const projectEnd = Math.min(timeline.endDate.getTime(), rangeEnd.getTime());\
    const projectDays = Math.ceil((projectEnd - projectStart) / (1000 * 60 * 60 * 24));\
    \
    const startOffset = Math.ceil((projectStart - rangeStart.getTime()) / (1000 * 60 * 60 * 24));\
    \
    return \{\
      width: `$\{(projectDays / totalDays) * 100\}%`,\
      left: `$\{(startOffset / totalDays) * 100\}%`\
    \};\
  \};\
\
  const getStatusColor = (status) => \{\
    switch (status) \{\
      case 'completed': return 'bg-green-500';\
      case 'in-progress': return 'bg-blue-500';\
      case 'pending': return 'bg-yellow-500';\
      case 'cancelled': return 'bg-red-500';\
      default: return 'bg-gray-500';\
    \}\
  \};\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading timeline...</div>\
    </div>;\
  \}\
\
  return (\
    <Card className="p-6">\
      <div className="flex items-center justify-between mb-6">\
        <h3 className="text-lg font-semibold text-gray-900">Project Timeline View</h3>\
        <select\
          value=\{viewRange\}\
          onChange=\{(e) => setViewRange(e.target.value)\}\
          className="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
        >\
          <option value="week">This Week</option>\
          <option value="month">This Month</option>\
          <option value="quarter">This Quarter</option>\
        </select>\
      </div>\
\
      \{/* Timeline Header */\}\
      <div className="grid grid-cols-12 gap-2 mb-4 text-xs text-gray-500 border-b pb-2">\
        \{Array.from(\{ length: 12 \}, (_, i) => \{\
          const date = new Date();\
          date.setMonth(date.getMonth() - 2 + i);\
          return (\
            <div key=\{i\} className="text-center">\
              \{date.toLocaleDateString('en-US', \{ month: 'short' \})\}\
            </div>\
          );\
        \})\}\
      </div>\
\
      \{/* Timeline Items */\}\
      <div className="space-y-4">\
        \{timelines.map(timeline => \{\
          const \{ width, left \} = getTimelineWidth(timeline);\
          \
          return (\
            <div key=\{timeline.id\} className="flex items-center gap-4">\
              \{/* Project Info */\}\
              <div className="w-64 flex-shrink-0">\
                <h4 className="font-medium text-gray-900 truncate">\{timeline.title\}</h4>\
                <p className="text-sm text-gray-600">\{timeline.client\}</p>\
                <div className="flex items-center gap-2 mt-1">\
                  <Badge variant="default" className=\{getStatusColor(timeline.status)\}>\
                    \{timeline.status\}\
                  </Badge>\
                  <span className="text-xs text-gray-500">\{timeline.progress\}%</span>\
                </div>\
              </div>\
\
              \{/* Timeline Bar */\}\
              <div className="flex-1 relative h-8 bg-gray-100 rounded-lg overflow-hidden">\
                <div\
                  className=\{`absolute top-0 h-full rounded-lg $\{getStatusColor(timeline.status)\} opacity-80`\}\
                  style=\{\{ width, left \}\}\
                >\
                  <div\
                    className="h-full bg-green-500 rounded-lg"\
                    style=\{\{ width: `$\{timeline.progress\}%` \}\}\
                  />\
                </div>\
                \
                \{/* Events markers */\}\
                \{timeline.events.map(event => \{\
                  const eventDate = new Date(event.startTime);\
                  const now = new Date();\
                  const rangeStart = new Date(now.getFullYear(), now.getMonth() - 2, 1);\
                  const totalDays = 180; // 6 months\
                  const eventDays = Math.ceil((eventDate - rangeStart) / (1000 * 60 * 60 * 24));\
                  const eventLeft = `$\{(eventDays / totalDays) * 100\}%`;\
                  \
                  return (\
                    <div\
                      key=\{event.id\}\
                      className="absolute top-0 w-1 h-full bg-red-500"\
                      style=\{\{ left: eventLeft \}\}\
                      title=\{event.title\}\
                    />\
                  );\
                \})\}\
              </div>\
\
              \{/* Duration */\}\
              <div className="w-20 text-sm text-gray-600 text-right">\
                \{timeline.duration\} days\
              </div>\
            </div>\
          );\
        \})\}\
      </div>\
\
      \{timelines.length === 0 && (\
        <div className="text-center py-12">\
          <Calendar className="w-12 h-12 text-gray-400 mx-auto mb-4" />\
          <h3 className="text-lg font-medium text-gray-900 mb-2">No projects to display</h3>\
          <p className="text-gray-600">Create some jobs to see project timelines</p>\
        </div>\
      )\}\
    </Card>\
  );\
\};\
\
const EventModal = (\{ isOpen, onClose, event, onSubmit, userRole \}) => \{\
  const [formData, setFormData] = useState(\{\
    title: '',\
    jobId: '',\
    clientEmail: '',\
    clientName: '',\
    assignedTo: '',\
    contractorName: '',\
    startTime: '',\
    endTime: '',\
    location: '',\
    description: '',\
    status: 'scheduled'\
  \});\
  const [jobs, setJobs] = useState([]);\
  const [contractors, setContractors] = useState([]);\
  const [availableSlots, setAvailableSlots] = useState([]);\
  const [conflictCheck, setConflictCheck] = useState(null);\
\
  useEffect(() => \{\
    if (isOpen) \{\
      loadJobsAndContractors();\
      if (event) \{\
        setFormData(\{\
          title: event.title || '',\
          jobId: event.jobId || '',\
          clientEmail: event.clientEmail || '',\
          clientName: event.clientName || '',\
          assignedTo: event.assignedTo || '',\
          contractorName: event.contractorName || '',\
          startTime: event.startTime ? new Date(event.startTime).toISOString().slice(0, 16) : '',\
          endTime: event.endTime ? new Date(event.endTime).toISOString().slice(0, 16) : '',\
          location: event.location || '',\
          description: event.description || '',\
          status: event.status || 'scheduled'\
        \});\
      \}\
    \}\
  \}, [isOpen, event]);\
\
  useEffect(() => \{\
    if (formData.assignedTo && formData.startTime) \{\
      checkAvailability();\
    \}\
  \}, [formData.assignedTo, formData.startTime]);\
\
  const loadJobsAndContractors = async () => \{\
    try \{\
      const [jobsData, contractorsData] = await Promise.all([\
        firebase.getJobs(),\
        firebase.getContractors()\
      ]);\
      setJobs(jobsData);\
      setContractors(contractorsData);\
    \} catch (error) \{\
      console.error('Error loading data:', error);\
    \}\
  \};\
\
  const checkAvailability = async () => \{\
    if (!formData.assignedTo || !formData.startTime) return;\
\
    try \{\
      const startDate = new Date(formData.startTime);\
      const slots = await firebase.getAvailableTimeSlots(\
        formData.assignedTo, \
        startDate.toDateString()\
      );\
      setAvailableSlots(slots);\
\
      // Check for conflicts\
      const conflicts = await firebase.checkScheduleConflicts(\{\
        ...formData,\
        id: event?.id,\
        startTime: formData.startTime,\
        endTime: formData.endTime\
      \});\
      setConflictCheck(conflicts);\
    \} catch (error) \{\
      console.error('Error checking availability:', error);\
    \}\
  \};\
\
  const handleJobChange = (jobId) => \{\
    const selectedJob = jobs.find(job => job.id === parseInt(jobId));\
    if (selectedJob) \{\
      setFormData(prev => (\{\
        ...prev,\
        jobId,\
        title: selectedJob.title,\
        clientEmail: selectedJob.clientEmail,\
        clientName: selectedJob.client,\
        assignedTo: selectedJob.contractorEmail || '',\
        contractorName: selectedJob.contractor || ''\
      \}));\
    \}\
  \};\
\
  const handleContractorChange = (contractorEmail) => \{\
    const selectedContractor = contractors.find(c => c.email === contractorEmail);\
    if (selectedContractor) \{\
      setFormData(prev => (\{\
        ...prev,\
        assignedTo: contractorEmail,\
        contractorName: selectedContractor.name\
      \}));\
    \}\
  \};\
\
  const handleSubmit = (e) => \{\
    e.preventDefault();\
    \
    if (conflictCheck && conflictCheck.length > 0) \{\
      alert('Schedule conflict detected. Please choose a different time.');\
      return;\
    \}\
\
    const eventData = \{\
      ...formData,\
      startTime: new Date(formData.startTime).toISOString(),\
      endTime: new Date(formData.endTime).toISOString()\
    \};\
\
    if (event) \{\
      onSubmit(event.id, eventData);\
    \} else \{\
      onSubmit(eventData);\
    \}\
    \
    onClose();\
  \};\
\
  const setEndTimeFromStart = (startTime) => \{\
    if (startTime) \{\
      const start = new Date(startTime);\
      const end = new Date(start.getTime() + (2 * 60 * 60 * 1000)); // Add 2 hours\
      setFormData(prev => (\{\
        ...prev,\
        startTime,\
        endTime: end.toISOString().slice(0, 16)\
      \}));\
    \}\
  \};\
\
  return (\
    <Modal isOpen=\{isOpen\} onClose=\{onClose\} title=\{event ? 'Edit Appointment' : 'Schedule New Appointment'\}>\
      <form onSubmit=\{handleSubmit\} className="space-y-4">\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">\
            Related Job (optional)\
          </label>\
          <select\
            value=\{formData.jobId\}\
            onChange=\{(e) => handleJobChange(e.target.value)\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
          >\
            <option value="">Select a job</option>\
            \{jobs.map(job => (\
              <option key=\{job.id\} value=\{job.id\}>\{job.title\} - \{job.client\}</option>\
            ))\}\
          </select>\
        </div>\
\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">\
            Title\
          </label>\
          <input\
            type="text"\
            value=\{formData.title\}\
            onChange=\{(e) => setFormData(prev => (\{ ...prev, title: e.target.value \}))\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            required\
          />\
        </div>\
\
        <div className="grid grid-cols-2 gap-4">\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Client Name\
            </label>\
            <input\
              type="text"\
              value=\{formData.clientName\}\
              onChange=\{(e) => setFormData(prev => (\{ ...prev, clientName: e.target.value \}))\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              required\
            />\
          </div>\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Client Email\
            </label>\
            <input\
              type="email"\
              value=\{formData.clientEmail\}\
              onChange=\{(e) => setFormData(prev => (\{ ...prev, clientEmail: e.target.value \}))\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              required\
            />\
          </div>\
        </div>\
\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">\
            Assigned Contractor\
          </label>\
          <select\
            value=\{formData.assignedTo\}\
            onChange=\{(e) => handleContractorChange(e.target.value)\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            required\
          >\
            <option value="">Select contractor</option>\
            \{contractors.map(contractor => (\
              <option key=\{contractor.id\} value=\{contractor.email\}>\{contractor.name\}</option>\
            ))\}\
          </select>\
        </div>\
\
        <div className="grid grid-cols-2 gap-4">\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Start Time\
            </label>\
            <input\
              type="datetime-local"\
              value=\{formData.startTime\}\
              onChange=\{(e) => setEndTimeFromStart(e.target.value)\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              required\
            />\
          </div>\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              End Time\
            </label>\
            <input\
              type="datetime-local"\
              value=\{formData.endTime\}\
              onChange=\{(e) => setFormData(prev => (\{ ...prev, endTime: e.target.value \}))\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              required\
            />\
          </div>\
        </div>\
\
        \{/* Availability Check */\}\
        \{conflictCheck && conflictCheck.length > 0 && (\
          <div className="p-3 bg-red-50 border border-red-200 rounded-lg">\
            <div className="flex items-center gap-2 text-red-800">\
              <AlertCircle className="w-4 h-4" />\
              <span className="font-medium">Schedule Conflict Detected</span>\
            </div>\
            <p className="text-sm text-red-700 mt-1">\
              Contractor has another appointment at this time. Please choose a different slot.\
            </p>\
          </div>\
        )\}\
\
        \{/* Available Slots */\}\
        \{availableSlots.length > 0 && formData.assignedTo && (\
          <div className="p-3 bg-green-50 border border-green-200 rounded-lg">\
            <h4 className="font-medium text-green-800 mb-2">Available Time Slots</h4>\
            <div className="grid grid-cols-2 gap-2">\
              \{availableSlots.slice(0, 6).map((slot, index) => (\
                <button\
                  key=\{index\}\
                  type="button"\
                  onClick=\{() => \{\
                    setFormData(prev => (\{\
                      ...prev,\
                      startTime: slot.start.toISOString().slice(0, 16),\
                      endTime: slot.end.toISOString().slice(0, 16)\
                    \}));\
                  \}\}\
                  className="text-sm px-3 py-2 bg-green-100 text-green-800 rounded hover:bg-green-200 transition-colors"\
                >\
                  \{slot.start.toLocaleTimeString([], \{ hour: '2-digit', minute: '2-digit' \})\} - \{slot.end.toLocaleTimeString([], \{ hour: '2-digit', minute: '2-digit' \})\}\
                </button>\
              ))\}\
            </div>\
          </div>\
        )\}\
\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">\
            Location\
          </label>\
          <input\
            type="text"\
            value=\{formData.location\}\
            onChange=\{(e) => setFormData(prev => (\{ ...prev, location: e.target.value \}))\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            placeholder="Office address or 'Remote'"\
            required\
          />\
        </div>\
\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">\
            Status\
          </label>\
          <select\
            value=\{formData.status\}\
            onChange=\{(e) => setFormData(prev => (\{ ...prev, status: e.target.value \}))\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
          >\
            <option value="scheduled">Scheduled</option>\
            <option value="in-progress">In Progress</option>\
            <option value="completed">Completed</option>\
            <option value="cancelled">Cancelled</option>\
          </select>\
        </div>\
\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">\
            Description\
          </label>\
          <textarea\
            value=\{formData.description\}\
            onChange=\{(e) => setFormData(prev => (\{ ...prev, description: e.target.value \}))\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            rows=\{3\}\
            placeholder="Additional details about the appointment..."\
          />\
        </div>\
\
        <div className="flex gap-3 pt-4">\
          <Button \
            type="submit" \
            className="flex-1"\
            disabled=\{conflictCheck && conflictCheck.length > 0\}\
          >\
            \{event ? 'Update' : 'Schedule'\} Appointment\
          </Button>\
          <Button type="button" variant="secondary" onClick=\{onClose\}>\
            Cancel\
          </Button>\
        </div>\
      </form>\
    </Modal>\
  );\
\};\
\
// Client Booking Portal\
const ClientBookingView = () => \{\
  const \{ user \} = useAuth();\
  const [selectedService, setSelectedService] = useState('');\
  const [selectedContractor, setSelectedContractor] = useState('');\
  const [selectedDate, setSelectedDate] = useState('');\
  const [availableSlots, setAvailableSlots] = useState([]);\
  const [selectedSlot, setSelectedSlot] = useState(null);\
  const [bookingDetails, setBookingDetails] = useState(\{\
    title: '',\
    description: '',\
    location: '',\
    urgency: 'normal'\
  \});\
  const [contractors, setContractors] = useState([]);\
  const [loading, setLoading] = useState(false);\
\
  const services = [\
    \{ id: 'network', name: 'Network Setup & Configuration', duration: 4 \},\
    \{ id: 'security', name: 'Security Audit & Assessment', duration: 6 \},\
    \{ id: 'maintenance', name: 'System Maintenance', duration: 2 \},\
    \{ id: 'consulting', name: 'IT Consultation', duration: 1 \},\
    \{ id: 'support', name: 'Technical Support', duration: 2 \},\
    \{ id: 'cloud', name: 'Cloud Migration', duration: 8 \}\
  ];\
\
  useEffect(() => \{\
    loadContractors();\
  \}, []);\
\
  useEffect(() => \{\
    if (selectedContractor && selectedDate) \{\
      loadAvailableSlots();\
    \}\
  \}, [selectedContractor, selectedDate]);\
\
  const loadContractors = async () => \{\
    try \{\
      const contractorsData = await firebase.getContractors();\
      setContractors(contractorsData);\
    \} catch (error) \{\
      console.error('Error loading contractors:', error);\
    \}\
  \};\
\
  const loadAvailableSlots = async () => \{\
    if (!selectedContractor || !selectedDate) return;\
    \
    setLoading(true);\
    try \{\
      const service = services.find(s => s.id === selectedService);\
      const duration = service?.duration || 2;\
      \
      const slots = await firebase.getAvailableTimeSlots(\
        selectedContractor,\
        selectedDate,\
        duration\
      );\
      setAvailableSlots(slots);\
    \} catch (error) \{\
      console.error('Error loading available slots:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  const handleBookAppointment = async () => \{\
    if (!selectedSlot || !selectedService) \{\
      alert('Please select a service and time slot');\
      return;\
    \}\
\
    const service = services.find(s => s.id === selectedService);\
    const contractor = contractors.find(c => c.email === selectedContractor);\
\
    try \{\
      const appointmentData = \{\
        title: `$\{service.name\} - $\{bookingDetails.title\}`,\
        jobId: null,\
        clientEmail: user?.email,\
        clientName: user?.displayName || user?.email,\
        assignedTo: selectedContractor,\
        contractorName: contractor?.name,\
        startTime: selectedSlot.start.toISOString(),\
        endTime: selectedSlot.end.toISOString(),\
        location: bookingDetails.location || 'To be determined',\
        description: `$\{service.name\}\\n\\nClient Notes: $\{bookingDetails.description\}`,\
        status: 'scheduled'\
      \};\
\
      await firebase.createScheduleEvent(appointmentData);\
      \
      // Reset form\
      setSelectedService('');\
      setSelectedContractor('');\
      setSelectedDate('');\
      setSelectedSlot(null);\
      setBookingDetails(\{\
        title: '',\
        description: '',\
        location: '',\
        urgency: 'normal'\
      \});\
\
      alert('Appointment booked successfully! You will receive a confirmation shortly.');\
    \} catch (error) \{\
      console.error('Error booking appointment:', error);\
      alert(error.message || 'Failed to book appointment. Please try again.');\
    \}\
  \};\
\
  return (\
    <div className="max-w-4xl mx-auto space-y-8">\
      <div className="text-center">\
        <h2 className="text-3xl font-bold text-gray-900 mb-4">Book Your IT Service</h2>\
        <p className="text-gray-600">Schedule an appointment with our expert technicians</p>\
      </div>\
\
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">\
        \{/* Service Selection */\}\
        <Card className="p-6">\
          <h3 className="text-lg font-semibold text-gray-900 mb-4">1. Select Service</h3>\
          <div className="space-y-3">\
            \{services.map(service => (\
              <button\
                key=\{service.id\}\
                onClick=\{() => setSelectedService(service.id)\}\
                className=\{`w-full text-left p-3 border rounded-lg transition-colors $\{\
                  selectedService === service.id\
                    ? 'border-[#3B0A69] bg-purple-50'\
                    : 'border-gray-200 hover:border-gray-300'\
                \}`\}\
              >\
                <div className="font-medium text-gray-900">\{service.name\}</div>\
                <div className="text-sm text-gray-500">~\{service.duration\} hours</div>\
              </button>\
            ))\}\
          </div>\
        </Card>\
\
        \{/* Contractor & Date Selection */\}\
        <Card className="p-6">\
          <h3 className="text-lg font-semibold text-gray-900 mb-4">2. Choose Date & Technician</h3>\
          <div className="space-y-4">\
            <div>\
              <label className="block text-sm font-medium text-gray-700 mb-2">\
                Preferred Technician\
              </label>\
              <select\
                value=\{selectedContractor\}\
                onChange=\{(e) => setSelectedContractor(e.target.value)\}\
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              >\
                <option value="">Any available technician</option>\
                \{contractors.map(contractor => (\
                  <option key=\{contractor.id\} value=\{contractor.email\}>\
                    \{contractor.name\} - \{contractor.specialties.join(', ')\}\
                  </option>\
                ))\}\
              </select>\
            </div>\
\
            <div>\
              <label className="block text-sm font-medium text-gray-700 mb-2">\
                Preferred Date\
              </label>\
              <input\
                type="date"\
                value=\{selectedDate\}\
                onChange=\{(e) => setSelectedDate(e.target.value)\}\
                min=\{new Date().toISOString().split('T')[0]\}\
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              />\
            </div>\
\
            \{loading && (\
              <div className="text-center py-4">\
                <div className="text-sm text-gray-600">Loading available times...</div>\
              </div>\
            )\}\
\
            \{availableSlots.length > 0 && (\
              <div>\
                <label className="block text-sm font-medium text-gray-700 mb-2">\
                  Available Time Slots\
                </label>\
                <div className="grid grid-cols-2 gap-2">\
                  \{availableSlots.map((slot, index) => (\
                    <button\
                      key=\{index\}\
                      onClick=\{() => setSelectedSlot(slot)\}\
                      className=\{`text-sm px-3 py-2 border rounded-lg transition-colors $\{\
                        selectedSlot === slot\
                          ? 'border-[#3B0A69] bg-purple-50 text-[#3B0A69]'\
                          : 'border-gray-200 hover:border-gray-300'\
                      \}`\}\
                    >\
                      \{slot.start.toLocaleTimeString([], \{ \
                        hour: '2-digit', \
                        minute: '2-digit' \
                      \})\}\
                    </button>\
                  ))\}\
                </div>\
              </div>\
            )\}\
          </div>\
        </Card>\
\
        \{/* Booking Details */\}\
        <Card className="p-6">\
          <h3 className="text-lg font-semibold text-gray-900 mb-4">3. Booking Details</h3>\
          <div className="space-y-4">\
            <div>\
              <label className="block text-sm font-medium text-gray-700 mb-2">\
                Brief Title\
              </label>\
              <input\
                type="text"\
                value=\{bookingDetails.title\}\
                onChange=\{(e) => setBookingDetails(prev => (\{ ...prev, title: e.target.value \}))\}\
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
                placeholder="e.g., Office network setup"\
              />\
            </div>\
\
            <div>\
              <label className="block text-sm font-medium text-gray-700 mb-2">\
                Location\
              </label>\
              <input\
                type="text"\
                value=\{bookingDetails.location\}\
                onChange=\{(e) => setBookingDetails(prev => (\{ ...prev, location: e.target.value \}))\}\
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
                placeholder="Your office address"\
              />\
            </div>\
\
            <div>\
              <label className="block text-sm font-medium text-gray-700 mb-2">\
                Urgency\
              </label>\
              <select\
                value=\{bookingDetails.urgency\}\
                onChange=\{(e) => setBookingDetails(prev => (\{ ...prev, urgency: e.target.value \}))\}\
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              >\
                <option value="low">Low - Can wait</option>\
                <option value="normal">Normal - Standard timing</option>\
                <option value="high">High - Urgent</option>\
                <option value="critical">Critical - Emergency</option>\
              </select>\
            </div>\
\
            <div>\
              <label className="block text-sm font-medium text-gray-700 mb-2">\
                Additional Details\
              </label>\
              <textarea\
                value=\{bookingDetails.description\}\
                onChange=\{(e) => setBookingDetails(prev => (\{ ...prev, description: e.target.value \}))\}\
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
                rows=\{3\}\
                placeholder="Describe your requirements..."\
              />\
            </div>\
\
            <Button\
              onClick=\{handleBookAppointment\}\
              className="w-full"\
              disabled=\{!selectedService || !selectedSlot\}\
            >\
              <Calendar className="w-4 h-4" />\
              Book Appointment\
            </Button>\
          </div>\
        </Card>\
      </div>\
    </div>\
  );\
\};// Advanced Analytics Dashboard\
const AnalyticsView = () => \{\
  const [analyticsData, setAnalyticsData] = useState(null);\
  const [loading, setLoading] = useState(true);\
  const [timeRange, setTimeRange] = useState('12m');\
\
  useEffect(() => \{\
    loadAnalyticsData();\
  \}, [timeRange]);\
\
  const loadAnalyticsData = async () => \{\
    try \{\
      const data = await firebase.getAnalyticsData();\
      setAnalyticsData(data);\
    \} catch (error) \{\
      console.error('Error loading analytics:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading analytics...</div>\
    </div>;\
  \}\
\
  return (\
    <div className="space-y-8">\
      \{/* Header */\}\
      <div className="flex justify-between items-center">\
        <div>\
          <h2 className="text-2xl font-bold text-gray-900">Business Analytics</h2>\
          <p className="text-gray-600">Comprehensive insights into your business performance</p>\
        </div>\
        <select\
          value=\{timeRange\}\
          onChange=\{(e) => setTimeRange(e.target.value)\}\
          className="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
        >\
          <option value="1m">Last Month</option>\
          <option value="3m">Last 3 Months</option>\
          <option value="6m">Last 6 Months</option>\
          <option value="12m">Last 12 Months</option>\
        </select>\
      </div>\
\
      \{/* Key Metrics */\}\
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">\
        <MetricCard\
          title="Total Revenue"\
          value=\{`$\{analyticsData.totalRevenue.toLocaleString()\}`\}\
          change="+23.5%"\
          icon=\{DollarSign\}\
          color="green"\
        />\
        <MetricCard\
          title="Average Job Value"\
          value=\{`$\{analyticsData.averageJobValue.toLocaleString()\}`\}\
          change="+12.3%"\
          icon=\{TrendingUp\}\
          color="blue"\
        />\
        <MetricCard\
          title="Client Retention"\
          value=\{`$\{analyticsData.clientRetentionRate\}%`\}\
          change="+4.2%"\
          icon=\{Users\}\
          color="purple"\
        />\
        <MetricCard\
          title="Avg Response Time"\
          value=\{`$\{analyticsData.averageResponseTime\}h`\}\
          change="-15.3%"\
          icon=\{Clock\}\
          color="yellow"\
        />\
      </div>\
\
      \{/* Charts Row 1 */\}\
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">\
        \{/* Revenue Chart */\}\
        <Card className="p-6">\
          <div className="flex items-center justify-between mb-6">\
            <h3 className="text-lg font-semibold text-gray-900">Revenue Trend</h3>\
            <Badge variant="success">+23.5% vs last year</Badge>\
          </div>\
          <div className="h-80">\
            <ResponsiveContainer width="100%" height="100%">\
              <LineChart data=\{analyticsData.monthlyRevenue\}>\
                <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />\
                <XAxis \
                  dataKey="month" \
                  stroke="#6b7280"\
                  fontSize=\{12\}\
                />\
                <YAxis \
                  stroke="#6b7280"\
                  fontSize=\{12\}\
                  tickFormatter=\{(value) => `$\{(value / 1000).toFixed(0)\}k`\}\
                />\
                <Tooltip \
                  formatter=\{(value) => [`$\{value.toLocaleString()\}`, 'Revenue']\}\
                  labelStyle=\{\{ color: '#374151' \}\}\
                  contentStyle=\{\{ \
                    backgroundColor: 'white',\
                    border: '1px solid #e5e7eb',\
                    borderRadius: '8px'\
                  \}\}\
                />\
                <Line \
                  type="monotone" \
                  dataKey="revenue" \
                  stroke="#3B0A69" \
                  strokeWidth=\{3\}\
                  dot=\{\{ fill: '#3B0A69', strokeWidth: 2, r: 4 \}\}\
                  activeDot=\{\{ r: 6, stroke: '#3B0A69', strokeWidth: 2 \}\}\
                />\
              </LineChart>\
            </ResponsiveContainer>\
          </div>\
        </Card>\
\
        \{/* Job Status Distribution */\}\
        <Card className="p-6">\
          <div className="flex items-center justify-between mb-6">\
            <h3 className="text-lg font-semibold text-gray-900">Job Status Distribution</h3>\
          </div>\
          <div className="h-80">\
            <ResponsiveContainer width="100%" height="100%">\
              <PieChart>\
                <Pie\
                  data=\{analyticsData.jobStatusData\}\
                  cx="50%"\
                  cy="50%"\
                  innerRadius=\{60\}\
                  outerRadius=\{120\}\
                  paddingAngle=\{5\}\
                  dataKey="count"\
                  label=\{(\{ status, count \}) => `$\{status\}: $\{count\}`\}\
                >\
                  \{analyticsData.jobStatusData.map((entry, index) => (\
                    <Cell key=\{`cell-$\{index\}`\} fill=\{entry.color\} />\
                  ))\}\
                </Pie>\
                <Tooltip \
                  formatter=\{(value) => [value, 'Jobs']\}\
                  contentStyle=\{\{ \
                    backgroundColor: 'white',\
                    border: '1px solid #e5e7eb',\
                    borderRadius: '8px'\
                  \}\}\
                />\
              </PieChart>\
            </ResponsiveContainer>\
          </div>\
        </Card>\
      </div>\
\
      \{/* Charts Row 2 */\}\
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">\
        \{/* Client Satisfaction */\}\
        <Card className="p-6">\
          <div className="flex items-center justify-between mb-6">\
            <h3 className="text-lg font-semibold text-gray-900">Client Satisfaction</h3>\
            <Badge variant="success">4.7/5.0 Average</Badge>\
          </div>\
          <div className="h-80">\
            <ResponsiveContainer width="100%" height="100%">\
              <AreaChart data=\{analyticsData.clientSatisfaction\}>\
                <defs>\
                  <linearGradient id="satisfactionGradient" x1="0" y1="0" x2="0" y2="1">\
                    <stop offset="5%" stopColor="#10B981" stopOpacity=\{0.8\}/>\
                    <stop offset="95%" stopColor="#10B981" stopOpacity=\{0.1\}/>\
                  </linearGradient>\
                </defs>\
                <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />\
                <XAxis \
                  dataKey="month" \
                  stroke="#6b7280"\
                  fontSize=\{12\}\
                />\
                <YAxis \
                  domain=\{[3.5, 5]\}\
                  stroke="#6b7280"\
                  fontSize=\{12\}\
                />\
                <Tooltip \
                  formatter=\{(value) => [value.toFixed(1), 'Score']\}\
                  contentStyle=\{\{ \
                    backgroundColor: 'white',\
                    border: '1px solid #e5e7eb',\
                    borderRadius: '8px'\
                  \}\}\
                />\
                <Area \
                  type="monotone" \
                  dataKey="score" \
                  stroke="#10B981" \
                  strokeWidth=\{2\}\
                  fillOpacity=\{1\} \
                  fill="url(#satisfactionGradient)" \
                />\
              </AreaChart>\
            </ResponsiveContainer>\
          </div>\
        </Card>\
\
        \{/* Contractor Performance */\}\
        <Card className="p-6">\
          <div className="flex items-center justify-between mb-6">\
            <h3 className="text-lg font-semibold text-gray-900">Contractor Performance</h3>\
          </div>\
          <div className="h-80">\
            <ResponsiveContainer width="100%" height="100%">\
              <BarChart data=\{analyticsData.contractorPerformance\}>\
                <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />\
                <XAxis \
                  dataKey="name" \
                  stroke="#6b7280"\
                  fontSize=\{12\}\
                />\
                <YAxis \
                  stroke="#6b7280"\
                  fontSize=\{12\}\
                />\
                <Tooltip \
                  formatter=\{(value, name) => [\
                    name === 'completedJobs' ? value : `$\{value.toFixed(1)\}%`,\
                    name === 'completedJobs' ? 'Completed Jobs' : 'Efficiency'\
                  ]\}\
                  contentStyle=\{\{ \
                    backgroundColor: 'white',\
                    border: '1px solid #e5e7eb',\
                    borderRadius: '8px'\
                  \}\}\
                />\
                <Bar dataKey="completedJobs" fill="#3B0A69" name="completedJobs" />\
                <Bar dataKey="efficiency" fill="#8B5CF6" name="efficiency" />\
              </BarChart>\
            </ResponsiveContainer>\
          </div>\
        </Card>\
      </div>\
\
      \{/* Performance Table */\}\
      <Card className="p-6">\
        <h3 className="text-lg font-semibold text-gray-900 mb-6">Contractor Detailed Performance</h3>\
        <div className="overflow-x-auto">\
          <table className="w-full">\
            <thead className="bg-gray-50 border-b border-gray-200">\
              <tr>\
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Contractor</th>\
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Completed Jobs</th>\
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Rating</th>\
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Efficiency</th>\
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>\
              </tr>\
            </thead>\
            <tbody className="divide-y divide-gray-200">\
              \{analyticsData.contractorPerformance.map((contractor, index) => (\
                <tr key=\{index\} className="hover:bg-gray-50">\
                  <td className="px-6 py-4 whitespace-nowrap">\
                    <div className="font-medium text-gray-900">\{contractor.name\}</div>\
                  </td>\
                  <td className="px-6 py-4 whitespace-nowrap text-gray-900">\
                    \{contractor.completedJobs\}\
                  </td>\
                  <td className="px-6 py-4 whitespace-nowrap">\
                    <div className="flex items-center gap-1">\
                      <Star className="w-4 h-4 text-yellow-400 fill-current" />\
                      <span className="text-gray-900">\{contractor.rating\}</span>\
                    </div>\
                  </td>\
                  <td className="px-6 py-4 whitespace-nowrap">\
                    <div className="flex items-center gap-2">\
                      <div className="flex-1 bg-gray-200 rounded-full h-2">\
                        <div \
                          className="bg-green-500 h-2 rounded-full"\
                          style=\{\{ width: `$\{contractor.efficiency\}%` \}\}\
                        />\
                      </div>\
                      <span className="text-sm text-gray-600">\{contractor.efficiency.toFixed(1)\}%</span>\
                    </div>\
                  </td>\
                  <td className="px-6 py-4 whitespace-nowrap">\
                    <Badge variant=\{contractor.efficiency > 90 ? 'success' : contractor.efficiency > 80 ? 'warning' : 'danger'\}>\
                      \{contractor.efficiency > 90 ? 'Excellent' : contractor.efficiency > 80 ? 'Good' : 'Needs Improvement'\}\
                    </Badge>\
                  </td>\
                </tr>\
              ))\}\
            </tbody>\
          </table>\
        </div>\
      </Card>\
    </div>\
  );\
\};\
\
// File Management Components\
const FileManagementView = () => \{\
  const \{ user \} = useAuth();\
  const [files, setFiles] = useState([]);\
  const [loading, setLoading] = useState(true);\
  const [showUpload, setShowUpload] = useState(false);\
  const [filter, setFilter] = useState('all');\
  const [searchTerm, setSearchTerm] = useState('');\
\
  useEffect(() => \{\
    loadFiles();\
    initializeDefaultFiles();\
  \}, [user, filter]);\
\
  const initializeDefaultFiles = async () => \{\
    await firebase.initializeDefaultFiles();\
  \};\
\
  const loadFiles = async () => \{\
    try \{\
      let filters = \{\};\
      \
      if (user?.role === 'client') \{\
        filters.clientEmail = user.email;\
      \} else if (user?.role === 'contractor') \{\
        filters.uploadedBy = user.email;\
      \}\
\
      const filesData = await firebase.getFiles(filters);\
      setFiles(filesData);\
    \} catch (error) \{\
      console.error('Error loading files:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  const handleFileUpload = async (fileData) => \{\
    try \{\
      await firebase.uploadFile(\{\
        ...fileData,\
        uploadedBy: user?.email\
      \});\
      loadFiles();\
    \} catch (error) \{\
      console.error('Error uploading file:', error);\
    \}\
  \};\
\
  const handleDeleteFile = async (fileId) => \{\
    try \{\
      await firebase.deleteFile(fileId);\
      loadFiles();\
    \} catch (error) \{\
      console.error('Error deleting file:', error);\
    \}\
  \};\
\
  const filteredFiles = files.filter(file => \{\
    const matchesSearch = file.name.toLowerCase().includes(searchTerm.toLowerCase());\
    const matchesFilter = filter === 'all' || file.category === filter;\
    return matchesSearch && matchesFilter;\
  \});\
\
  const getFileIcon = (type) => \{\
    if (type.includes('pdf')) return <FileText className="w-5 h-5 text-red-500" />;\
    if (type.includes('image')) return <Upload className="w-5 h-5 text-green-500" />;\
    if (type.includes('json') || type.includes('xml')) return <Settings className="w-5 h-5 text-blue-500" />;\
    return <FileText className="w-5 h-5 text-gray-500" />;\
  \};\
\
  const getCategoryColor = (category) => \{\
    switch (category) \{\
      case 'documentation': return 'bg-blue-100 text-blue-800';\
      case 'reports': return 'bg-green-100 text-green-800';\
      case 'configuration': return 'bg-purple-100 text-purple-800';\
      default: return 'bg-gray-100 text-gray-800';\
    \}\
  \};\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading files...</div>\
    </div>;\
  \}\
\
  return (\
    <div className="space-y-6">\
      \{/* Header */\}\
      <div className="flex justify-between items-center">\
        <div>\
          <h2 className="text-2xl font-bold text-gray-900">File Management</h2>\
          <p className="text-gray-600">Organize and share project documents securely</p>\
        </div>\
        <Button onClick=\{() => setShowUpload(true)\}>\
          <Upload className="w-4 h-4" />\
          Upload File\
        </Button>\
      </div>\
\
      \{/* Filters */\}\
      <Card className="p-4">\
        <div className="flex flex-col sm:flex-row gap-4">\
          <div className="flex-1">\
            <div className="relative">\
              <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />\
              <input\
                type="text"\
                placeholder="Search files..."\
                value=\{searchTerm\}\
                onChange=\{(e) => setSearchTerm(e.target.value)\}\
                className="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              />\
            </div>\
          </div>\
          <select\
            value=\{filter\}\
            onChange=\{(e) => setFilter(e.target.value)\}\
            className="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
          >\
            <option value="all">All Categories</option>\
            <option value="documentation">Documentation</option>\
            <option value="reports">Reports</option>\
            <option value="configuration">Configuration</option>\
          </select>\
        </div>\
      </Card>\
\
      \{/* File Statistics */\}\
      <div className="grid grid-cols-1 md:grid-cols-4 gap-6">\
        <MetricCard\
          title="Total Files"\
          value=\{files.length.toString()\}\
          icon=\{FileText\}\
          color="blue"\
        />\
        <MetricCard\
          title="Documentation"\
          value=\{files.filter(f => f.category === 'documentation').length.toString()\}\
          icon=\{FileText\}\
          color="green"\
        />\
        <MetricCard\
          title="Reports"\
          value=\{files.filter(f => f.category === 'reports').length.toString()\}\
          icon=\{BarChart3\}\
          color="purple"\
        />\
        <MetricCard\
          title="Configuration"\
          value=\{files.filter(f => f.category === 'configuration').length.toString()\}\
          icon=\{Settings\}\
          color="yellow"\
        />\
      </div>\
\
      \{/* Files Grid */\}\
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">\
        \{filteredFiles.map((file) => (\
          <Card key=\{file.id\} className="p-6">\
            <div className="flex items-start justify-between mb-4">\
              <div className="flex items-center gap-3">\
                \{getFileIcon(file.type)\}\
                <div className="flex-1 min-w-0">\
                  <h3 className="font-medium text-gray-900 truncate">\{file.name\}</h3>\
                  <p className="text-sm text-gray-500">\{file.size\}</p>\
                </div>\
              </div>\
              <div className="flex items-center gap-2">\
                <Button variant="ghost" size="sm">\
                  <Download className="w-4 h-4" />\
                </Button>\
                \{(user?.role === 'admin' || file.uploadedBy === user?.email) && (\
                  <Button \
                    variant="ghost" \
                    size="sm"\
                    onClick=\{() => handleDeleteFile(file.id)\}\
                  >\
                    <Trash2 className="w-4 h-4 text-red-500" />\
                  </Button>\
                )\}\
              </div>\
            </div>\
\
            <div className="space-y-2">\
              <Badge variant="default" className=\{getCategoryColor(file.category)\}>\
                \{file.category\}\
              </Badge>\
              <div className="text-sm text-gray-600">\
                <p>Uploaded by: \{file.uploadedBy\}</p>\
                <p>\{new Date(file.uploadedAt).toLocaleDateString()\}</p>\
              </div>\
            </div>\
          </Card>\
        ))\}\
      </div>\
\
      \{filteredFiles.length === 0 && (\
        <Card className="p-12 text-center">\
          <Upload className="w-12 h-12 text-gray-400 mx-auto mb-4" />\
          <h3 className="text-lg font-medium text-gray-900 mb-2">No files found</h3>\
          <p className="text-gray-600 mb-4">\
            \{searchTerm ? 'No files match your search criteria' : 'Upload your first file to get started'\}\
          </p>\
          <Button onClick=\{() => setShowUpload(true)\}>\
            <Upload className="w-4 h-4" />\
            Upload File\
          </Button>\
        </Card>\
      )\}\
\
      <FileUploadModal\
        isOpen=\{showUpload\}\
        onClose=\{() => setShowUpload(false)\}\
        onUpload=\{handleFileUpload\}\
      />\
    </div>\
  );\
\};\
\
const FileUploadModal = (\{ isOpen, onClose, onUpload \}) => \{\
  const \{ user \} = useAuth();\
  const [formData, setFormData] = useState(\{\
    name: '',\
    size: '',\
    type: '',\
    category: 'documentation',\
    jobId: '',\
    clientEmail: '',\
    description: ''\
  \});\
  const [jobs, setJobs] = useState([]);\
  const [clients, setClients] = useState([]);\
\
  useEffect(() => \{\
    if (isOpen) \{\
      loadJobsAndClients();\
    \}\
  \}, [isOpen]);\
\
  const loadJobsAndClients = async () => \{\
    try \{\
      const [jobsData, clientsData] = await Promise.all([\
        firebase.getJobs(),\
        firebase.getClients()\
      ]);\
      setJobs(jobsData);\
      setClients(clientsData);\
    \} catch (error) \{\
      console.error('Error loading data:', error);\
    \}\
  \};\
\
  const handleSubmit = (e) => \{\
    e.preventDefault();\
    onUpload(formData);\
    onClose();\
    setFormData(\{\
      name: '',\
      size: '',\
      type: '',\
      category: 'documentation',\
      jobId: '',\
      clientEmail: '',\
      description: ''\
    \});\
  \};\
\
  const handleFileChange = (e) => \{\
    const file = e.target.files[0];\
    if (file) \{\
      setFormData(prev => (\{\
        ...prev,\
        name: file.name,\
        size: `$\{(file.size / 1024 / 1024).toFixed(2)\} MB`,\
        type: file.type\
      \}));\
    \}\
  \};\
\
  return (\
    <Modal isOpen=\{isOpen\} onClose=\{onClose\} title="Upload File">\
      <form onSubmit=\{handleSubmit\} className="space-y-4">\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">\
            Select File\
          </label>\
          <input\
            type="file"\
            onChange=\{handleFileChange\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            required\
          />\
        </div>\
\
        <div className="grid grid-cols-2 gap-4">\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Category\
            </label>\
            <select\
              value=\{formData.category\}\
              onChange=\{(e) => setFormData(prev => (\{ ...prev, category: e.target.value \}))\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            >\
              <option value="documentation">Documentation</option>\
              <option value="reports">Reports</option>\
              <option value="configuration">Configuration</option>\
            </select>\
          </div>\
\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Related Job (optional)\
            </label>\
            <select\
              value=\{formData.jobId\}\
              onChange=\{(e) => setFormData(prev => (\{ ...prev, jobId: e.target.value \}))\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            >\
              <option value="">No job selected</option>\
              \{jobs.map(job => (\
                <option key=\{job.id\} value=\{job.id\}>\{job.title\}</option>\
              ))\}\
            </select>\
          </div>\
        </div>\
\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">\
            Client Access (optional)\
          </label>\
          <select\
            value=\{formData.clientEmail\}\
            onChange=\{(e) => setFormData(prev => (\{ ...prev, clientEmail: e.target.value \}))\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
          >\
            <option value="">No client access</option>\
            \{clients.map(client => (\
              <option key=\{client.id\} value=\{client.email\}>\{client.name\}</option>\
            ))\}\
          </select>\
        </div>\
\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">\
            Description\
          </label>\
          <textarea\
            value=\{formData.description\}\
            onChange=\{(e) => setFormData(prev => (\{ ...prev, description: e.target.value \}))\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            rows=\{3\}\
            placeholder="Brief description of the file..."\
          />\
        </div>\
\
        <div className="flex gap-3 pt-4">\
          <Button type="submit" className="flex-1">\
            Upload File\
          </Button>\
          <Button type="button" variant="secondary" onClick=\{onClose\}>\
            Cancel\
          </Button>\
        </div>\
      </form>\
    </Modal>\
  );\
\};\
\
// Notification Components\
const NotificationDropdown = () => \{\
  const \{ notifications, unreadCount, markAsRead, markAllAsRead \} = useNotifications();\
  const [isOpen, setIsOpen] = useState(false);\
\
  const handleNotificationClick = (notification) => \{\
    if (!notification.read) \{\
      markAsRead(notification.id);\
    \}\
  \};\
\
  const getNotificationIcon = (type) => \{\
    switch (type) \{\
      case 'message': return <MessageSquare className="w-4 h-4 text-blue-500" />;\
      case 'invoice': return <DollarSign className="w-4 h-4 text-green-500" />;\
      case 'job': return <Briefcase className="w-4 h-4 text-purple-500" />;\
      default: return <Bell className="w-4 h-4 text-gray-500" />;\
    \}\
  \};\
\
  return (\
    <div className="relative">\
      <button\
        onClick=\{() => setIsOpen(!isOpen)\}\
        className="p-2 rounded-lg hover:bg-gray-100 transition-colors relative"\
      >\
        <Bell className="w-5 h-5 text-gray-600" />\
        \{unreadCount > 0 && (\
          <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1.5 py-0.5 min-w-[18px] text-center">\
            \{unreadCount > 99 ? '99+' : unreadCount\}\
          </span>\
        )\}\
      </button>\
\
      \{isOpen && (\
        <>\
          <div \
            className="fixed inset-0 z-40"\
            onClick=\{() => setIsOpen(false)\}\
          />\
          <div className="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-gray-200 z-50">\
            <div className="p-4 border-b border-gray-200">\
              <div className="flex items-center justify-between">\
                <h3 className="font-semibold text-gray-900">Notifications</h3>\
                \{unreadCount > 0 && (\
                  <Button \
                    variant="ghost" \
                    size="sm"\
                    onClick=\{markAllAsRead\}\
                  >\
                    Mark all read\
                  </Button>\
                )\}\
              </div>\
            </div>\
\
            <div className="max-h-96 overflow-y-auto">\
              \{notifications.length === 0 ? (\
                <div className="p-8 text-center text-gray-500">\
                  <Bell className="w-8 h-8 mx-auto mb-2 text-gray-300" />\
                  <p>No notifications yet</p>\
                </div>\
              ) : (\
                notifications.map((notification) => (\
                  <div\
                    key=\{notification.id\}\
                    onClick=\{() => handleNotificationClick(notification)\}\
                    className=\{`p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer $\{\
                      !notification.read ? 'bg-blue-50' : ''\
                    \}`\}\
                  >\
                    <div className="flex items-start gap-3">\
                      \{getNotificationIcon(notification.type)\}\
                      <div className="flex-1 min-w-0">\
                        <p className=\{`text-sm $\{!notification.read ? 'font-semibold' : 'font-medium'\} text-gray-900`\}>\
                          \{notification.title\}\
                        </p>\
                        <p className="text-sm text-gray-600 mt-1">\
                          \{notification.message\}\
                        </p>\
                        <p className="text-xs text-gray-400 mt-2">\
                          \{new Date(notification.timestamp).toLocaleString()\}\
                        </p>\
                      </div>\
                      \{!notification.read && (\
                        <div className="w-2 h-2 bg-blue-500 rounded-full mt-2" />\
                      )\}\
                    </div>\
                  </div>\
                ))\
              )\}\
            </div>\
          </div>\
        </>\
      )\}\
    </div>\
  );\
\};\
\
// Add Charts import (mock implementation for this demo)\
const ResponsiveContainer = (\{ children, width, height \}) => (\
  <div style=\{\{ width, height, display: 'flex', alignItems: 'center', justifyContent: 'center' \}\}>\
    \{children\}\
  </div>\
);\
\
const LineChart = (\{ data, children \}) => (\
  <div className="w-full h-full bg-gray-50 rounded-lg flex items-center justify-center">\
    <div className="text-center text-gray-500">\
      <TrendingUp className="w-12 h-12 mx-auto mb-2" />\
      <p>Revenue Trend Chart</p>\
      <p className="text-sm">(\{data?.length || 0\} data points)</p>\
    </div>\
  </div>\
);\
\
const PieChart = (\{ children \}) => (\
  <div className="w-full h-full bg-gray-50 rounded-lg flex items-center justify-center">\
    <div className="text-center text-gray-500">\
      <BarChart3 className="w-12 h-12 mx-auto mb-2" />\
      <p>Job Status Distribution</p>\
    </div>\
  </div>\
);\
\
const AreaChart = (\{ data, children \}) => (\
  <div className="w-full h-full bg-gray-50 rounded-lg flex items-center justify-center">\
    <div className="text-center text-gray-500">\
      <Activity className="w-12 h-12 mx-auto mb-2" />\
      <p>Client Satisfaction Trend</p>\
      <p className="text-sm">(\{data?.length || 0\} data points)</p>\
    </div>\
  </div>\
);\
\
const BarChart = (\{ data, children \}) => (\
  <div className="w-full h-full bg-gray-50 rounded-lg flex items-center justify-center">\
    <div className="text-center text-gray-500">\
      <Users className="w-12 h-12 mx-auto mb-2" />\
      <p>Contractor Performance</p>\
      <p className="text-sm">(\{data?.length || 0\} contractors)</p>\
    </div>\
  </div>\
);\
\
const CartesianGrid = () => null;\
const XAxis = () => null;\
const YAxis = () => null;\
const Tooltip = () => null;\
const Line = () => null;\
const Pie = () => null;\
const Cell = () => null;\
const Area = () => null;\
const Bar = () => null;// Messaging Components\
const MessagesView = () => \{\
  const \{ user \} = useAuth();\
  const [conversations, setConversations] = useState([]);\
  const [selectedConversation, setSelectedConversation] = useState(null);\
  const [messages, setMessages] = useState([]);\
  const [newMessage, setNewMessage] = useState('');\
  const [loading, setLoading] = useState(true);\
  const [showNewConversation, setShowNewConversation] = useState(false);\
\
  useEffect(() => \{\
    loadConversations();\
    initializeDefaultMessages();\
  \}, [user]);\
\
  useEffect(() => \{\
    if (selectedConversation) \{\
      loadMessages(selectedConversation.id);\
      markAsRead(selectedConversation.id);\
    \}\
  \}, [selectedConversation]);\
\
  const initializeDefaultMessages = async () => \{\
    await firebase.initializeDefaultMessages();\
  \};\
\
  const loadConversations = async () => \{\
    try \{\
      const convData = await firebase.getConversations(user?.email);\
      setConversations(convData);\
      if (convData.length > 0 && !selectedConversation) \{\
        setSelectedConversation(convData[0]);\
      \}\
    \} catch (error) \{\
      console.error('Error loading conversations:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  const loadMessages = async (conversationId) => \{\
    try \{\
      const messagesData = await firebase.getMessages(conversationId);\
      setMessages(messagesData);\
    \} catch (error) \{\
      console.error('Error loading messages:', error);\
    \}\
  \};\
\
  const markAsRead = async (conversationId) => \{\
    await firebase.markMessagesAsRead(conversationId, user?.email);\
    loadConversations(); // Refresh to update unread counts\
  \};\
\
  const sendMessage = async () => \{\
    if (!newMessage.trim() || !selectedConversation) return;\
\
    try \{\
      const messageData = \{\
        senderId: user?.email,\
        senderName: user?.displayName || user?.email,\
        senderRole: user?.role,\
        content: newMessage.trim()\
      \};\
\
      await firebase.sendMessage(selectedConversation.id, messageData);\
      setNewMessage('');\
      loadMessages(selectedConversation.id);\
      loadConversations();\
    \} catch (error) \{\
      console.error('Error sending message:', error);\
    \}\
  \};\
\
  const formatTime = (timestamp) => \{\
    const date = new Date(timestamp);\
    const now = new Date();\
    const diffTime = Math.abs(now - date);\
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\
\
    if (diffDays === 1) \{\
      return date.toLocaleTimeString([], \{ hour: '2-digit', minute: '2-digit' \});\
    \} else if (diffDays <= 7) \{\
      return date.toLocaleDateString([], \{ weekday: 'short' \});\
    \} else \{\
      return date.toLocaleDateString([], \{ month: 'short', day: 'numeric' \});\
    \}\
  \};\
\
  const getRoleColor = (role) => \{\
    switch (role) \{\
      case 'admin': return 'bg-purple-100 text-purple-800';\
      case 'contractor': return 'bg-blue-100 text-blue-800';\
      default: return 'bg-green-100 text-green-800';\
    \}\
  \};\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading messages...</div>\
    </div>;\
  \}\
\
  return (\
    <div className="h-[calc(100vh-200px)] flex bg-white rounded-xl border border-gray-200 shadow-sm">\
      \{/* Conversations List */\}\
      <div className="w-1/3 border-r border-gray-200 flex flex-col">\
        <div className="p-4 border-b border-gray-200">\
          <div className="flex items-center justify-between mb-4">\
            <h2 className="text-lg font-semibold text-gray-900">Messages</h2>\
            <Button \
              size="sm"\
              onClick=\{() => setShowNewConversation(true)\}\
            >\
              <Plus className="w-4 h-4" />\
            </Button>\
          </div>\
          <div className="relative">\
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />\
            <input\
              type="text"\
              placeholder="Search conversations..."\
              className="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            />\
          </div>\
        </div>\
\
        <div className="flex-1 overflow-y-auto">\
          \{conversations.map((conversation) => (\
            <div\
              key=\{conversation.id\}\
              onClick=\{() => setSelectedConversation(conversation)\}\
              className=\{`p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors $\{\
                selectedConversation?.id === conversation.id ? 'bg-blue-50 border-blue-200' : ''\
              \}`\}\
            >\
              <div className="flex items-start justify-between mb-2">\
                <h3 className="font-medium text-gray-900 truncate">\{conversation.title\}</h3>\
                \{conversation.unreadCount > 0 && (\
                  <span className="ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center">\
                    \{conversation.unreadCount\}\
                  </span>\
                )\}\
              </div>\
              <p className="text-sm text-gray-600 truncate mb-1">\{conversation.lastMessage\}</p>\
              <p className="text-xs text-gray-400">\{formatTime(conversation.lastMessageTime)\}</p>\
            </div>\
          ))\}\
        </div>\
      </div>\
\
      \{/* Messages Area */\}\
      <div className="flex-1 flex flex-col">\
        \{selectedConversation ? (\
          <>\
            \{/* Chat Header */\}\
            <div className="p-4 border-b border-gray-200">\
              <h3 className="font-semibold text-gray-900">\{selectedConversation.title\}</h3>\
              <p className="text-sm text-gray-600">\
                \{selectedConversation.participants.filter(p => p !== user?.email).join(', ')\}\
              </p>\
            </div>\
\
            \{/* Messages */\}\
            <div className="flex-1 overflow-y-auto p-4 space-y-4">\
              \{messages.map((message) => (\
                <div\
                  key=\{message.id\}\
                  className=\{`flex $\{message.senderId === user?.email ? 'justify-end' : 'justify-start'\}`\}\
                >\
                  <div className=\{`max-w-xs lg:max-w-md px-4 py-2 rounded-lg $\{\
                    message.senderId === user?.email\
                      ? 'bg-[#3B0A69] text-white'\
                      : 'bg-gray-100 text-gray-900'\
                  \}`\}>\
                    \{message.senderId !== user?.email && (\
                      <div className="flex items-center gap-2 mb-1">\
                        <span className="text-xs font-medium">\{message.senderName\}</span>\
                        <Badge size="sm" variant="default" className=\{getRoleColor(message.senderRole)\}>\
                          \{message.senderRole\}\
                        </Badge>\
                      </div>\
                    )\}\
                    <p className="text-sm">\{message.content\}</p>\
                    \{message.attachments && message.attachments.length > 0 && (\
                      <div className="mt-2 space-y-1">\
                        \{message.attachments.map((attachment, index) => (\
                          <div key=\{index\} className="flex items-center gap-2 text-xs opacity-75">\
                            <Upload className="w-3 h-3" />\
                            <span>\{attachment.name\}</span>\
                            <span>(\{attachment.size\})</span>\
                          </div>\
                        ))\}\
                      </div>\
                    )\}\
                    <p className="text-xs mt-1 opacity-75">\
                      \{new Date(message.timestamp).toLocaleTimeString([], \{ \
                        hour: '2-digit', \
                        minute: '2-digit' \
                      \})\}\
                    </p>\
                  </div>\
                </div>\
              ))\}\
            </div>\
\
            \{/* Message Input */\}\
            <div className="p-4 border-t border-gray-200">\
              <div className="flex gap-2">\
                <input\
                  type="text"\
                  value=\{newMessage\}\
                  onChange=\{(e) => setNewMessage(e.target.value)\}\
                  onKeyPress=\{(e) => e.key === 'Enter' && sendMessage()\}\
                  placeholder="Type your message..."\
                  className="flex-1 px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
                />\
                <Button \
                  onClick=\{sendMessage\}\
                  disabled=\{!newMessage.trim()\}\
                >\
                  <Send className="w-4 h-4" />\
                </Button>\
              </div>\
            </div>\
          </>\
        ) : (\
          <div className="flex-1 flex items-center justify-center">\
            <div className="text-center">\
              <MessageSquare className="w-12 h-12 text-gray-400 mx-auto mb-4" />\
              <h3 className="text-lg font-medium text-gray-900 mb-2">Select a conversation</h3>\
              <p className="text-gray-600">Choose a conversation from the sidebar to start messaging</p>\
            </div>\
          </div>\
        )\}\
      </div>\
\
      <NewConversationModal \
        isOpen=\{showNewConversation\}\
        onClose=\{() => setShowNewConversation(false)\}\
        onConversationCreated=\{loadConversations\}\
      />\
    </div>\
  );\
\};\
\
const NewConversationModal = (\{ isOpen, onClose, onConversationCreated \}) => \{\
  const \{ user \} = useAuth();\
  const [title, setTitle] = useState('');\
  const [participants, setParticipants] = useState('');\
  const [jobId, setJobId] = useState('');\
  const [jobs, setJobs] = useState([]);\
\
  useEffect(() => \{\
    if (isOpen) \{\
      loadJobs();\
    \}\
  \}, [isOpen]);\
\
  const loadJobs = async () => \{\
    try \{\
      const jobsData = await firebase.getJobs();\
      setJobs(jobsData);\
    \} catch (error) \{\
      console.error('Error loading jobs:', error);\
    \}\
  \};\
\
  const handleSubmit = async (e) => \{\
    e.preventDefault();\
    \
    const participantsList = [user?.email, ...participants.split(',').map(p => p.trim())];\
    \
    try \{\
      await firebase.createConversation(participantsList, title, jobId || null);\
      onConversationCreated();\
      onClose();\
      setTitle('');\
      setParticipants('');\
      setJobId('');\
    \} catch (error) \{\
      console.error('Error creating conversation:', error);\
    \}\
  \};\
\
  return (\
    <Modal isOpen=\{isOpen\} onClose=\{onClose\} title="New Conversation">\
      <form onSubmit=\{handleSubmit\} className="space-y-4">\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">\
            Conversation Title\
          </label>\
          <input\
            type="text"\
            value=\{title\}\
            onChange=\{(e) => setTitle(e.target.value)\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            placeholder="Enter conversation title"\
            required\
          />\
        </div>\
\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">\
            Participants (comma-separated emails)\
          </label>\
          <input\
            type="text"\
            value=\{participants\}\
            onChange=\{(e) => setParticipants(e.target.value)\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            placeholder="email1@example.com, email2@example.com"\
            required\
          />\
        </div>\
\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">\
            Related Job (optional)\
          </label>\
          <select\
            value=\{jobId\}\
            onChange=\{(e) => setJobId(e.target.value)\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
          >\
            <option value="">No related job</option>\
            \{jobs.map(job => (\
              <option key=\{job.id\} value=\{job.id\}>\{job.title\}</option>\
            ))\}\
          </select>\
        </div>\
\
        <div className="flex gap-3 pt-4">\
          <Button type="submit" className="flex-1">\
            Create Conversation\
          </Button>\
          <Button type="button" variant="secondary" onClick=\{onClose\}>\
            Cancel\
          </Button>\
        </div>\
      </form>\
    </Modal>\
  );\
\};\
\
// Invoice Components\
const InvoicesView = () => \{\
  const \{ user \} = useAuth();\
  const [invoices, setInvoices] = useState([]);\
  const [loading, setLoading] = useState(true);\
  const [showCreateInvoice, setShowCreateInvoice] = useState(false);\
  const [selectedInvoice, setSelectedInvoice] = useState(null);\
  const [showInvoiceDetail, setShowInvoiceDetail] = useState(false);\
\
  useEffect(() => \{\
    loadInvoices();\
  \}, [user]);\
\
  const loadInvoices = async () => \{\
    try \{\
      let invoicesData = await firebase.getInvoices();\
      \
      // Filter based on user role\
      if (user?.role === 'client') \{\
        invoicesData = invoicesData.filter(invoice => invoice.clientEmail === user?.email);\
      \}\
      \
      setInvoices(invoicesData);\
    \} catch (error) \{\
      console.error('Error loading invoices:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  const handleCreateInvoice = async (invoiceData) => \{\
    try \{\
      await firebase.createInvoice(invoiceData);\
      loadInvoices();\
    \} catch (error) \{\
      console.error('Error creating invoice:', error);\
    \}\
  \};\
\
  const handlePayInvoice = async (invoiceId) => \{\
    try \{\
      await firebase.updateInvoiceStatus(invoiceId, 'paid', new Date().toISOString());\
      loadInvoices();\
    \} catch (error) \{\
      console.error('Error updating invoice:', error);\
    \}\
  \};\
\
  const getStatusColor = (status) => \{\
    switch (status) \{\
      case 'paid': return 'success';\
      case 'pending': return 'warning';\
      case 'overdue': return 'danger';\
      default: return 'default';\
    \}\
  \};\
\
  const getTotalAmount = () => \{\
    return invoices.reduce((sum, invoice) => sum + invoice.totalAmount, 0);\
  \};\
\
  const getPaidAmount = () => \{\
    return invoices\
      .filter(invoice => invoice.status === 'paid')\
      .reduce((sum, invoice) => sum + invoice.totalAmount, 0);\
  \};\
\
  const getPendingAmount = () => \{\
    return invoices\
      .filter(invoice => invoice.status !== 'paid')\
      .reduce((sum, invoice) => sum + invoice.totalAmount, 0);\
  \};\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading invoices...</div>\
    </div>;\
  \}\
\
  return (\
    <div className="space-y-6">\
      \{/* Invoice Summary */\}\
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">\
        <MetricCard\
          title="Total Invoiced"\
          value=\{`$\{getTotalAmount().toLocaleString()\}`\}\
          icon=\{DollarSign\}\
          color="blue"\
        />\
        <MetricCard\
          title="Amount Paid"\
          value=\{`$\{getPaidAmount().toLocaleString()\}`\}\
          icon=\{CheckCircle\}\
          color="green"\
        />\
        <MetricCard\
          title="Outstanding"\
          value=\{`$\{getPendingAmount().toLocaleString()\}`\}\
          icon=\{AlertCircle\}\
          color="yellow"\
        />\
      </div>\
\
      \{/* Header */\}\
      <div className="flex justify-between items-center">\
        <div>\
          <h2 className="text-2xl font-bold text-gray-900">Invoice Management</h2>\
          <p className="text-gray-600">Manage billing and payment tracking</p>\
        </div>\
        \{user?.role === 'admin' && (\
          <Button onClick=\{() => setShowCreateInvoice(true)\}>\
            <Plus className="w-4 h-4" />\
            Create Invoice\
          </Button>\
        )\}\
      </div>\
\
      \{/* Invoices Table */\}\
      <Card className="overflow-hidden">\
        <div className="overflow-x-auto">\
          <table className="w-full">\
            <thead className="bg-gray-50 border-b border-gray-200">\
              <tr>\
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">\
                  Invoice\
                </th>\
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">\
                  Client\
                </th>\
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">\
                  Amount\
                </th>\
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">\
                  Status\
                </th>\
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">\
                  Due Date\
                </th>\
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">\
                  Actions\
                </th>\
              </tr>\
            </thead>\
            <tbody className="bg-white divide-y divide-gray-200">\
              \{invoices.map((invoice) => (\
                <tr key=\{invoice.id\} className="hover:bg-gray-50">\
                  <td className="px-6 py-4 whitespace-nowrap">\
                    <div>\
                      <div className="text-sm font-medium text-gray-900">\
                        \{invoice.invoiceNumber\}\
                      </div>\
                      <div className="text-sm text-gray-500">\
                        \{invoice.jobTitle\}\
                      </div>\
                    </div>\
                  </td>\
                  <td className="px-6 py-4 whitespace-nowrap">\
                    <div className="text-sm text-gray-900">\{invoice.clientName\}</div>\
                    <div className="text-sm text-gray-500">\{invoice.clientEmail\}</div>\
                  </td>\
                  <td className="px-6 py-4 whitespace-nowrap">\
                    <div className="text-sm font-medium text-gray-900">\
                      $\{invoice.totalAmount.toLocaleString()\}\
                    </div>\
                    <div className="text-sm text-gray-500">\
                      Tax: $\{invoice.taxAmount.toLocaleString()\}\
                    </div>\
                  </td>\
                  <td className="px-6 py-4 whitespace-nowrap">\
                    <Badge variant=\{getStatusColor(invoice.status)\}>\
                      \{invoice.status\}\
                    </Badge>\
                  </td>\
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">\
                    \{new Date(invoice.dueDate).toLocaleDateString()\}\
                  </td>\
                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">\
                    <Button\
                      variant="ghost"\
                      size="sm"\
                      onClick=\{() => \{\
                        setSelectedInvoice(invoice);\
                        setShowInvoiceDetail(true);\
                      \}\}\
                    >\
                      <Eye className="w-4 h-4" />\
                    </Button>\
                    <Button variant="ghost" size="sm">\
                      <Download className="w-4 h-4" />\
                    </Button>\
                    \{user?.role === 'client' && invoice.status !== 'paid' && (\
                      <Button \
                        variant="success" \
                        size="sm"\
                        onClick=\{() => handlePayInvoice(invoice.id)\}\
                      >\
                        Pay Now\
                      </Button>\
                    )\}\
                  </td>\
                </tr>\
              ))\}\
            </tbody>\
          </table>\
        </div>\
      </Card>\
\
      \{invoices.length === 0 && (\
        <Card className="p-12 text-center">\
          <FileText className="w-12 h-12 text-gray-400 mx-auto mb-4" />\
          <h3 className="text-lg font-medium text-gray-900 mb-2">No invoices found</h3>\
          <p className="text-gray-600 mb-4">\
            \{user?.role === 'admin' \
              ? 'Create your first invoice to get started' \
              : 'No invoices have been generated for your account yet'\}\
          </p>\
          \{user?.role === 'admin' && (\
            <Button onClick=\{() => setShowCreateInvoice(true)\}>\
              <Plus className="w-4 h-4" />\
              Create First Invoice\
            </Button>\
          )\}\
        </Card>\
      )\}\
\
      \{user?.role === 'admin' && (\
        <CreateInvoiceModal \
          isOpen=\{showCreateInvoice\}\
          onClose=\{() => setShowCreateInvoice(false)\}\
          onSubmit=\{handleCreateInvoice\}\
        />\
      )\}\
\
      <InvoiceDetailModal\
        isOpen=\{showInvoiceDetail\}\
        onClose=\{() => setShowInvoiceDetail(false)\}\
        invoice=\{selectedInvoice\}\
        onPayment=\{handlePayInvoice\}\
        userRole=\{user?.role\}\
      />\
    </div>\
  );\
\};\
\
const CreateInvoiceModal = (\{ isOpen, onClose, onSubmit \}) => \{\
  const [formData, setFormData] = useState(\{\
    jobId: '',\
    clientName: '',\
    clientEmail: '',\
    items: [\{ description: '', quantity: 1, rate: 0, amount: 0 \}],\
    taxRate: 8,\
    notes: '',\
    dueDate: ''\
  \});\
  const [jobs, setJobs] = useState([]);\
\
  useEffect(() => \{\
    if (isOpen) \{\
      loadJobs();\
      // Set default due date to 30 days from now\
      const defaultDueDate = new Date();\
      defaultDueDate.setDate(defaultDueDate.getDate() + 30);\
      setFormData(prev => (\{\
        ...prev,\
        dueDate: defaultDueDate.toISOString().split('T')[0]\
      \}));\
    \}\
  \}, [isOpen]);\
\
  const loadJobs = async () => \{\
    try \{\
      const jobsData = await firebase.getJobs();\
      setJobs(jobsData);\
    \} catch (error) \{\
      console.error('Error loading jobs:', error);\
    \}\
  \};\
\
  const addItem = () => \{\
    setFormData(prev => (\{\
      ...prev,\
      items: [...prev.items, \{ description: '', quantity: 1, rate: 0, amount: 0 \}]\
    \}));\
  \};\
\
  const removeItem = (index) => \{\
    setFormData(prev => (\{\
      ...prev,\
      items: prev.items.filter((_, i) => i !== index)\
    \}));\
  \};\
\
  const updateItem = (index, field, value) => \{\
    setFormData(prev => \{\
      const newItems = [...prev.items];\
      newItems[index] = \{ ...newItems[index], [field]: value \};\
      \
      // Calculate amount for quantity and rate changes\
      if (field === 'quantity' || field === 'rate') \{\
        newItems[index].amount = newItems[index].quantity * newItems[index].rate;\
      \}\
      \
      return \{ ...prev, items: newItems \};\
    \});\
  \};\
\
  const getSubtotal = () => \{\
    return formData.items.reduce((sum, item) => sum + item.amount, 0);\
  \};\
\
  const getTaxAmount = () => \{\
    return (getSubtotal() * formData.taxRate) / 100;\
  \};\
\
  const getTotal = () => \{\
    return getSubtotal() + getTaxAmount();\
  \};\
\
  const handleJobChange = (jobId) => \{\
    const selectedJob = jobs.find(job => job.id === parseInt(jobId));\
    if (selectedJob) \{\
      setFormData(prev => (\{\
        ...prev,\
        jobId,\
        clientName: selectedJob.client,\
        clientEmail: selectedJob.clientEmail,\
        items: [\{ \
          description: selectedJob.title, \
          quantity: 1, \
          rate: selectedJob.value, \
          amount: selectedJob.value \
        \}]\
      \}));\
    \} else \{\
      setFormData(prev => (\{ ...prev, jobId \}));\
    \}\
  \};\
\
  const handleSubmit = (e) => \{\
    e.preventDefault();\
    \
    const invoiceData = \{\
      ...formData,\
      amount: getSubtotal(),\
      taxAmount: getTaxAmount(),\
      totalAmount: getTotal(),\
      jobTitle: jobs.find(j => j.id === parseInt(formData.jobId))?.title || 'Custom Invoice'\
    \};\
    \
    onSubmit(invoiceData);\
    onClose();\
    \
    // Reset form\
    setFormData(\{\
      jobId: '',\
      clientName: '',\
      clientEmail: '',\
      items: [\{ description: '', quantity: 1, rate: 0, amount: 0 \}],\
      taxRate: 8,\
      notes: '',\
      dueDate: ''\
    \});\
  \};\
\
  return (\
    <Modal isOpen=\{isOpen\} onClose=\{onClose\} title="Create New Invoice">\
      <form onSubmit=\{handleSubmit\} className="space-y-6">\
        <div className="grid grid-cols-2 gap-4">\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Related Job (optional)\
            </label>\
            <select\
              value=\{formData.jobId\}\
              onChange=\{(e) => handleJobChange(e.target.value)\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            >\
              <option value="">Select a job</option>\
              \{jobs.map(job => (\
                <option key=\{job.id\} value=\{job.id\}>\{job.title\} - \{job.client\}</option>\
              ))\}\
            </select>\
          </div>\
\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Due Date\
            </label>\
            <input\
              type="date"\
              value=\{formData.dueDate\}\
              onChange=\{(e) => setFormData(prev => (\{ ...prev, dueDate: e.target.value \}))\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              required\
            />\
          </div>\
        </div>\
\
        <div className="grid grid-cols-2 gap-4">\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Client Name\
            </label>\
            <input\
              type="text"\
              value=\{formData.clientName\}\
              onChange=\{(e) => setFormData(prev => (\{ ...prev, clientName: e.target.value \}))\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              required\
            />\
          </div>\
\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Client Email\
            </label>\
            <input\
              type="email"\
              value=\{formData.clientEmail\}\
              onChange=\{(e) => setFormData(prev => (\{ ...prev, clientEmail: e.target.value \}))\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              required\
            />\
          </div>\
        </div>\
\
        \{/* Invoice Items */\}\
        <div>\
          <div className="flex items-center justify-between mb-3">\
            <label className="block text-sm font-medium text-gray-700">\
              Invoice Items\
            </label>\
            <Button type="button" variant="ghost" size="sm" onClick=\{addItem\}>\
              <Plus className="w-4 h-4" />\
              Add Item\
            </Button>\
          </div>\
\
          <div className="space-y-3">\
            \{formData.items.map((item, index) => (\
              <div key=\{index\} className="grid grid-cols-12 gap-2 items-center">\
                <div className="col-span-5">\
                  <input\
                    type="text"\
                    placeholder="Description"\
                    value=\{item.description\}\
                    onChange=\{(e) => updateItem(index, 'description', e.target.value)\}\
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
                    required\
                  />\
                </div>\
                <div className="col-span-2">\
                  <input\
                    type="number"\
                    placeholder="Qty"\
                    value=\{item.quantity\}\
                    onChange=\{(e) => updateItem(index, 'quantity', parseFloat(e.target.value) || 0)\}\
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
                    min="0"\
                    step="0.01"\
                    required\
                  />\
                </div>\
                <div className="col-span-2">\
                  <input\
                    type="number"\
                    placeholder="Rate"\
                    value=\{item.rate\}\
                    onChange=\{(e) => updateItem(index, 'rate', parseFloat(e.target.value) || 0)\}\
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
                    min="0"\
                    step="0.01"\
                    required\
                  />\
                </div>\
                <div className="col-span-2">\
                  <input\
                    type="number"\
                    value=\{item.amount\}\
                    readOnly\
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50"\
                  />\
                </div>\
                <div className="col-span-1">\
                  \{formData.items.length > 1 && (\
                    <Button \
                      type="button" \
                      variant="ghost" \
                      size="sm"\
                      onClick=\{() => removeItem(index)\}\
                    >\
                      <Trash2 className="w-4 h-4 text-red-500" />\
                    </Button>\
                  )\}\
                </div>\
              </div>\
            ))\}\
          </div>\
        </div>\
\
        \{/* Invoice Summary */\}\
        <div className="bg-gray-50 p-4 rounded-lg">\
          <div className="space-y-2">\
            <div className="flex justify-between">\
              <span>Subtotal:</span>\
              <span>$\{getSubtotal().toFixed(2)\}</span>\
            </div>\
            <div className="flex justify-between items-center">\
              <span>Tax Rate:</span>\
              <div className="flex items-center gap-2">\
                <input\
                  type="number"\
                  value=\{formData.taxRate\}\
                  onChange=\{(e) => setFormData(prev => (\{ ...prev, taxRate: parseFloat(e.target.value) || 0 \}))\}\
                  className="w-16 px-2 py-1 border border-gray-300 rounded text-center"\
                  min="0"\
                  max="100"\
                  step="0.1"\
                />\
                <span>%</span>\
              </div>\
            </div>\
            <div className="flex justify-between">\
              <span>Tax Amount:</span>\
              <span>$\{getTaxAmount().toFixed(2)\}</span>\
            </div>\
            <div className="flex justify-between font-semibold text-lg border-t pt-2">\
              <span>Total:</span>\
              <span>$\{getTotal().toFixed(2)\}</span>\
            </div>\
          </div>\
        </div>\
\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">\
            Notes\
          </label>\
          <textarea\
            value=\{formData.notes\}\
            onChange=\{(e) => setFormData(prev => (\{ ...prev, notes: e.target.value \}))\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            rows=\{3\}\
            placeholder="Additional notes for the invoice..."\
          />\
        </div>\
\
        <div className="flex gap-3 pt-4">\
          <Button type="submit" className="flex-1">\
            Create Invoice\
          </Button>\
          <Button type="button" variant="secondary" onClick=\{onClose\}>\
            Cancel\
          </Button>\
        </div>\
      </form>\
    </Modal>\
  );\
\};\
\
const InvoiceDetailModal = (\{ isOpen, onClose, invoice, onPayment, userRole \}) => \{\
  if (!invoice) return null;\
\
  const getStatusColor = (status) => \{\
    switch (status) \{\
      case 'paid': return 'text-green-600 bg-green-100';\
      case 'pending': return 'text-yellow-600 bg-yellow-100';\
      case 'overdue': return 'text-red-600 bg-red-100';\
      default: return 'text-gray-600 bg-gray-100';\
    \}\
  \};\
\
  return (\
    <Modal isOpen=\{isOpen\} onClose=\{onClose\} title="Invoice Details">\
      <div className="space-y-6">\
        \{/* Invoice Header */\}\
        <div className="flex justify-between items-start">\
          <div>\
            <h3 className="text-2xl font-bold text-gray-900">\{invoice.invoiceNumber\}</h3>\
            <p className="text-gray-600">\{invoice.jobTitle\}</p>\
          </div>\
          <div className="text-right">\
            <Badge size="md" className=\{getStatusColor(invoice.status)\}>\
              \{invoice.status.toUpperCase()\}\
            </Badge>\
            <p className="text-sm text-gray-500 mt-1">\
              Created: \{new Date(invoice.createdAt).toLocaleDateString()\}\
            </p>\
          </div>\
        </div>\
\
        \{/* Client Information */\}\
        <div className="bg-gray-50 p-4 rounded-lg">\
          <h4 className="font-semibold text-gray-900 mb-2">Bill To:</h4>\
          <p className="text-gray-900">\{invoice.clientName\}</p>\
          <p className="text-gray-600">\{invoice.clientEmail\}</p>\
        </div>\
\
        \{/* Invoice Items */\}\
        <div>\
          <h4 className="font-semibold text-gray-900 mb-3">Items:</h4>\
          <div className="overflow-x-auto">\
            <table className="w-full border border-gray-200 rounded-lg">\
              <thead className="bg-gray-50">\
                <tr>\
                  <th className="px-4 py-2 text-left text-sm font-medium text-gray-700">Description</th>\
                  <th className="px-4 py-2 text-center text-sm font-medium text-gray-700">Qty</th>\
                  <th className="px-4 py-2 text-right text-sm font-medium text-gray-700">Rate</th>\
                  <th className="px-4 py-2 text-right text-sm font-medium text-gray-700">Amount</th>\
                </tr>\
              </thead>\
              <tbody className="divide-y divide-gray-200">\
                \{invoice.items.map((item, index) => (\
                  <tr key=\{index\}>\
                    <td className="px-4 py-2 text-sm text-gray-900">\{item.description\}</td>\
                    <td className="px-4 py-2 text-sm text-gray-900 text-center">\{item.quantity\}</td>\
                    <td className="px-4 py-2 text-sm text-gray-900 text-right">$\{item.rate.toLocaleString()\}</td>\
                    <td className="px-4 py-2 text-sm text-gray-900 text-right">$\{item.amount.toLocaleString()\}</td>\
                  </tr>\
                ))\}\
              </tbody>\
            </table>\
          </div>\
        </div>\
\
        \{/* Invoice Totals */\}\
        <div className="bg-gray-50 p-4 rounded-lg">\
          <div className="space-y-2">\
            <div className="flex justify-between">\
              <span className="text-gray-600">Subtotal:</span>\
              <span className="text-gray-900">$\{invoice.amount.toLocaleString()\}</span>\
            </div>\
            <div className="flex justify-between">\
              <span className="text-gray-600">Tax:</span>\
              <span className="text-gray-900">$\{invoice.taxAmount.toLocaleString()\}</span>\
            </div>\
            <div className="flex justify-between font-semibold text-lg border-t pt-2">\
              <span>Total Amount:</span>\
              <span>$\{invoice.totalAmount.toLocaleString()\}</span>\
            </div>\
          </div>\
        </div>\
\
        \{/* Payment Information */\}\
        <div className="grid grid-cols-2 gap-4">\
          <div>\
            <h4 className="font-semibold text-gray-900 mb-1">Due Date:</h4>\
            <p className="text-gray-600">\{new Date(invoice.dueDate).toLocaleDateString()\}</p>\
          </div>\
          \{invoice.paidDate && (\
            <div>\
              <h4 className="font-semibold text-gray-900 mb-1">Paid Date:</h4>\
              <p className="text-gray-600">\{new Date(invoice.paidDate).toLocaleDateString()\}</p>\
            </div>\
          )\}\
        </div>\
\
        \{/* Notes */\}\
        \{invoice.notes && (\
          <div>\
            <h4 className="font-semibold text-gray-900 mb-2">Notes:</h4>\
            <p className="text-gray-600">\{invoice.notes\}</p>\
          </div>\
        )\}\
\
        \{/* Actions */\}\
        <div className="flex gap-3 pt-4 border-t">\
          <Button variant="ghost" className="flex-1">\
            <Download className="w-4 h-4" />\
            Download PDF\
          </Button>\
          \{userRole === 'client' && invoice.status !== 'paid' && (\
            <Button \
              variant="success" \
              className="flex-1"\
              onClick=\{() => \{\
                onPayment(invoice.id);\
                onClose();\
              \}\}\
            >\
              <DollarSign className="w-4 h-4" />\
              Pay Now\
            </Button>\
          )\}\
          <Button variant="secondary" onClick=\{onClose\}>\
            Close\
          </Button>\
        </div>\
      </div>\
    </Modal>\
  );\
\};import React, \{ useState, useEffect, createContext, useContext, useCallback \} from 'react';\
import \{ \
  User, \
  BarChart3, \
  Users, \
  Briefcase, \
  MessageSquare, \
  FileText, \
  Settings, \
  Bell, \
  Search,\
  Plus,\
  Filter,\
  Menu,\
  X,\
  Phone,\
  Mail,\
  MapPin,\
  Calendar,\
  Clock,\
  CheckCircle,\
  AlertCircle,\
  AlertTriangle,\
  Info,\
  DollarSign,\
  TrendingUp,\
  Activity,\
  Zap,\
  Shield,\
  Globe,\
  ArrowRight,\
  Star,\
  ChevronDown,\
  Eye,\
  Edit,\
  Trash2,\
  Download,\
  Upload,\
  Send,\
  LogOut\
\} from 'lucide-react';\
\
// Enhanced Data Persistence Manager\
class DataPersistenceManager \{\
  constructor() \{\
    this.storageKey = 'techephi_crm_data';\
    this.version = '1.0.0';\
    this.compressionEnabled = true;\
  \}\
\
  // Enhanced localStorage with compression and versioning\
  setItem(key, data) \{\
    try \{\
      const serializedData = \{\
        version: this.version,\
        timestamp: new Date().toISOString(),\
        data: data\
      \};\
\
      const jsonString = JSON.stringify(serializedData);\
      \
      // Simple compression for large data\
      const compressedData = this.compressionEnabled ? this.compress(jsonString) : jsonString;\
      \
      localStorage.setItem(`$\{this.storageKey\}_$\{key\}`, compressedData);\
      return true;\
    \} catch (error) \{\
      console.error('Data persistence error:', error);\
      this.handleStorageError(error, key);\
      return false;\
    \}\
  \}\
\
  getItem(key) \{\
    try \{\
      const rawData = localStorage.getItem(`$\{this.storageKey\}_$\{key\}`);\
      if (!rawData) return null;\
\
      const decompressedData = this.compressionEnabled ? this.decompress(rawData) : rawData;\
      const parsedData = JSON.parse(decompressedData);\
      \
      // Version compatibility check\
      if (parsedData.version !== this.version) \{\
        console.warn(`Data version mismatch for $\{key\}. Migrating...`);\
        return this.migrateData(parsedData, key);\
      \}\
\
      return parsedData.data;\
    \} catch (error) \{\
      console.error('Data retrieval error:', error);\
      return null;\
    \}\
  \}\
\
  // Simple compression using base64 encoding\
  compress(str) \{\
    try \{\
      return btoa(unescape(encodeURIComponent(str)));\
    \} catch (error) \{\
      return str; // Fallback to uncompressed\
    \}\
  \}\
\
  decompress(str) \{\
    try \{\
      return decodeURIComponent(escape(atob(str)));\
    \} catch (error) \{\
      return str; // Assume it's not compressed\
    \}\
  \}\
\
  // Data migration for version compatibility\
  migrateData(oldData, key) \{\
    console.log(`Migrating data for $\{key\} from version $\{oldData.version\} to $\{this.version\}`);\
    \
    // Add migration logic here for future versions\
    const migratedData = oldData.data;\
    \
    // Save migrated data\
    this.setItem(key, migratedData);\
    \
    return migratedData;\
  \}\
\
  // Storage error handling\
  handleStorageError(error, key) \{\
    if (error.name === 'QuotaExceededError') \{\
      console.warn('Storage quota exceeded. Cleaning up old data...');\
      this.cleanupOldData();\
    \} else \{\
      console.error(`Storage error for key $\{key\}:`, error);\
    \}\
  \}\
\
  // Cleanup old data when storage is full\
  cleanupOldData() \{\
    const keys = Object.keys(localStorage);\
    const appKeys = keys.filter(key => key.startsWith(this.storageKey));\
    \
    // Sort by timestamp and remove oldest entries\
    const keyData = appKeys.map(key => \{\
      try \{\
        const data = JSON.parse(localStorage.getItem(key));\
        return \{ key, timestamp: new Date(data.timestamp) \};\
      \} catch \{\
        return \{ key, timestamp: new Date(0) \};\
      \}\
    \}).sort((a, b) => a.timestamp - b.timestamp);\
\
    // Remove oldest 20% of entries\
    const toRemove = Math.ceil(keyData.length * 0.2);\
    for (let i = 0; i < toRemove; i++) \{\
      localStorage.removeItem(keyData[i].key);\
    \}\
  \}\
\
  // Export data for backup\
  exportData() \{\
    const keys = Object.keys(localStorage);\
    const appKeys = keys.filter(key => key.startsWith(this.storageKey));\
    \
    const exportData = \{\};\
    appKeys.forEach(key => \{\
      exportData[key] = localStorage.getItem(key);\
    \});\
\
    return JSON.stringify(exportData, null, 2);\
  \}\
\
  // Import data from backup\
  importData(jsonData) \{\
    try \{\
      const data = JSON.parse(jsonData);\
      Object.entries(data).forEach(([key, value]) => \{\
        localStorage.setItem(key, value);\
      \});\
      return true;\
    \} catch (error) \{\
      console.error('Import error:', error);\
      return false;\
    \}\
  \}\
\
  // Clear all app data\
  clearAllData() \{\
    const keys = Object.keys(localStorage);\
    const appKeys = keys.filter(key => key.startsWith(this.storageKey));\
    appKeys.forEach(key => localStorage.removeItem(key));\
  \}\
\}\
\
// Enhanced Error Handling System\
class ErrorHandler \{\
  constructor() \{\
    this.errors = [];\
    this.maxErrors = 100;\
    this.listeners = [];\
  \}\
\
  // Log error with context\
  logError(error, context = \{\}) \{\
    const errorEntry = \{\
      id: Math.random().toString(36).substr(2, 9),\
      timestamp: new Date().toISOString(),\
      message: error.message || error,\
      stack: error.stack,\
      context,\
      severity: this.determineSeverity(error),\
      userAgent: navigator.userAgent,\
      url: window.location.href\
    \};\
\
    this.errors.unshift(errorEntry);\
    \
    // Keep only recent errors\
    if (this.errors.length > this.maxErrors) \{\
      this.errors = this.errors.slice(0, this.maxErrors);\
    \}\
\
    // Persist errors\
    dataManager.setItem('error_logs', this.errors);\
\
    // Notify listeners\
    this.listeners.forEach(listener => listener(errorEntry));\
\
    // Console logging based on severity\
    if (errorEntry.severity === 'critical') \{\
      console.error('CRITICAL ERROR:', errorEntry);\
    \} else if (errorEntry.severity === 'high') \{\
      console.error('ERROR:', errorEntry);\
    \} else \{\
      console.warn('Warning:', errorEntry);\
    \}\
\
    return errorEntry;\
  \}\
\
  determineSeverity(error) \{\
    const message = error.message || error.toString();\
    \
    if (message.includes('Firebase') || message.includes('auth') || message.includes('network')) \{\
      return 'critical';\
    \} else if (message.includes('validation') || message.includes('required')) \{\
      return 'high';\
    \} else \{\
      return 'medium';\
    \}\
  \}\
\
  // Add error listener\
  addListener(callback) \{\
    this.listeners.push(callback);\
    return () => \{\
      this.listeners = this.listeners.filter(l => l !== callback);\
    \};\
  \}\
\
  // Get recent errors\
  getRecentErrors(count = 10) \{\
    return this.errors.slice(0, count);\
  \}\
\
  // Clear errors\
  clearErrors() \{\
    this.errors = [];\
    dataManager.setItem('error_logs', []);\
  \}\
\
  // Get error statistics\
  getErrorStats() \{\
    const now = new Date();\
    const last24h = new Date(now.getTime() - 24 * 60 * 60 * 1000);\
    const lastWeek = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\
\
    const recent24h = this.errors.filter(e => new Date(e.timestamp) > last24h);\
    const recentWeek = this.errors.filter(e => new Date(e.timestamp) > lastWeek);\
\
    return \{\
      total: this.errors.length,\
      last24h: recent24h.length,\
      lastWeek: recentWeek.length,\
      bySeverity: \{\
        critical: this.errors.filter(e => e.severity === 'critical').length,\
        high: this.errors.filter(e => e.severity === 'high').length,\
        medium: this.errors.filter(e => e.severity === 'medium').length\
      \}\
    \};\
  \}\
\}\
\}\}\
\
// Loading State Manager\
class LoadingStateManager \{\
  constructor() \{\
    this.loadingStates = new Map();\
    this.listeners = [];\
  \}\
\
  setLoading(key, isLoading, message = 'Loading...') \{\
    this.loadingStates.set(key, \{ isLoading, message, timestamp: Date.now() \});\
    this.notifyListeners();\
  \}\
\
  isLoading(key) \{\
    const state = this.loadingStates.get(key);\
    return state ? state.isLoading : false;\
  \}\
\
  getMessage(key) \{\
    const state = this.loadingStates.get(key);\
    return state ? state.message : '';\
  \}\
\
  getAllLoadingStates() \{\
    return Object.fromEntries(this.loadingStates);\
  \}\
\
  addListener(callback) \{\
    this.listeners.push(callback);\
    return () => \{\
      this.listeners = this.listeners.filter(l => l !== callback);\
    \};\
  \}\
\
  notifyListeners() \{\
    this.listeners.forEach(listener => listener(this.getAllLoadingStates()));\
  \}\
\
  // Auto-clear old loading states\
  cleanup() \{\
    const now = Date.now();\
    const timeout = 30000; // 30 seconds\
    \
    for (const [key, state] of this.loadingStates.entries()) \{\
      if (now - state.timestamp > timeout) \{\
        this.loadingStates.delete(key);\
      \}\
    \}\
  \}\
\}\
\
// Initialize global managers\
const dataManager = new DataPersistenceManager();\
const errorHandler = new ErrorHandler();\
const loadingManager = new LoadingStateManager();\
\
// Global error handling\
window.addEventListener('error', (event) => \{\
  errorHandler.logError(event.error, \{\
    filename: event.filename,\
    lineno: event.lineno,\
    colno: event.colno\
  \});\
\});\
\
window.addEventListener('unhandledrejection', (event) => \{\
  errorHandler.logError(event.reason, \{\
    type: 'unhandledPromiseRejection'\
  \});\
\});\
\
// Enhanced Loading Component\
const LoadingSpinner = (\{ size = 'md', message, className = '' \}) => \{\
  const sizes = \{\
    sm: 'w-4 h-4',\
    md: 'w-8 h-8',\
    lg: 'w-12 h-12',\
    xl: 'w-16 h-16'\
  \};\
\
  return (\
    <div className=\{`flex flex-col items-center justify-center $\{className\}`\}>\
      <div className=\{`$\{sizes[size]\} border-4 border-gray-200 border-t-[#3B0A69] rounded-full animate-spin`\}></div>\
      \{message && (\
        <p className="mt-3 text-sm text-gray-600 animate-pulse">\{message\}</p>\
      )\}\
    </div>\
  );\
\};\
\
// Enhanced Error Boundary Component\
class ErrorBoundary extends React.Component \{\
  constructor(props) \{\
    super(props);\
    this.state = \{ hasError: false, error: null, errorInfo: null \};\
  \}\
\
  static getDerivedStateFromError(error) \{\
    return \{ hasError: true \};\
  \}\
\
  componentDidCatch(error, errorInfo) \{\
    this.setState(\{\
      error,\
      errorInfo\
    \});\
\
    // Log to error handler\
    errorHandler.logError(error, \{\
      componentStack: errorInfo.componentStack,\
      errorBoundary: this.props.name || 'Unknown'\
    \});\
  \}\
\
  render() \{\
    if (this.state.hasError) \{\
      return this.props.fallback || (\
        <div className="min-h-[200px] flex items-center justify-center bg-red-50 border border-red-200 rounded-lg m-4">\
          <div className="text-center p-6">\
            <AlertCircle className="w-12 h-12 text-red-500 mx-auto mb-4" />\
            <h3 className="text-lg font-semibold text-red-900 mb-2">Something went wrong</h3>\
            <p className="text-red-700 mb-4">\
              We're sorry, but there was an error loading this component.\
            </p>\
            <Button \
              variant="danger"\
              onClick=\{() => this.setState(\{ hasError: false, error: null, errorInfo: null \})\}\
            >\
              Try Again\
            </Button>\
            \{process.env.NODE_ENV === 'development' && (\
              <details className="mt-4 text-left">\
                <summary className="cursor-pointer text-red-600">Error Details</summary>\
                <pre className="mt-2 text-xs bg-red-100 p-2 rounded overflow-auto">\
                  \{this.state.error && this.state.error.toString()\}\
                  \{this.state.errorInfo.componentStack\}\
                </pre>\
              </details>\
            )\}\
          </div>\
        </div>\
      );\
    \}\
\
    return this.props.children;\
  \}\
\}\
\
// Enhanced Toast Notification System\
const ToastContext = createContext();\
\
const ToastProvider = (\{ children \}) => \{\
  const [toasts, setToasts] = useState([]);\
\
  const addToast = (toast) => \{\
    const id = Math.random().toString(36).substr(2, 9);\
    const newToast = \{\
      id,\
      ...toast,\
      timestamp: Date.now()\
    \};\
\
    setToasts(prev => [...prev, newToast]);\
\
    // Auto-remove after timeout\
    const timeout = toast.duration || 5000;\
    setTimeout(() => \{\
      removeToast(id);\
    \}, timeout);\
\
    return id;\
  \};\
\
  const removeToast = (id) => \{\
    setToasts(prev => prev.filter(toast => toast.id !== id));\
  \};\
\
  const showSuccess = (message, options = \{\}) => \{\
    return addToast(\{\
      type: 'success',\
      title: 'Success',\
      message,\
      ...options\
    \});\
  \};\
\
  const showError = (message, options = \{\}) => \{\
    return addToast(\{\
      type: 'error',\
      title: 'Error',\
      message,\
      duration: 7000, // Longer for errors\
      ...options\
    \});\
  \};\
\
  const showWarning = (message, options = \{\}) => \{\
    return addToast(\{\
      type: 'warning',\
      title: 'Warning',\
      message,\
      ...options\
    \});\
  \};\
\
  const showInfo = (message, options = \{\}) => \{\
    return addToast(\{\
      type: 'info',\
      title: 'Info',\
      message,\
      ...options\
    \});\
  \};\
\
  return (\
    <ToastContext.Provider value=\{\{\
      addToast,\
      removeToast,\
      showSuccess,\
      showError,\
      showWarning,\
      showInfo\
    \}\}>\
      \{children\}\
      <ToastContainer toasts=\{toasts\} onRemove=\{removeToast\} />\
    </ToastContext.Provider>\
  );\
\};\
\
const useToast = () => \{\
  const context = useContext(ToastContext);\
  if (!context) \{\
    throw new Error('useToast must be used within ToastProvider');\
  \}\
  return context;\
\};\
\
// Toast Container Component\
const ToastContainer = (\{ toasts, onRemove \}) => \{\
  return (\
    <div className="fixed top-4 right-4 z-50 space-y-2">\
      \{toasts.map((toast) => (\
        <Toast key=\{toast.id\} toast=\{toast\} onRemove=\{onRemove\} />\
      ))\}\
    </div>\
  );\
\};\
\
// Individual Toast Component\
const Toast = (\{ toast, onRemove \}) => \{\
  const typeStyles = \{\
    success: 'bg-green-50 border-green-200 text-green-800',\
    error: 'bg-red-50 border-red-200 text-red-800',\
    warning: 'bg-yellow-50 border-yellow-200 text-yellow-800',\
    info: 'bg-blue-50 border-blue-200 text-blue-800'\
  \};\
\
  const icons = \{\
    success: CheckCircle,\
    error: AlertCircle,\
    warning: AlertTriangle,\
    info: Info\
  \};\
\
  const Icon = icons[toast.type] || Info;\
\
  return (\
    <div className=\{`max-w-sm w-full border rounded-lg shadow-lg p-4 $\{typeStyles[toast.type]\} animate-in slide-in-from-right duration-300`\}>\
      <div className="flex items-start">\
        <Icon className="w-5 h-5 mt-0.5 mr-3 flex-shrink-0" />\
        <div className="flex-1 min-w-0">\
          <p className="text-sm font-semibold">\{toast.title\}</p>\
          <p className="text-sm mt-1">\{toast.message\}</p>\
        </div>\
        <button\
          onClick=\{() => onRemove(toast.id)\}\
          className="ml-3 flex-shrink-0 rounded-md p-1.5 hover:bg-black hover:bg-opacity-10 transition-colors"\
        >\
          <X className="w-4 h-4" />\
        </button>\
      </div>\
    </div>\
  );\
\};\
\
// Responsive Utility Hook\
const useResponsive = () => \{\
  const [breakpoint, setBreakpoint] = useState('lg');\
  const [isMobile, setIsMobile] = useState(false);\
  const [isTablet, setIsTablet] = useState(false);\
  const [isDesktop, setIsDesktop] = useState(true);\
\
  useEffect(() => \{\
    const updateBreakpoint = () => \{\
      const width = window.innerWidth;\
      \
      if (width < 640) \{\
        setBreakpoint('sm');\
        setIsMobile(true);\
        setIsTablet(false);\
        setIsDesktop(false);\
      \} else if (width < 768) \{\
        setBreakpoint('md');\
        setIsMobile(false);\
        setIsTablet(true);\
        setIsDesktop(false);\
      \} else if (width < 1024) \{\
        setBreakpoint('lg');\
        setIsMobile(false);\
        setIsTablet(true);\
        setIsDesktop(false);\
      \} else \{\
        setBreakpoint('xl');\
        setIsMobile(false);\
        setIsTablet(false);\
        setIsDesktop(true);\
      \}\
    \};\
\
    updateBreakpoint();\
    window.addEventListener('resize', updateBreakpoint);\
    \
    return () => window.removeEventListener('resize', updateBreakpoint);\
  \}, []);\
\
  return \{\
    breakpoint,\
    isMobile,\
    isTablet,\
    isDesktop,\
    isSmallScreen: isMobile || isTablet\
  \};\
\};\
\
// Enhanced Async Operation Hook\
const useAsyncOperation = () => \{\
  const \{ showSuccess, showError \} = useToast();\
  \
  const executeAsync = async (operation, options = \{\}) => \{\
    const \{\
      loadingKey = 'default',\
      loadingMessage = 'Loading...',\
      successMessage,\
      errorMessage = 'An error occurred',\
      showLoadingToast = false\
    \} = options;\
\
    try \{\
      loadingManager.setLoading(loadingKey, true, loadingMessage);\
      \
      if (showLoadingToast) \{\
        showInfo(loadingMessage);\
      \}\
\
      const result = await operation();\
\
      if (successMessage) \{\
        showSuccess(successMessage);\
      \}\
\
      return result;\
    \} catch (error) \{\
      console.error('Async operation failed:', error);\
      errorHandler.logError(error, \{ operation: operation.name, loadingKey \});\
      \
      showError(typeof errorMessage === 'function' ? errorMessage(error) : errorMessage);\
      throw error;\
    \} finally \{\
      loadingManager.setLoading(loadingKey, false);\
    \}\
  \};\
\
  return \{ executeAsync \};\
\};\
\
// Enhanced Data Hook with Caching\
const useData = (key, fetcher, options = \{\}) => \{\
  const [data, setData] = useState(null);\
  const [loading, setLoading] = useState(true);\
  const [error, setError] = useState(null);\
  const \{ executeAsync \} = useAsyncOperation();\
\
  const \{\
    cacheTime = 5 * 60 * 1000, // 5 minutes\
    staleTime = 2 * 60 * 1000,  // 2 minutes\
    refetchOnWindowFocus = true,\
    retryOnError = true,\
    maxRetries = 3\
  \} = options;\
\
  const fetchData = useCallback(async (retryCount = 0) => \{\
    try \{\
      // Check cache first\
      const cached = dataManager.getItem(`cache_$\{key\}`);\
      if (cached && Date.now() - cached.timestamp < staleTime) \{\
        setData(cached.data);\
        setLoading(false);\
        return;\
      \}\
\
      setLoading(true);\
      setError(null);\
\
      const result = await executeAsync(fetcher, \{\
        loadingKey: `data_$\{key\}`,\
        loadingMessage: `Loading $\{key\}...`,\
        errorMessage: `Failed to load $\{key\}`\
      \});\
\
      // Cache the result\
      dataManager.setItem(`cache_$\{key\}`, \{\
        data: result,\
        timestamp: Date.now()\
      \});\
\
      setData(result);\
    \} catch (err) \{\
      setError(err);\
      \
      if (retryOnError && retryCount < maxRetries) \{\
        console.log(`Retrying $\{key\} ($\{retryCount + 1\}/$\{maxRetries\})`);\
        setTimeout(() => fetchData(retryCount + 1), 1000 * Math.pow(2, retryCount));\
      \}\
    \} finally \{\
      setLoading(false);\
    \}\
  \}, [key, fetcher, staleTime, executeAsync, retryOnError, maxRetries]);\
\
  useEffect(() => \{\
    fetchData();\
\
    // Refetch on window focus\
    if (refetchOnWindowFocus) \{\
      const handleFocus = () => \{\
        const cached = dataManager.getItem(`cache_$\{key\}`);\
        if (!cached || Date.now() - cached.timestamp > staleTime) \{\
          fetchData();\
        \}\
      \};\
\
      window.addEventListener('focus', handleFocus);\
      return () => window.removeEventListener('focus', handleFocus);\
    \}\
  \}, [fetchData, refetchOnWindowFocus, key, staleTime]);\
\
  const mutate = useCallback((newData) => \{\
    setData(newData);\
    dataManager.setItem(`cache_$\{key\}`, \{\
      data: newData,\
      timestamp: Date.now()\
    \});\
  \}, [key]);\
\
  const refetch = useCallback(() => \{\
    return fetchData();\
  \}, [fetchData]);\
\
  return \{\
    data,\
    loading,\
    error,\
    mutate,\
    refetch\
  \};\
\};\
\
// Firebase Services (Mock implementation for this demo)\
class FirebaseService \{\
  constructor() \{\
    this.currentUser = null;\
    this.isAuthenticated = false;\
  \}\
\
  // Mock Firebase Auth\
  async signInWithEmailAndPassword(email, password) \{\
    // Simulate API call delay\
    await new Promise(resolve => setTimeout(resolve, 1000));\
    \
    // Mock authentication logic\
    if (email && password) \{\
      const user = \{\
        uid: Math.random().toString(36).substr(2, 9),\
        email: email,\
        displayName: email.split('@')[0],\
        role: this.determineRole(email)\
      \};\
      \
      this.currentUser = user;\
      this.isAuthenticated = true;\
      return \{ user \};\
    \}\
    \
    throw new Error('Invalid credentials');\
  \}\
\
  async createUserWithEmailAndPassword(email, password, role = 'client') \{\
    await new Promise(resolve => setTimeout(resolve, 1000));\
    \
    const user = \{\
      uid: Math.random().toString(36).substr(2, 9),\
      email: email,\
      displayName: email.split('@')[0],\
      role: role\
    \};\
    \
    // Save user profile to Firestore\
    await this.setUserProfile(user.uid, \{\
      email: user.email,\
      displayName: user.displayName,\
      role: user.role,\
      createdAt: new Date().toISOString()\
    \});\
    \
    this.currentUser = user;\
    this.isAuthenticated = true;\
    return \{ user \};\
  \}\
\
  async signOut() \{\
    this.currentUser = null;\
    this.isAuthenticated = false;\
  \}\
\
  // Mock Firestore operations\
  async setUserProfile(uid, data) \{\
    const profiles = JSON.parse(localStorage.getItem('userProfiles') || '\{\}');\
    profiles[uid] = data;\
    localStorage.setItem('userProfiles', JSON.stringify(profiles));\
  \}\
\
  async getUserProfile(uid) \{\
    const profiles = JSON.parse(localStorage.getItem('userProfiles') || '\{\}');\
    return profiles[uid] || null;\
  \}\
\
  async getJobs() \{\
    // Mock jobs data\
    return [\
      \{\
        id: 1,\
        title: 'Network Infrastructure Setup',\
        description: 'Complete network overhaul for small office',\
        status: 'in-progress',\
        priority: 'high',\
        client: 'Acme Corp',\
        clientEmail: 'client@acme.com',\
        contractor: 'John Smith',\
        contractorEmail: 'john@techephi.com',\
        dueDate: '2025-08-15',\
        createdAt: '2025-08-01',\
        value: 8500,\
        estimatedHours: 40\
      \},\
      \{\
        id: 2,\
        title: 'Server Maintenance',\
        description: 'Quarterly server maintenance and updates',\
        status: 'pending',\
        priority: 'medium',\
        client: 'Tech Solutions Inc',\
        clientEmail: 'admin@techsolutions.com',\
        contractor: null,\
        contractorEmail: null,\
        dueDate: '2025-08-10',\
        createdAt: '2025-07-28',\
        value: 2500,\
        estimatedHours: 8\
      \},\
      \{\
        id: 3,\
        title: 'Security Audit',\
        description: 'Comprehensive security assessment and penetration testing',\
        status: 'completed',\
        priority: 'high',\
        client: 'Finance Pro LLC',\
        clientEmail: 'security@financepro.com',\
        contractor: 'Sarah Johnson',\
        contractorEmail: 'sarah@techephi.com',\
        dueDate: '2025-08-05',\
        createdAt: '2025-07-20',\
        value: 12000,\
        estimatedHours: 60\
      \}\
    ];\
  \}\
\
  async createJob(jobData) \{\
    const jobs = await this.getJobs();\
    const newJob = \{\
      ...jobData,\
      id: Math.max(...jobs.map(j => j.id)) + 1,\
      createdAt: new Date().toISOString(),\
      status: 'pending'\
    \};\
    \
    // In a real app, this would save to Firestore\
    console.log('Creating job:', newJob);\
    return newJob;\
  \}\
\
  async getInvoices() \{\
    const savedInvoices = localStorage.getItem('invoices');\
    if (savedInvoices) \{\
      return JSON.parse(savedInvoices);\
    \}\
\
    const defaultInvoices = [\
      \{\
        id: 'INV-001',\
        invoiceNumber: 'INV-2025-001',\
        jobId: 3,\
        jobTitle: 'Security Audit',\
        clientEmail: 'security@financepro.com',\
        clientName: 'Finance Pro LLC',\
        amount: 12000,\
        taxAmount: 960,\
        totalAmount: 12960,\
        status: 'paid',\
        dueDate: '2025-08-20',\
        paidDate: '2025-08-18',\
        createdAt: '2025-08-05',\
        items: [\
          \{ description: 'Security Assessment', quantity: 1, rate: 8000, amount: 8000 \},\
          \{ description: 'Penetration Testing', quantity: 1, rate: 4000, amount: 4000 \}\
        ],\
        notes: 'Payment received via bank transfer. Thank you for your business.'\
      \},\
      \{\
        id: 'INV-002',\
        invoiceNumber: 'INV-2025-002',\
        jobId: 1,\
        jobTitle: 'Network Infrastructure Setup',\
        clientEmail: 'client@acme.com',\
        clientName: 'Acme Corporation',\
        amount: 4250,\
        taxAmount: 340,\
        totalAmount: 4590,\
        status: 'pending',\
        dueDate: '2025-08-25',\
        paidDate: null,\
        createdAt: '2025-08-10',\
        items: [\
          \{ description: 'Network Hardware Setup', quantity: 1, rate: 2500, amount: 2500 \},\
          \{ description: 'Configuration & Testing', quantity: 1, rate: 1750, amount: 1750 \}\
        ],\
        notes: 'Please remit payment within 15 days of invoice date.'\
      \},\
      \{\
        id: 'INV-003',\
        invoiceNumber: 'INV-2025-003',\
        jobId: 2,\
        jobTitle: 'Server Maintenance',\
        clientEmail: 'admin@techsolutions.com',\
        clientName: 'Tech Solutions Inc',\
        amount: 2500,\
        taxAmount: 200,\
        totalAmount: 2700,\
        status: 'overdue',\
        dueDate: '2025-08-05',\
        paidDate: null,\
        createdAt: '2025-07-28',\
        items: [\
          \{ description: 'Quarterly Server Maintenance', quantity: 1, rate: 2500, amount: 2500 \}\
        ],\
        notes: 'Invoice is overdue. Please contact us to arrange payment.'\
      \}\
    ];\
\
    localStorage.setItem('invoices', JSON.stringify(defaultInvoices));\
    return defaultInvoices;\
  \}\
\
  async createInvoice(invoiceData) \{\
    const invoices = await this.getInvoices();\
    const newInvoice = \{\
      ...invoiceData,\
      id: `INV-$\{Math.random().toString(36).substr(2, 9)\}`,\
      invoiceNumber: `INV-2025-$\{(invoices.length + 1).toString().padStart(3, '0')\}`,\
      createdAt: new Date().toISOString(),\
      status: 'pending',\
      paidDate: null\
    \};\
    \
    invoices.push(newInvoice);\
    localStorage.setItem('invoices', JSON.stringify(invoices));\
    return newInvoice;\
  \}\
\
  async updateInvoiceStatus(invoiceId, status, paidDate = null) \{\
    const invoices = await this.getInvoices();\
    const invoice = invoices.find(inv => inv.id === invoiceId);\
    if (invoice) \{\
      invoice.status = status;\
      if (paidDate) invoice.paidDate = paidDate;\
      localStorage.setItem('invoices', JSON.stringify(invoices));\
    \}\
    return invoice;\
  \}\
\
  // Messaging System\
  async getConversations(userEmail) \{\
    const savedConversations = localStorage.getItem('conversations');\
    let conversations = savedConversations ? JSON.parse(savedConversations) : [];\
    \
    // Filter conversations for current user\
    return conversations.filter(conv => \
      conv.participants.includes(userEmail)\
    );\
  \}\
\
  async getMessages(conversationId) \{\
    const savedMessages = localStorage.getItem(`messages_$\{conversationId\}`);\
    return savedMessages ? JSON.parse(savedMessages) : [];\
  \}\
\
  async sendMessage(conversationId, message) \{\
    const messages = await this.getMessages(conversationId);\
    const newMessage = \{\
      id: Math.random().toString(36).substr(2, 9),\
      conversationId,\
      senderId: message.senderId,\
      senderName: message.senderName,\
      senderRole: message.senderRole,\
      content: message.content,\
      timestamp: new Date().toISOString(),\
      read: false,\
      attachments: message.attachments || []\
    \};\
    \
    messages.push(newMessage);\
    localStorage.setItem(`messages_$\{conversationId\}`, JSON.stringify(messages));\
    \
    // Update conversation last message\
    const conversations = JSON.parse(localStorage.getItem('conversations') || '[]');\
    const conversation = conversations.find(c => c.id === conversationId);\
    if (conversation) \{\
      conversation.lastMessage = newMessage.content;\
      conversation.lastMessageTime = newMessage.timestamp;\
      conversation.unreadCount = (conversation.unreadCount || 0) + 1;\
      localStorage.setItem('conversations', JSON.stringify(conversations));\
    \}\
    \
    return newMessage;\
  \}\
\
  async createConversation(participants, title, jobId = null) \{\
    const conversations = JSON.parse(localStorage.getItem('conversations') || '[]');\
    const newConversation = \{\
      id: Math.random().toString(36).substr(2, 9),\
      title,\
      participants,\
      jobId,\
      createdAt: new Date().toISOString(),\
      lastMessage: '',\
      lastMessageTime: new Date().toISOString(),\
      unreadCount: 0\
    \};\
    \
    conversations.push(newConversation);\
    localStorage.setItem('conversations', JSON.stringify(conversations));\
    \
    // Initialize empty messages for this conversation\
    localStorage.setItem(`messages_$\{newConversation.id\}`, JSON.stringify([]));\
    \
    return newConversation;\
  \}\
\
  async markMessagesAsRead(conversationId, userEmail) \{\
    const messages = await this.getMessages(conversationId);\
    const updatedMessages = messages.map(msg => (\{\
      ...msg,\
      read: msg.senderId === userEmail ? msg.read : true\
    \}));\
    \
    localStorage.setItem(`messages_$\{conversationId\}`, JSON.stringify(updatedMessages));\
    \
    // Reset unread count for conversation\
    const conversations = JSON.parse(localStorage.getItem('conversations') || '[]');\
    const conversation = conversations.find(c => c.id === conversationId);\
    if (conversation) \{\
      conversation.unreadCount = 0;\
      localStorage.setItem('conversations', JSON.stringify(conversations));\
    \}\
  \}\
\
  // Enhanced Notifications System with Email, SMS, and Push\
  async getNotifications(userEmail) \{\
    const savedNotifications = localStorage.getItem(`notifications_$\{userEmail\}`);\
    return savedNotifications ? JSON.parse(savedNotifications) : [];\
  \}\
\
  async createNotification(userEmail, notification) \{\
    const notifications = await this.getNotifications(userEmail);\
    const newNotification = \{\
      id: Math.random().toString(36).substr(2, 9),\
      ...notification,\
      timestamp: new Date().toISOString(),\
      read: false,\
      deliveryStatus: \{\
        browser: false,\
        email: false,\
        sms: false\
      \}\
    \};\
    \
    notifications.unshift(newNotification);\
    localStorage.setItem(`notifications_$\{userEmail\}`, JSON.stringify(notifications));\
    \
    // Get user preferences for this notification type\
    const preferences = await this.getNotificationPreferences(userEmail);\
    \
    // Send notifications based on preferences and urgency\
    await this.sendMultiChannelNotification(userEmail, newNotification, preferences);\
    \
    return newNotification;\
  \}\
\
  async sendMultiChannelNotification(userEmail, notification, preferences) \{\
    const urgencyLevel = notification.urgency || 'normal';\
    const notificationType = notification.type || 'general';\
    \
    // Browser Push Notification\
    if (preferences.browser[notificationType] || urgencyLevel === 'critical') \{\
      await this.sendBrowserNotification(notification);\
    \}\
    \
    // Email Notification\
    if (preferences.email[notificationType] || urgencyLevel === 'critical') \{\
      await this.sendEmailNotification(userEmail, notification);\
    \}\
    \
    // SMS Notification (for high priority and critical only)\
    if ((preferences.sms[notificationType] && urgencyLevel === 'high') || urgencyLevel === 'critical') \{\
      await this.sendSMSNotification(userEmail, notification);\
    \}\
  \}\
\
  async sendBrowserNotification(notification) \{\
    try \{\
      if ('Notification' in window && Notification.permission === 'granted') \{\
        const browserNotification = new Notification(notification.title, \{\
          body: notification.message,\
          icon: '/favicon.ico',\
          badge: '/favicon.ico',\
          tag: notification.id,\
          requireInteraction: notification.urgency === 'critical',\
          actions: notification.actions || []\
        \});\
\
        // Auto-close after 10 seconds unless critical\
        if (notification.urgency !== 'critical') \{\
          setTimeout(() => browserNotification.close(), 10000);\
        \}\
\
        // Update delivery status\
        await this.updateNotificationDeliveryStatus(notification.id, 'browser', true);\
        \
        return true;\
      \}\
    \} catch (error) \{\
      console.error('Browser notification failed:', error);\
      return false;\
    \}\
  \}\
\
  async sendEmailNotification(userEmail, notification) \{\
    try \{\
      // Simulate email sending (in real implementation, this would call an email service)\
      const emailData = \{\
        to: userEmail,\
        subject: `$\{notification.title\} - Tech Ephi`,\
        html: this.generateEmailTemplate(notification),\
        text: notification.message\
      \};\
\
      // Mock email service call\
      console.log('Email sent:', emailData);\
      \
      // Update delivery status\
      await this.updateNotificationDeliveryStatus(notification.id, 'email', true);\
      \
      return true;\
    \} catch (error) \{\
      console.error('Email notification failed:', error);\
      return false;\
    \}\
  \}\
\
  async sendSMSNotification(userEmail, notification) \{\
    try \{\
      // Get user's phone number\
      const userProfile = await this.getUserProfile(userEmail);\
      const phoneNumber = userProfile?.phone;\
      \
      if (!phoneNumber) \{\
        console.warn('No phone number available for SMS notification');\
        return false;\
      \}\
\
      // Simulate SMS sending (in real implementation, this would call Twilio/AWS SNS)\
      const smsData = \{\
        to: phoneNumber,\
        message: `Tech Ephi Alert: $\{notification.title\}\\n$\{notification.message\}`,\
        urgency: notification.urgency\
      \};\
\
      console.log('SMS sent:', smsData);\
      \
      // Update delivery status\
      await this.updateNotificationDeliveryStatus(notification.id, 'sms', true);\
      \
      return true;\
    \} catch (error) \{\
      console.error('SMS notification failed:', error);\
      return false;\
    \}\
  \}\
\
  generateEmailTemplate(notification) \{\
    const urgencyColors = \{\
      critical: '#DC2626',\
      high: '#EA580C',\
      normal: '#3B0A69',\
      low: '#6B7280'\
    \};\
\
    const urgencyColor = urgencyColors[notification.urgency] || urgencyColors.normal;\
\
    return `\
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">\
        <div style="background: linear-gradient(135deg, #3B0A69, #6B46C1); padding: 20px; border-radius: 8px 8px 0 0;">\
          <h1 style="color: white; margin: 0; font-size: 24px;">Tech Ephi</h1>\
        </div>\
        <div style="background: white; padding: 30px; border: 1px solid #E5E7EB; border-radius: 0 0 8px 8px;">\
          <div style="background: $\{urgencyColor\}; color: white; padding: 10px 15px; border-radius: 4px; margin-bottom: 20px; font-weight: bold; text-transform: uppercase;">\
            $\{notification.urgency || 'Normal'\} Priority\
          </div>\
          <h2 style="color: #1F2937; margin-bottom: 15px;">$\{notification.title\}</h2>\
          <p style="color: #4B5563; line-height: 1.6; margin-bottom: 20px;">$\{notification.message\}</p>\
          $\{notification.actionUrl ? `\
            <a href="$\{notification.actionUrl\}" style="background: #3B0A69; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block; font-weight: bold;">\
              $\{notification.actionText || 'View Details'\}\
            </a>\
          ` : ''\}\
          <hr style="border: none; border-top: 1px solid #E5E7EB; margin: 30px 0;">\
          <p style="color: #6B7280; font-size: 14px; margin: 0;">\
            This is an automated notification from Tech Ephi. \
            <a href="#" style="color: #3B0A69;">Manage your notification preferences</a>\
          </p>\
        </div>\
      </div>\
    `;\
  \}\
\
  async updateNotificationDeliveryStatus(notificationId, channel, success) \{\
    // Update the delivery status for tracking\
    const allNotifications = JSON.parse(localStorage.getItem('allNotifications') || '[]');\
    const notification = allNotifications.find(n => n.id === notificationId);\
    \
    if (notification) \{\
      notification.deliveryStatus[channel] = success;\
      localStorage.setItem('allNotifications', JSON.stringify(allNotifications));\
    \}\
  \}\
\
  // Notification Preferences Management\
  async getNotificationPreferences(userEmail) \{\
    const savedPrefs = localStorage.getItem(`notificationPrefs_$\{userEmail\}`);\
    \
    if (savedPrefs) \{\
      return JSON.parse(savedPrefs);\
    \}\
\
    // Default preferences\
    const defaultPreferences = \{\
      browser: \{\
        message: true,\
        invoice: true,\
        job: true,\
        payment: true,\
        schedule: true,\
        system: false\
      \},\
      email: \{\
        message: false,\
        invoice: true,\
        job: true,\
        payment: true,\
        schedule: true,\
        system: true\
      \},\
      sms: \{\
        message: false,\
        invoice: false,\
        job: false,\
        payment: true,\
        schedule: false,\
        system: false\
      \},\
      quiet_hours: \{\
        enabled: true,\
        start: '22:00',\
        end: '08:00'\
      \},\
      urgency_override: \{\
        critical_always: true,\
        high_during_hours: true\
      \}\
    \};\
\
    await this.saveNotificationPreferences(userEmail, defaultPreferences);\
    return defaultPreferences;\
  \}\
\
  async saveNotificationPreferences(userEmail, preferences) \{\
    localStorage.setItem(`notificationPrefs_$\{userEmail\}`, JSON.stringify(preferences));\
  \}\
\
  async updateNotificationPreferences(userEmail, updates) \{\
    const current = await this.getNotificationPreferences(userEmail);\
    const updated = \{ ...current, ...updates \};\
    await this.saveNotificationPreferences(userEmail, updated);\
    return updated;\
  \}\
\
  // Automated notification triggers\
  async checkAndSendAutomatedNotifications() \{\
    const jobs = await this.getJobs();\
    const invoices = await this.getInvoices();\
    const now = new Date();\
\
    // Check for overdue invoices\
    for (const invoice of invoices) \{\
      if (invoice.status !== 'paid' && new Date(invoice.dueDate) < now) \{\
        const daysPastDue = Math.floor((now - new Date(invoice.dueDate)) / (1000 * 60 * 60 * 24));\
        \
        if (daysPastDue === 1 || daysPastDue === 7 || daysPastDue === 30) \{\
          await this.createNotification(invoice.clientEmail, \{\
            type: 'invoice',\
            urgency: daysPastDue >= 30 ? 'high' : 'normal',\
            title: 'Overdue Invoice Reminder',\
            message: `Invoice $\{invoice.invoiceNumber\} is $\{daysPastDue\} days overdue. Amount: $\{invoice.totalAmount.toLocaleString()\}`,\
            actionUrl: `/invoices/$\{invoice.id\}`,\
            actionText: 'Pay Now'\
          \});\
        \}\
      \}\
    \}\
\
    // Check for jobs due soon\
    for (const job of jobs) \{\
      if (job.status === 'in-progress') \{\
        const dueDate = new Date(job.dueDate);\
        const daysUntilDue = Math.ceil((dueDate - now) / (1000 * 60 * 60 * 24));\
        \
        if (daysUntilDue === 1) \{\
          await this.createNotification(job.contractorEmail, \{\
            type: 'job',\
            urgency: 'high',\
            title: 'Job Due Tomorrow',\
            message: `"$\{job.title\}" is due tomorrow. Please ensure completion.`,\
            actionUrl: `/jobs/$\{job.id\}`,\
            actionText: 'View Job'\
          \});\
        \}\
      \}\
    \}\
\
    // Check for upcoming appointments\
    const events = await this.getScheduleEvents();\
    for (const event of events) \{\
      if (event.status === 'scheduled') \{\
        const eventTime = new Date(event.startTime);\
        const hoursUntilEvent = (eventTime - now) / (1000 * 60 * 60);\
        \
        if (hoursUntilEvent > 0 && hoursUntilEvent <= 24) \{\
          await this.createNotification(event.assignedTo, \{\
            type: 'schedule',\
            urgency: hoursUntilEvent <= 2 ? 'high' : 'normal',\
            title: 'Upcoming Appointment',\
            message: `You have "$\{event.title\}" scheduled for $\{eventTime.toLocaleString()\}`,\
            actionUrl: `/schedule/$\{event.id\}`,\
            actionText: 'View Details'\
          \});\
        \}\
      \}\
    \}\
  \}\
\
  // Batch notification management\
  async sendBulkNotification(userEmails, notification) \{\
    const results = [];\
    \
    for (const email of userEmails) \{\
      try \{\
        const result = await this.createNotification(email, notification);\
        results.push(\{ email, success: true, notificationId: result.id \});\
      \} catch (error) \{\
        results.push(\{ email, success: false, error: error.message \});\
      \}\
    \}\
    \
    return results;\
  \}\
\
  async getNotificationAnalytics(userEmail, days = 30) \{\
    const notifications = await this.getNotifications(userEmail);\
    const startDate = new Date();\
    startDate.setDate(startDate.getDate() - days);\
    \
    const recentNotifications = notifications.filter(n => \
      new Date(n.timestamp) >= startDate\
    );\
\
    return \{\
      total: recentNotifications.length,\
      unread: recentNotifications.filter(n => !n.read).length,\
      byType: this.groupBy(recentNotifications, 'type'),\
      byUrgency: this.groupBy(recentNotifications, 'urgency'),\
      deliveryRate: \{\
        browser: this.calculateDeliveryRate(recentNotifications, 'browser'),\
        email: this.calculateDeliveryRate(recentNotifications, 'email'),\
        sms: this.calculateDeliveryRate(recentNotifications, 'sms')\
      \}\
    \};\
  \}\
\
  groupBy(array, key) \{\
    return array.reduce((result, item) => \{\
      const group = item[key] || 'unknown';\
      result[group] = (result[group] || 0) + 1;\
      return result;\
    \}, \{\});\
  \}\
\
  calculateDeliveryRate(notifications, channel) \{\
    const attempted = notifications.filter(n => n.deliveryStatus && n.deliveryStatus[channel] !== undefined).length;\
    const successful = notifications.filter(n => n.deliveryStatus && n.deliveryStatus[channel] === true).length;\
    \
    return attempted > 0 ? Math.round((successful / attempted) * 100) : 0;\
  \}\
\
  async markNotificationAsRead(userEmail, notificationId) \{\
    const notifications = await this.getNotifications(userEmail);\
    const notification = notifications.find(n => n.id === notificationId);\
    if (notification) \{\
      notification.read = true;\
      localStorage.setItem(`notifications_$\{userEmail\}`, JSON.stringify(notifications));\
    \}\
  \}\
\
  async markAllNotificationsAsRead(userEmail) \{\
    const notifications = await this.getNotifications(userEmail);\
    notifications.forEach(n => n.read = true);\
    localStorage.setItem(`notifications_$\{userEmail\}`, JSON.stringify(notifications));\
  \}\
\
  // File Management System\
  async uploadFile(fileData) \{\
    const files = JSON.parse(localStorage.getItem('files') || '[]');\
    const newFile = \{\
      id: Math.random().toString(36).substr(2, 9),\
      ...fileData,\
      uploadedAt: new Date().toISOString()\
    \};\
    \
    files.push(newFile);\
    localStorage.setItem('files', JSON.stringify(files));\
    return newFile;\
  \}\
\
  async getFiles(filters = \{\}) \{\
    const files = JSON.parse(localStorage.getItem('files') || '[]');\
    \
    if (filters.jobId) \{\
      return files.filter(file => file.jobId === filters.jobId);\
    \}\
    if (filters.clientEmail) \{\
      return files.filter(file => file.clientEmail === filters.clientEmail);\
    \}\
    if (filters.uploadedBy) \{\
      return files.filter(file => file.uploadedBy === filters.uploadedBy);\
    \}\
    \
    return files;\
  \}\
\
  async deleteFile(fileId) \{\
    const files = JSON.parse(localStorage.getItem('files') || '[]');\
    const updatedFiles = files.filter(file => file.id !== fileId);\
    localStorage.setItem('files', JSON.stringify(updatedFiles));\
  \}\
\
  // Analytics Data\
  async getAnalyticsData() \{\
    const jobs = await this.getJobs();\
    const invoices = await this.getInvoices();\
    const clients = await this.getClients();\
    const contractors = await this.getContractors();\
\
    // Revenue analytics\
    const currentMonth = new Date().getMonth();\
    const currentYear = new Date().getFullYear();\
    \
    const monthlyRevenue = [];\
    for (let i = 0; i < 12; i++) \{\
      const month = new Date(currentYear, i);\
      const monthInvoices = invoices.filter(inv => \{\
        const invDate = new Date(inv.createdAt);\
        return invDate.getMonth() === i && invDate.getFullYear() === currentYear && inv.status === 'paid';\
      \});\
      \
      monthlyRevenue.push(\{\
        month: month.toLocaleDateString('en-US', \{ month: 'short' \}),\
        revenue: monthInvoices.reduce((sum, inv) => sum + inv.totalAmount, 0),\
        invoiceCount: monthInvoices.length\
      \});\
    \}\
\
    // Job status distribution\
    const jobStatusData = [\
      \{ status: 'Pending', count: jobs.filter(j => j.status === 'pending').length, color: '#F59E0B' \},\
      \{ status: 'In Progress', count: jobs.filter(j => j.status === 'in-progress').length, color: '#3B82F6' \},\
      \{ status: 'Completed', count: jobs.filter(j => j.status === 'completed').length, color: '#10B981' \},\
      \{ status: 'Cancelled', count: jobs.filter(j => j.status === 'cancelled').length, color: '#EF4444' \}\
    ];\
\
    // Client satisfaction (mock data)\
    const clientSatisfaction = [\
      \{ month: 'Jan', score: 4.2 \},\
      \{ month: 'Feb', score: 4.5 \},\
      \{ month: 'Mar', score: 4.3 \},\
      \{ month: 'Apr', score: 4.7 \},\
      \{ month: 'May', score: 4.6 \},\
      \{ month: 'Jun', score: 4.8 \},\
      \{ month: 'Jul', score: 4.9 \},\
      \{ month: 'Aug', score: 4.7 \}\
    ];\
\
    // Top performing contractors\
    const contractorPerformance = contractors.map(contractor => (\{\
      name: contractor.name,\
      completedJobs: contractor.completedJobs,\
      rating: contractor.rating,\
      efficiency: Math.random() * 20 + 80 // Mock efficiency score\
    \}));\
\
    return \{\
      monthlyRevenue,\
      jobStatusData,\
      clientSatisfaction,\
      contractorPerformance,\
      totalRevenue: invoices.filter(inv => inv.status === 'paid').reduce((sum, inv) => sum + inv.totalAmount, 0),\
      averageJobValue: jobs.reduce((sum, job) => sum + job.value, 0) / jobs.length,\
      clientRetentionRate: 87.5, // Mock data\
      averageResponseTime: 2.3 // Mock data in hours\
    \};\
  \}\
\
  // Scheduling System\
  async getScheduleEvents(filters = \{\}) \{\
    const savedEvents = localStorage.getItem('scheduleEvents');\
    let events = savedEvents ? JSON.parse(savedEvents) : [];\
\
    if (events.length === 0) \{\
      events = await this.initializeDefaultSchedule();\
    \}\
\
    // Filter events based on criteria\
    if (filters.contractorEmail) \{\
      events = events.filter(event => event.assignedTo === filters.contractorEmail);\
    \}\
    if (filters.clientEmail) \{\
      events = events.filter(event => event.clientEmail === filters.clientEmail);\
    \}\
    if (filters.startDate && filters.endDate) \{\
      events = events.filter(event => \{\
        const eventDate = new Date(event.startTime);\
        return eventDate >= new Date(filters.startDate) && eventDate <= new Date(filters.endDate);\
      \});\
    \}\
\
    return events;\
  \}\
\
  async createScheduleEvent(eventData) \{\
    const events = await this.getScheduleEvents();\
    \
    // Check for conflicts\
    const conflicts = await this.checkScheduleConflicts(eventData);\
    if (conflicts.length > 0) \{\
      throw new Error(`Schedule conflict detected with existing appointment at $\{conflicts[0].startTime\}`);\
    \}\
\
    const newEvent = \{\
      id: Math.random().toString(36).substr(2, 9),\
      ...eventData,\
      createdAt: new Date().toISOString(),\
      status: 'scheduled'\
    \};\
\
    events.push(newEvent);\
    localStorage.setItem('scheduleEvents', JSON.stringify(events));\
    return newEvent;\
  \}\
\
  async updateScheduleEvent(eventId, updates) \{\
    const events = await this.getScheduleEvents();\
    const eventIndex = events.findIndex(event => event.id === eventId);\
    \
    if (eventIndex !== -1) \{\
      events[eventIndex] = \{ ...events[eventIndex], ...updates \};\
      localStorage.setItem('scheduleEvents', JSON.stringify(events));\
      return events[eventIndex];\
    \}\
    \
    return null;\
  \}\
\
  async deleteScheduleEvent(eventId) \{\
    const events = await this.getScheduleEvents();\
    const filteredEvents = events.filter(event => event.id !== eventId);\
    localStorage.setItem('scheduleEvents', JSON.stringify(filteredEvents));\
  \}\
\
  async checkScheduleConflicts(newEvent) \{\
    const events = await this.getScheduleEvents();\
    const newStart = new Date(newEvent.startTime);\
    const newEnd = new Date(newEvent.endTime);\
\
    return events.filter(event => \{\
      if (event.id === newEvent.id) return false; // Skip self when updating\
      if (event.assignedTo !== newEvent.assignedTo) return false; // Different contractor\
\
      const existingStart = new Date(event.startTime);\
      const existingEnd = new Date(event.endTime);\
\
      // Check for time overlap\
      return (newStart < existingEnd && newEnd > existingStart);\
    \});\
  \}\
\
  async getAvailableTimeSlots(contractorEmail, date, duration = 2) \{\
    const events = await this.getScheduleEvents(\{ contractorEmail \});\
    const dayStart = new Date(date);\
    dayStart.setHours(8, 0, 0, 0); // 8 AM start\
    const dayEnd = new Date(date);\
    dayEnd.setHours(18, 0, 0, 0); // 6 PM end\
\
    const dayEvents = events.filter(event => \{\
      const eventDate = new Date(event.startTime);\
      return eventDate.toDateString() === dayStart.toDateString();\
    \}).sort((a, b) => new Date(a.startTime) - new Date(b.startTime));\
\
    const availableSlots = [];\
    let currentTime = new Date(dayStart);\
\
    for (const event of dayEvents) \{\
      const eventStart = new Date(event.startTime);\
      \
      // Check if there's a gap before this event\
      while (currentTime.getTime() + (duration * 60 * 60 * 1000) <= eventStart.getTime()) \{\
        const slotEnd = new Date(currentTime.getTime() + (duration * 60 * 60 * 1000));\
        availableSlots.push(\{\
          start: new Date(currentTime),\
          end: slotEnd,\
          duration: duration\
        \});\
        currentTime = new Date(currentTime.getTime() + (60 * 60 * 1000)); // 1 hour increment\
      \}\
      \
      currentTime = new Date(event.endTime);\
    \}\
\
    // Check remaining time after last event\
    while (currentTime.getTime() + (duration * 60 * 60 * 1000) <= dayEnd.getTime()) \{\
      const slotEnd = new Date(currentTime.getTime() + (duration * 60 * 60 * 1000));\
      availableSlots.push(\{\
        start: new Date(currentTime),\
        end: slotEnd,\
        duration: duration\
      \});\
      currentTime = new Date(currentTime.getTime() + (60 * 60 * 1000));\
    \}\
\
    return availableSlots;\
  \}\
\
  async initializeDefaultSchedule() \{\
    const contractors = await this.getContractors();\
    const jobs = await this.getJobs();\
    \
    const defaultEvents = [\
      \{\
        id: 'event_1',\
        title: 'Network Infrastructure Setup - Phase 1',\
        jobId: 1,\
        clientEmail: 'client@acme.com',\
        clientName: 'Acme Corporation',\
        assignedTo: 'john@techephi.com',\
        contractorName: 'John Smith',\
        startTime: '2025-08-05T09:00:00Z',\
        endTime: '2025-08-05T13:00:00Z',\
        location: 'Acme Corp Office, Downtown',\
        description: 'Initial network hardware installation and configuration',\
        status: 'completed',\
        createdAt: '2025-08-01T10:00:00Z'\
      \},\
      \{\
        id: 'event_2',\
        title: 'Security Audit Consultation',\
        jobId: 3,\
        clientEmail: 'security@financepro.com',\
        clientName: 'Finance Pro LLC',\
        assignedTo: 'sarah@techephi.com',\
        contractorName: 'Sarah Johnson',\
        startTime: '2025-08-06T14:00:00Z',\
        endTime: '2025-08-06T17:00:00Z',\
        location: 'Finance Pro Office, Midtown',\
        description: 'Comprehensive security assessment and recommendations',\
        status: 'completed',\
        createdAt: '2025-08-01T11:00:00Z'\
      \},\
      \{\
        id: 'event_3',\
        title: 'Server Maintenance',\
        jobId: 2,\
        clientEmail: 'admin@techsolutions.com',\
        clientName: 'Tech Solutions Inc',\
        assignedTo: 'john@techephi.com',\
        contractorName: 'John Smith',\
        startTime: '2025-08-07T10:00:00Z',\
        endTime: '2025-08-07T12:00:00Z',\
        location: 'Remote',\
        description: 'Quarterly server maintenance and updates',\
        status: 'in-progress',\
        createdAt: '2025-08-02T09:00:00Z'\
      \},\
      \{\
        id: 'event_4',\
        title: 'Network Infrastructure Setup - Phase 2',\
        jobId: 1,\
        clientEmail: 'client@acme.com',\
        clientName: 'Acme Corporation',\
        assignedTo: 'john@techephi.com',\
        contractorName: 'John Smith',\
        startTime: '2025-08-08T09:00:00Z',\
        endTime: '2025-08-08T15:00:00Z',\
        location: 'Acme Corp Office, Downtown',\
        description: 'Network testing and optimization',\
        status: 'scheduled',\
        createdAt: '2025-08-02T10:00:00Z'\
      \},\
      \{\
        id: 'event_5',\
        title: 'Client Consultation - New Project',\
        jobId: null,\
        clientEmail: 'new.client@example.com',\
        clientName: 'Potential Client',\
        assignedTo: 'sarah@techephi.com',\
        contractorName: 'Sarah Johnson',\
        startTime: '2025-08-09T11:00:00Z',\
        endTime: '2025-08-09T12:00:00Z',\
        location: 'Tech Ephi Office',\
        description: 'Initial consultation for cybersecurity project',\
        status: 'scheduled',\
        createdAt: '2025-08-03T14:00:00Z'\
      \}\
    ];\
\
    localStorage.setItem('scheduleEvents', JSON.stringify(defaultEvents));\
    return defaultEvents;\
  \}\
\
  // Timeline/Gantt Chart Data\
  async getProjectTimelines() \{\
    const jobs = await this.getJobs();\
    const events = await this.getScheduleEvents();\
\
    return jobs.map(job => \{\
      const jobEvents = events.filter(event => event.jobId === job.id);\
      const startDate = jobEvents.length > 0 \
        ? Math.min(...jobEvents.map(e => new Date(e.startTime).getTime()))\
        : new Date(job.createdAt).getTime();\
      const endDate = new Date(job.dueDate).getTime();\
      \
      const progress = this.calculateJobProgress(job, jobEvents);\
\
      return \{\
        id: job.id,\
        title: job.title,\
        client: job.client,\
        startDate: new Date(startDate),\
        endDate: new Date(endDate),\
        progress: progress,\
        status: job.status,\
        events: jobEvents,\
        duration: Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)), // days\
        contractor: job.contractor || 'Unassigned'\
      \};\
    \});\
  \}\
\
  // Resource allocation optimization\
  async getOptimalContractorAssignment(serviceType, date, duration) \{\
    const contractors = await this.getContractors();\
    const events = await this.getScheduleEvents();\
\
    // Filter contractors by specialty\
    const suitableContractors = contractors.filter(contractor => \{\
      const specialties = contractor.specialties.map(s => s.toLowerCase());\
      return specialties.some(specialty => \
        serviceType.toLowerCase().includes(specialty) || \
        specialty.includes(serviceType.toLowerCase())\
      );\
    \});\
\
    // Calculate availability score for each contractor\
    const contractorScores = await Promise.all(\
      suitableContractors.map(async contractor => \{\
        const availableSlots = await this.getAvailableTimeSlots(\
          contractor.email, \
          date, \
          duration\
        );\
        \
        const dayEvents = events.filter(event => \{\
          const eventDate = new Date(event.startTime);\
          return eventDate.toDateString() === new Date(date).toDateString() &&\
                 event.assignedTo === contractor.email;\
        \});\
\
        return \{\
          contractor,\
          availabilityScore: availableSlots.length,\
          workloadScore: Math.max(0, 8 - dayEvents.length), // Prefer less busy contractors\
          ratingScore: contractor.rating * 2,\
          totalScore: availableSlots.length + Math.max(0, 8 - dayEvents.length) + (contractor.rating * 2)\
        \};\
      \})\
    );\
\
    // Sort by total score (availability + workload + rating)\
    contractorScores.sort((a, b) => b.totalScore - a.totalScore);\
    \
    return contractorScores.map(score => (\{\
      ...score.contractor,\
      recommendationScore: score.totalScore,\
      availableSlots: score.availabilityScore\
    \}));\
  \}\
\
  // Calendar integration utilities\
  async generateCalendarExport(userEmail, startDate, endDate) \{\
    const events = await this.getScheduleEvents(\{\
      contractorEmail: userEmail,\
      startDate,\
      endDate\
    \});\
\
    // Generate ICS format for calendar import\
    const icsEvents = events.map(event => \{\
      const start = new Date(event.startTime);\
      const end = new Date(event.endTime);\
      \
      return `BEGIN:VEVENT\
UID:$\{event.id\}@techephi.com\
DTSTART:$\{start.toISOString().replace(/[-:]/g, '').split('.')[0]\}Z\
DTEND:$\{end.toISOString().replace(/[-:]/g, '').split('.')[0]\}Z\
SUMMARY:$\{event.title\}\
DESCRIPTION:$\{event.description\}\
LOCATION:$\{event.location\}\
STATUS:$\{event.status.toUpperCase()\}\
END:VEVENT`;\
    \}).join('\\n');\
\
    return `BEGIN:VCALENDAR\
VERSION:2.0\
PRODID:-//Tech Ephi//Schedule Export//EN\
$\{icsEvents\}\
END:VCALENDAR`;\
  \}\
\
  // Automated scheduling suggestions\
  async suggestOptimalSchedule(requirements) \{\
    const \{ serviceType, preferredDates, duration, clientEmail, urgency \} = requirements;\
    \
    const suggestions = [];\
    \
    for (const date of preferredDates) \{\
      const contractors = await this.getOptimalContractorAssignment(serviceType, date, duration);\
      \
      for (const contractor of contractors.slice(0, 3)) \{ // Top 3 recommendations\
        const slots = await this.getAvailableTimeSlots(contractor.email, date, duration);\
        \
        if (slots.length > 0) \{\
          suggestions.push(\{\
            date: new Date(date),\
            contractor: contractor,\
            availableSlots: slots,\
            recommendationReason: this.getRecommendationReason(contractor),\
            urgencyMatch: this.calculateUrgencyMatch(urgency, slots.length)\
          \});\
        \}\
      \}\
    \}\
\
    // Sort by urgency match and contractor score\
    return suggestions.sort((a, b) => \{\
      const urgencyDiff = b.urgencyMatch - a.urgencyMatch;\
      if (urgencyDiff !== 0) return urgencyDiff;\
      return b.contractor.recommendationScore - a.contractor.recommendationScore;\
    \});\
  \}\
\
  getRecommendationReason(contractor) \{\
    const reasons = [];\
    if (contractor.rating >= 4.5) reasons.push('Highly rated');\
    if (contractor.availableSlots > 5) reasons.push('Very available');\
    if (contractor.completedJobs > 20) reasons.push('Experienced');\
    return reasons.join(', ') || 'Good match';\
  \}\
\
// Enhanced Schedule Dashboard with Resource Optimization\
const ResourceAllocationView = () => \{\
  const [contractors, setContractors] = useState([]);\
  const [workloadData, setWorkloadData] = useState([]);\
  const [selectedWeek, setSelectedWeek] = useState(new Date());\
  const [loading, setLoading] = useState(true);\
\
  useEffect(() => \{\
    loadResourceData();\
  \}, [selectedWeek]);\
\
  const loadResourceData = async () => \{\
    try \{\
      const [contractorsData, eventsData] = await Promise.all([\
        firebase.getContractors(),\
        firebase.getScheduleEvents()\
      ]);\
\
      // Calculate workload for each contractor\
      const weekStart = new Date(selectedWeek);\
      weekStart.setDate(weekStart.getDate() - weekStart.getDay());\
      const weekEnd = new Date(weekStart);\
      weekEnd.setDate(weekEnd.getDate() + 6);\
\
      const workload = contractorsData.map(contractor => \{\
        const weekEvents = eventsData.filter(event => \{\
          const eventDate = new Date(event.startTime);\
          return event.assignedTo === contractor.email &&\
                 eventDate >= weekStart && eventDate <= weekEnd;\
        \});\
\
        const totalHours = weekEvents.reduce((sum, event) => \{\
          const duration = (new Date(event.endTime) - new Date(event.startTime)) / (1000 * 60 * 60);\
          return sum + duration;\
        \}, 0);\
\
        const utilization = (totalHours / 40) * 100; // 40 hour work week\
\
        return \{\
          contractor,\
          weekEvents,\
          totalHours: Math.round(totalHours * 10) / 10,\
          utilization: Math.round(utilization),\
          efficiency: contractor.rating * 20,\
          availability: Math.max(0, 40 - totalHours)\
        \};\
      \});\
\
      setContractors(contractorsData);\
      setWorkloadData(workload);\
    \} catch (error) \{\
      console.error('Error loading resource data:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  const getUtilizationColor = (utilization) => \{\
    if (utilization > 100) return 'bg-red-500';\
    if (utilization > 80) return 'bg-yellow-500';\
    if (utilization > 60) return 'bg-green-500';\
    return 'bg-blue-500';\
  \};\
\
  const navigateWeek = (direction) => \{\
    setSelectedWeek(prev => \{\
      const newDate = new Date(prev);\
      newDate.setDate(prev.getDate() + (direction * 7));\
      return newDate;\
    \});\
  \};\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading resource allocation...</div>\
    </div>;\
  \}\
\
  return (\
    <div className="space-y-6">\
      \{/* Header */\}\
      <div className="flex justify-between items-center">\
        <div>\
          <h3 className="text-xl font-semibold text-gray-900">Resource Allocation</h3>\
          <p className="text-gray-600">\
            Week of \{selectedWeek.toLocaleDateString('en-US', \{ \
              month: 'long', \
              day: 'numeric', \
              year: 'numeric' \
            \})\}\
          </p>\
        </div>\
        <div className="flex items-center gap-2">\
          <Button variant="ghost" onClick=\{() => navigateWeek(-1)\}>\
            <ChevronDown className="w-4 h-4 rotate-90" />\
            Previous Week\
          </Button>\
          <Button variant="ghost" onClick=\{() => navigateWeek(1)\}>\
            Next Week\
            <ChevronDown className="w-4 h-4 -rotate-90" />\
          </Button>\
        </div>\
      </div>\
\
      \{/* Resource Overview Cards */\}\
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">\
        <MetricCard\
          title="Total Contractors"\
          value=\{contractors.length.toString()\}\
          icon=\{Users\}\
          color="blue"\
        />\
        <MetricCard\
          title="Avg Utilization"\
          value=\{`$\{Math.round(workloadData.reduce((sum, w) => sum + w.utilization, 0) / workloadData.length)\}%`\}\
          icon=\{Activity\}\
          color="green"\
        />\
        <MetricCard\
          title="Overutilized"\
          value=\{workloadData.filter(w => w.utilization > 100).length.toString()\}\
          icon=\{AlertCircle\}\
          color="red"\
        />\
        <MetricCard\
          title="Available Hours"\
          value=\{workloadData.reduce((sum, w) => sum + w.availability, 0).toFixed(1)\}\
          icon=\{Clock\}\
          color="purple"\
        />\
      </div>\
\
      \{/* Contractor Workload Table */\}\
      <Card className="overflow-hidden">\
        <div className="p-6">\
          <h4 className="text-lg font-medium text-gray-900 mb-4">Contractor Workload Analysis</h4>\
          <div className="overflow-x-auto">\
            <table className="w-full">\
              <thead className="bg-gray-50 border-b border-gray-200">\
                <tr>\
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Contractor</th>\
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Scheduled Hours</th>\
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Utilization</th>\
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Efficiency</th>\
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Available Hours</th>\
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">This Week</th>\
                </tr>\
              </thead>\
              <tbody className="divide-y divide-gray-200">\
                \{workloadData.map((data) => (\
                  <tr key=\{data.contractor.id\} className="hover:bg-gray-50">\
                    <td className="px-6 py-4 whitespace-nowrap">\
                      <div>\
                        <div className="font-medium text-gray-900">\{data.contractor.name\}</div>\
                        <div className="text-sm text-gray-500">\{data.contractor.specialties.join(', ')\}</div>\
                      </div>\
                    </td>\
                    <td className="px-6 py-4 whitespace-nowrap">\
                      <span className="text-sm font-medium text-gray-900">\{data.totalHours\}h</span>\
                    </td>\
                    <td className="px-6 py-4 whitespace-nowrap">\
                      <div className="flex items-center gap-2">\
                        <div className="flex-1 bg-gray-200 rounded-full h-2 max-w-[100px]">\
                          <div \
                            className=\{`h-2 rounded-full $\{getUtilizationColor(data.utilization)\}`\}\
                            style=\{\{ width: `$\{Math.min(100, data.utilization)\}%` \}\}\
                          />\
                        </div>\
                        <span className="text-sm text-gray-600 min-w-[40px]">\{data.utilization\}%</span>\
                      </div>\
                    </td>\
                    <td className="px-6 py-4 whitespace-nowrap">\
                      <div className="flex items-center gap-1">\
                        <Star className="w-4 h-4 text-yellow-400 fill-current" />\
                        <span className="text-sm text-gray-900">\{data.contractor.rating\}</span>\
                      </div>\
                    </td>\
                    <td className="px-6 py-4 whitespace-nowrap">\
                      <span className="text-sm text-gray-900">\{data.availability.toFixed(1)\}h</span>\
                    </td>\
                    <td className="px-6 py-4 whitespace-nowrap">\
                      <div className="flex flex-wrap gap-1">\
                        \{data.weekEvents.slice(0, 3).map(event => (\
                          <Badge \
                            key=\{event.id\} \
                            variant="default" \
                            size="sm"\
                            className="bg-blue-100 text-blue-800"\
                          >\
                            \{new Date(event.startTime).toLocaleDateString('en-US', \{ weekday: 'short' \})\}\
                          </Badge>\
                        ))\}\
                        \{data.weekEvents.length > 3 && (\
                          <Badge variant="default" size="sm" className="bg-gray-100 text-gray-600">\
                            +\{data.weekEvents.length - 3\}\
                          </Badge>\
                        )\}\
                      </div>\
                    </td>\
                  </tr>\
                ))\}\
              </tbody>\
            </table>\
          </div>\
        </div>\
      </Card>\
    </div>\
  );\
\};\
\
// Enhanced Calendar Export Component\
const CalendarExportModal = (\{ isOpen, onClose \}) => \{\
  const \{ user \} = useAuth();\
  const [exportRange, setExportRange] = useState('month');\
  const [exporting, setExporting] = useState(false);\
\
  const handleExport = async () => \{\
    setExporting(true);\
    try \{\
      const now = new Date();\
      let startDate, endDate;\
\
      switch (exportRange) \{\
        case 'week':\
          startDate = new Date(now);\
          startDate.setDate(now.getDate() - now.getDay());\
          endDate = new Date(startDate);\
          endDate.setDate(startDate.getDate() + 6);\
          break;\
        case 'month':\
          startDate = new Date(now.getFullYear(), now.getMonth(), 1);\
          endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);\
          break;\
        case 'quarter':\
          const quarter = Math.floor(now.getMonth() / 3);\
          startDate = new Date(now.getFullYear(), quarter * 3, 1);\
          endDate = new Date(now.getFullYear(), (quarter + 1) * 3, 0);\
          break;\
        default:\
          startDate = now;\
          endDate = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);\
      \}\
\
      const icsContent = await firebase.generateCalendarExport(\
        user?.email,\
        startDate.toISOString(),\
        endDate.toISOString()\
      );\
\
      // Create and download file\
      const blob = new Blob([icsContent], \{ type: 'text/calendar' \});\
      const url = URL.createObjectURL(blob);\
      const link = document.createElement('a');\
      link.href = url;\
      link.download = `techephi-schedule-$\{exportRange\}.ics`;\
      document.body.appendChild(link);\
      link.click();\
      document.body.removeChild(link);\
      URL.revokeObjectURL(url);\
\
      onClose();\
    \} catch (error) \{\
      console.error('Error exporting calendar:', error);\
    \} finally \{\
      setExporting(false);\
    \}\
  \};\
\
  return (\
    <Modal isOpen=\{isOpen\} onClose=\{onClose\} title="Export Calendar">\
      <div className="space-y-4">\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-2">\
            Export Range\
          </label>\
          <select\
            value=\{exportRange\}\
            onChange=\{(e) => setExportRange(e.target.value)\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
          >\
            <option value="week">This Week</option>\
            <option value="month">This Month</option>\
            <option value="quarter">This Quarter</option>\
          </select>\
        </div>\
\
        <div className="bg-blue-50 p-4 rounded-lg">\
          <h4 className="font-medium text-blue-900 mb-2">Export Information</h4>\
          <ul className="text-sm text-blue-800 space-y-1">\
            <li>\'95 Export includes all your scheduled appointments</li>\
            <li>\'95 Compatible with Google Calendar, Outlook, and Apple Calendar</li>\
            <li>\'95 File will be downloaded as .ics format</li>\
            <li>\'95 Updates to the original schedule won't sync automatically</li>\
          </ul>\
        </div>\
\
        <div className="flex gap-3 pt-4">\
          <Button \
            onClick=\{handleExport\} \
            className="flex-1"\
            loading=\{exporting\}\
          >\
            <Download className="w-4 h-4" />\
            Export Calendar\
          </Button>\
          <Button type="button" variant="secondary" onClick=\{onClose\}>\
            Cancel\
          </Button>\
        </div>\
      </div>\
    </Modal>\
  );\
\};\
\
// Add to existing ScheduleView component\
const ScheduleViewEnhanced = () => \{\
  const \{ user \} = useAuth();\
  const [currentView, setCurrentView] = useState('calendar');\
  const [events, setEvents] = useState([]);\
  const [loading, setLoading] = useState(true);\
  const [selectedDate, setSelectedDate] = useState(new Date());\
  const [showEventModal, setShowEventModal] = useState(false);\
  const [showExportModal, setShowExportModal] = useState(false);\
  const [selectedEvent, setSelectedEvent] = useState(null);\
\
  useEffect(() => \{\
    loadEvents();\
  \}, [user, selectedDate]);\
\
  const loadEvents = async () => \{\
    try \{\
      let filters = \{\};\
      \
      if (user?.role === 'contractor') \{\
        filters.contractorEmail = user.email;\
      \} else if (user?.role === 'client') \{\
        filters.clientEmail = user.email;\
      \}\
\
      const eventsData = await firebase.getScheduleEvents(filters);\
      setEvents(eventsData);\
    \} catch (error) \{\
      console.error('Error loading events:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  const handleCreateEvent = async (eventData) => \{\
    try \{\
      await firebase.createScheduleEvent(eventData);\
      loadEvents();\
    \} catch (error) \{\
      console.error('Error creating event:', error);\
      alert(error.message);\
    \}\
  \};\
\
  const handleUpdateEvent = async (eventId, updates) => \{\
    try \{\
      await firebase.updateScheduleEvent(eventId, updates);\
      loadEvents();\
    \} catch (error) \{\
      console.error('Error updating event:', error);\
    \}\
  \};\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading schedule...</div>\
    </div>;\
  \}\
\
  return (\
    <div className="space-y-6">\
      \{/* Enhanced Header */\}\
      <div className="flex justify-between items-center">\
        <div>\
          <h2 className="text-2xl font-bold text-gray-900">Schedule Management</h2>\
          <p className="text-gray-600">Manage appointments and track project timelines</p>\
        </div>\
        <div className="flex items-center gap-3">\
          <div className="flex rounded-lg border border-gray-200">\
            <button\
              onClick=\{() => setCurrentView('calendar')\}\
              className=\{`px-4 py-2 text-sm font-medium rounded-l-lg transition-colors $\{\
                currentView === 'calendar' \
                  ? 'bg-[#3B0A69] text-white' \
                  : 'text-gray-700 hover:bg-gray-50'\
              \}`\}\
            >\
              Calendar\
            </button>\
            <button\
              onClick=\{() => setCurrentView('timeline')\}\
              className=\{`px-4 py-2 text-sm font-medium transition-colors $\{\
                currentView === 'timeline' \
                  ? 'bg-[#3B0A69] text-white' \
                  : 'text-gray-700 hover:bg-gray-50'\
              \}`\}\
            >\
              Timeline\
            </button>\
            \{user?.role === 'admin' && (\
              <button\
                onClick=\{() => setCurrentView('resources')\}\
                className=\{`px-4 py-2 text-sm font-medium rounded-r-lg transition-colors $\{\
                  currentView === 'resources' \
                    ? 'bg-[#3B0A69] text-white' \
                    : 'text-gray-700 hover:bg-gray-50'\
                \}`\}\
              >\
                Resources\
              </button>\
            )\}\
          </div>\
          \
          <Button variant="ghost" onClick=\{() => setShowExportModal(true)\}>\
            <Download className="w-4 h-4" />\
            Export\
          </Button>\
          \
          \{user?.role === 'admin' && (\
            <Button onClick=\{() => setShowEventModal(true)\}>\
              <Plus className="w-4 h-4" />\
              Schedule Appointment\
            </Button>\
          )\}\
        </div>\
      </div>\
\
      \{/* Enhanced View Content */\}\
      \{currentView === 'calendar' && (\
        <CalendarView \
          events=\{events\}\
          selectedDate=\{selectedDate\}\
          onDateSelect=\{setSelectedDate\}\
          onEventClick=\{(event) => \{\
            setSelectedEvent(event);\
            setShowEventModal(true);\
          \}\}\
          userRole=\{user?.role\}\
        />\
      )\}\
      \
      \{currentView === 'timeline' && (\
        <TimelineView userRole=\{user?.role\} />\
      )\}\
      \
      \{currentView === 'resources' && user?.role === 'admin' && (\
        <ResourceAllocationView />\
      )\}\
\
      \{/* Modals */\}\
      <EventModal\
        isOpen=\{showEventModal\}\
        onClose=\{() => \{\
          setShowEventModal(false);\
          setSelectedEvent(null);\
        \}\}\
        event=\{selectedEvent\}\
        onSubmit=\{selectedEvent ? handleUpdateEvent : handleCreateEvent\}\
        userRole=\{user?.role\}\
      />\
\
      <CalendarExportModal\
        isOpen=\{showExportModal\}\
        onClose=\{() => setShowExportModal(false)\}\
      />\
    </div>\
  );\
\};\
\
\};\
\
const calculateJobProgress = (job, events) => \{\
  const completedEvents = events.filter(e => e.status === 'completed').length;\
  const totalEvents = events.length || 1;\
  const baseProgress = (completedEvents / totalEvents) * 80; // 80% max from events\
  \
  // Add status-based progress\
  const statusProgress = \{\
    'pending': 0,\
    'in-progress': 20,\
    'completed': 100,\
    'cancelled': 0\
  \};\
\
  return Math.min(100, baseProgress + statusProgress[job.status]);\
\};\
  async initializeDefaultFiles() \{\
    const existingFiles = JSON.parse(localStorage.getItem('files') || '[]');\
    \
    if (existingFiles.length === 0) \{\
      const defaultFiles = [\
        \{\
          id: 'file_1',\
          name: 'Network_Diagram_Acme.pdf',\
          size: '2.4 MB',\
          type: 'application/pdf',\
          jobId: 1,\
          clientEmail: 'client@acme.com',\
          uploadedBy: 'admin@techephi.com',\
          uploadedAt: '2025-08-01T10:00:00Z',\
          category: 'documentation'\
        \},\
        \{\
          id: 'file_2',\
          name: 'Security_Report_FinancePro.pdf',\
          size: '5.7 MB',\
          type: 'application/pdf',\
          jobId: 3,\
          clientEmail: 'security@financepro.com',\
          uploadedBy: 'sarah@techephi.com',\
          uploadedAt: '2025-08-01T14:30:00Z',\
          category: 'reports'\
        \},\
        \{\
          id: 'file_3',\
          name: 'Server_Config_Backup.json',\
          size: '156 KB',\
          type: 'application/json',\
          jobId: 2,\
          clientEmail: 'admin@techsolutions.com',\
          uploadedBy: 'john@techephi.com',\
          uploadedAt: '2025-07-28T16:45:00Z',\
          category: 'configuration'\
        \}\
      ];\
      \
      localStorage.setItem('files', JSON.stringify(defaultFiles));\
    \}\
  \}\
  async initializeDefaultMessages() \{\
    const conversations = JSON.parse(localStorage.getItem('conversations') || '[]');\
    \
    if (conversations.length === 0) \{\
      // Create default conversations\
      const defaultConversations = [\
        \{\
          id: 'conv_1',\
          title: 'Network Infrastructure Project',\
          participants: ['admin@techephi.com', 'client@acme.com'],\
          jobId: 1,\
          createdAt: '2025-08-01T10:00:00Z',\
          lastMessage: 'The network setup is progressing well. We should be done by Friday.',\
          lastMessageTime: '2025-08-02T14:30:00Z',\
          unreadCount: 2\
        \},\
        \{\
          id: 'conv_2',\
          title: 'Security Audit Discussion',\
          participants: ['admin@techephi.com', 'security@financepro.com'],\
          jobId: 3,\
          createdAt: '2025-07-25T09:00:00Z',\
          lastMessage: 'Thank you for the comprehensive security report.',\
          lastMessageTime: '2025-08-01T16:45:00Z',\
          unreadCount: 0\
        \},\
        \{\
          id: 'conv_3',\
          title: 'Project Assignment',\
          participants: ['admin@techephi.com', 'john@techephi.com'],\
          jobId: 1,\
          createdAt: '2025-08-01T08:00:00Z',\
          lastMessage: 'I can start the network installation tomorrow morning.',\
          lastMessageTime: '2025-08-02T09:15:00Z',\
          unreadCount: 1\
        \}\
      ];\
      \
      localStorage.setItem('conversations', JSON.stringify(defaultConversations));\
      \
      // Create default messages\
      const defaultMessages = \{\
        conv_1: [\
          \{\
            id: 'msg_1',\
            conversationId: 'conv_1',\
            senderId: 'admin@techephi.com',\
            senderName: 'Admin',\
            senderRole: 'admin',\
            content: 'Hello! I wanted to update you on the network infrastructure project progress.',\
            timestamp: '2025-08-01T10:30:00Z',\
            read: true,\
            attachments: []\
          \},\
          \{\
            id: 'msg_2',\
            conversationId: 'conv_1',\
            senderId: 'client@acme.com',\
            senderName: 'Acme Corp',\
            senderRole: 'client',\
            content: 'Great! How is everything going? Any challenges so far?',\
            timestamp: '2025-08-01T11:15:00Z',\
            read: true,\
            attachments: []\
          \},\
          \{\
            id: 'msg_3',\
            conversationId: 'conv_1',\
            senderId: 'admin@techephi.com',\
            senderName: 'Admin',\
            senderRole: 'admin',\
            content: 'The network setup is progressing well. We should be done by Friday.',\
            timestamp: '2025-08-02T14:30:00Z',\
            read: false,\
            attachments: []\
          \}\
        ],\
        conv_2: [\
          \{\
            id: 'msg_4',\
            conversationId: 'conv_2',\
            senderId: 'admin@techephi.com',\
            senderName: 'Admin',\
            senderRole: 'admin',\
            content: 'The security audit has been completed. Please find the detailed report attached.',\
            timestamp: '2025-08-01T14:00:00Z',\
            read: true,\
            attachments: [\{ name: 'Security_Audit_Report.pdf', size: '2.4 MB' \}]\
          \},\
          \{\
            id: 'msg_5',\
            conversationId: 'conv_2',\
            senderId: 'security@financepro.com',\
            senderName: 'Finance Pro',\
            senderRole: 'client',\
            content: 'Thank you for the comprehensive security report.',\
            timestamp: '2025-08-01T16:45:00Z',\
            read: true,\
            attachments: []\
          \}\
        ],\
        conv_3: [\
          \{\
            id: 'msg_6',\
            conversationId: 'conv_3',\
            senderId: 'admin@techephi.com',\
            senderName: 'Admin',\
            senderRole: 'admin',\
            content: 'Hi John, I have a new network infrastructure project for you at Acme Corp. Can you handle it?',\
            timestamp: '2025-08-01T08:30:00Z',\
            read: true,\
            attachments: []\
          \},\
          \{\
            id: 'msg_7',\
            conversationId: 'conv_3',\
            senderId: 'john@techephi.com',\
            senderName: 'John Smith',\
            senderRole: 'contractor',\
            content: 'I can start the network installation tomorrow morning.',\
            timestamp: '2025-08-02T09:15:00Z',\
            read: false,\
            attachments: []\
          \}\
        ]\
      \};\
      \
      Object.entries(defaultMessages).forEach(([convId, messages]) => \{\
        localStorage.setItem(`messages_$\{convId\}`, JSON.stringify(messages));\
      \});\
    \}\
  \}\
\
  async getClients() \{\
    return [\
      \{\
        id: 1,\
        name: 'Acme Corporation',\
        email: 'client@acme.com',\
        phone: '+1 (555) 123-4567',\
        address: '123 Business Ave, Suite 100',\
        totalJobs: 5,\
        activeJobs: 2,\
        totalSpent: 45000\
      \},\
      \{\
        id: 2,\
        name: 'Tech Solutions Inc',\
        email: 'admin@techsolutions.com',\
        phone: '+1 (555) 987-6543',\
        address: '456 Innovation Drive',\
        totalJobs: 8,\
        activeJobs: 1,\
        totalSpent: 23500\
      \}\
    ];\
  \}\
\
  async getContractors() \{\
    return [\
      \{\
        id: 1,\
        name: 'John Smith',\
        email: 'john@techephi.com',\
        phone: '+1 (555) 111-2222',\
        specialties: ['Network Security', 'Infrastructure'],\
        activeJobs: 3,\
        completedJobs: 15,\
        rating: 4.8\
      \},\
      \{\
        id: 2,\
        name: 'Sarah Johnson',\
        email: 'sarah@techephi.com',\
        phone: '+1 (555) 333-4444',\
        specialties: ['Cybersecurity', 'Penetration Testing'],\
        activeJobs: 2,\
        completedJobs: 22,\
        rating: 4.9\
      \}\
    ];\
  \}\
\
  determineRole(email) \{\
    if (email.includes('admin') || email.includes('@techephi.com')) \{\
      return 'admin';\
    \} else if (email.includes('contractor') || email.includes('john@') || email.includes('sarah@')) \{\
      return 'contractor';\
    \}\
    return 'client';\
  \}\
\
  onAuthStateChanged(callback) \{\
    // Simulate auth state persistence\
    const savedUser = localStorage.getItem('currentUser');\
    if (savedUser) \{\
      this.currentUser = JSON.parse(savedUser);\
      this.isAuthenticated = true;\
      callback(this.currentUser);\
    \} else \{\
      callback(null);\
    \}\
  \}\
\}\
\
// Enhanced Firebase service instance\
const firebase = new FirebaseService();\
\
// Initialize data on app start\
firebase.initializeDefaultJobs().catch(err => \
  errorHandler.logError(err, \{ operation: 'initializeDefaultJobs' \})\
);\
\
// Cleanup loading states periodically\
setInterval(() => \{\
  loadingManager.cleanup();\
\}, 30000);\
\
// Firebase Configuration (kept for reference)\
const firebaseConfig = \{\
  apiKey: "AIzaSyBjHLhECxsAW8DWN63tTVZSCExpT33tFUg",\
  authDomain: "lifeline-37sh6.firebaseapp.com",\
  projectId: "lifeline-37sh6",\
  storageBucket: "lifeline-37sh6.firebasestorage.app",\
  messagingSenderId: "24849207864",\
  appId: "1:24849207864:web:ddfeef6f0efa16135c0ccd"\
\};\
\
// Context for user authentication and data management\
const AuthContext = createContext();\
\
const AuthProvider = (\{ children \}) => \{\
  const [user, setUser] = useState(null);\
  const [loading, setLoading] = useState(true);\
\
  useEffect(() => \{\
    firebase.onAuthStateChanged((user) => \{\
      setUser(user);\
      setLoading(false);\
    \});\
  \}, []);\
\
  const login = async (email, password) => \{\
    try \{\
      const result = await firebase.signInWithEmailAndPassword(email, password);\
      const userProfile = await firebase.getUserProfile(result.user.uid);\
      \
      const userData = \{\
        ...result.user,\
        ...userProfile\
      \};\
      \
      setUser(userData);\
      localStorage.setItem('currentUser', JSON.stringify(userData));\
      return userData;\
    \} catch (error) \{\
      throw error;\
    \}\
  \};\
\
  const register = async (email, password, role, additionalData = \{\}) => \{\
    try \{\
      const result = await firebase.createUserWithEmailAndPassword(email, password, role);\
      const userData = \{\
        ...result.user,\
        ...additionalData\
      \};\
      \
      setUser(userData);\
      localStorage.setItem('currentUser', JSON.stringify(userData));\
      return userData;\
    \} catch (error) \{\
      throw error;\
    \}\
  \};\
\
  const logout = async () => \{\
    await firebase.signOut();\
    setUser(null);\
    localStorage.removeItem('currentUser');\
  \};\
\
  return (\
    <AuthContext.Provider value=\{\{ user, login, register, logout, loading \}\}>\
      \{children\}\
    </AuthContext.Provider>\
  );\
\};\
\
// Enhanced Notification Context with Multi-Channel Support\
const NotificationContext = createContext();\
\
const NotificationProvider = (\{ children \}) => \{\
  const [notifications, setNotifications] = useState([]);\
  const [unreadCount, setUnreadCount] = useState(0);\
  const [preferences, setPreferences] = useState(null);\
  const \{ user \} = useAuth();\
\
  useEffect(() => \{\
    if (user?.email) \{\
      loadNotifications();\
      loadPreferences();\
      requestNotificationPermission();\
      \
      // Set up automated notification checking\
      const interval = setInterval(checkAutomatedNotifications, 60000); // Every minute\
      return () => clearInterval(interval);\
    \}\
  \}, [user]);\
\
  const requestNotificationPermission = async () => \{\
    if ('Notification' in window && Notification.permission === 'default') \{\
      const permission = await Notification.requestPermission();\
      console.log('Notification permission:', permission);\
    \}\
  \};\
\
  const loadNotifications = async () => \{\
    try \{\
      const notificationData = await firebase.getNotifications(user?.email);\
      setNotifications(notificationData);\
      setUnreadCount(notificationData.filter(n => !n.read).length);\
    \} catch (error) \{\
      console.error('Error loading notifications:', error);\
    \}\
  \};\
\
  const loadPreferences = async () => \{\
    try \{\
      const prefs = await firebase.getNotificationPreferences(user?.email);\
      setPreferences(prefs);\
    \} catch (error) \{\
      console.error('Error loading preferences:', error);\
    \}\
  \};\
\
  const createNotification = async (notification) => \{\
    try \{\
      await firebase.createNotification(user?.email, notification);\
      loadNotifications();\
    \} catch (error) \{\
      console.error('Error creating notification:', error);\
    \}\
  \};\
\
  const markAsRead = async (notificationId) => \{\
    try \{\
      await firebase.markNotificationAsRead(user?.email, notificationId);\
      loadNotifications();\
    \} catch (error) \{\
      console.error('Error marking notification as read:', error);\
    \}\
  \};\
\
  const markAllAsRead = async () => \{\
    try \{\
      await firebase.markAllNotificationsAsRead(user?.email);\
      loadNotifications();\
    \} catch (error) \{\
      console.error('Error marking all notifications as read:', error);\
    \}\
  \};\
\
  const updatePreferences = async (newPreferences) => \{\
    try \{\
      const updated = await firebase.updateNotificationPreferences(user?.email, newPreferences);\
      setPreferences(updated);\
    \} catch (error) \{\
      console.error('Error updating preferences:', error);\
    \}\
  \};\
\
  const checkAutomatedNotifications = async () => \{\
    try \{\
      await firebase.checkAndSendAutomatedNotifications();\
      loadNotifications();\
    \} catch (error) \{\
      console.error('Error checking automated notifications:', error);\
    \}\
  \};\
\
  const sendBulkNotification = async (userEmails, notification) => \{\
    try \{\
      return await firebase.sendBulkNotification(userEmails, notification);\
    \} catch (error) \{\
      console.error('Error sending bulk notification:', error);\
      return [];\
    \}\
  \};\
\
  const getAnalytics = async (days = 30) => \{\
    try \{\
      return await firebase.getNotificationAnalytics(user?.email, days);\
    \} catch (error) \{\
      console.error('Error getting notification analytics:', error);\
      return null;\
    \}\
  \};\
\
  return (\
    <NotificationContext.Provider value=\{\{\
      notifications,\
      unreadCount,\
      preferences,\
      createNotification,\
      markAsRead,\
      markAllAsRead,\
      updatePreferences,\
      loadNotifications,\
      sendBulkNotification,\
      getAnalytics\
    \}\}>\
      \{children\}\
    </NotificationContext.Provider>\
  );\
\};\
\
const useNotifications = () => \{\
  const context = useContext(NotificationContext);\
  if (!context) \{\
    throw new Error('useNotifications must be used within NotificationProvider');\
  \}\
  return context;\
\};\
\
// Utility Components\
const Button = (\{ \
  children, \
  variant = 'primary', \
  size = 'md', \
  className = '', \
  loading = false,\
  ...props \
\}) => \{\
  const baseClasses = 'inline-flex items-center justify-center font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed';\
  \
  const variants = \{\
    primary: 'bg-[#3B0A69] text-white hover:bg-[#2d0851] focus:ring-[#3B0A69] shadow-sm hover:shadow-md',\
    secondary: 'bg-white text-[#3B0A69] border border-[#3B0A69] hover:bg-[#3B0A69] hover:text-white focus:ring-[#3B0A69]',\
    ghost: 'text-gray-600 hover:text-[#3B0A69] hover:bg-gray-50 focus:ring-gray-200',\
    success: 'bg-green-600 text-white hover:bg-green-700 focus:ring-green-500',\
    warning: 'bg-yellow-500 text-white hover:bg-yellow-600 focus:ring-yellow-400',\
    danger: 'bg-red-600 text-white hover:bg-red-700 focus:ring-red-500'\
  \};\
  \
  const sizes = \{\
    sm: 'px-3 py-2 text-sm rounded-md gap-1.5',\
    md: 'px-4 py-2.5 text-sm rounded-lg gap-2',\
    lg: 'px-6 py-3 text-base rounded-lg gap-2'\
  \};\
  \
  return (\
    <button\
      className=\{`$\{baseClasses\} $\{variants[variant]\} $\{sizes[size]\} $\{className\}`\}\
      disabled=\{loading\}\
      \{...props\}\
    >\
      \{loading ? (\
        <div className="w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin" />\
      ) : (\
        children\
      )\}\
    </button>\
  );\
\};\
\
const Card = (\{ children, className = '', hover = true \}) => \{\
  return (\
    <div className=\{`bg-white rounded-xl border border-gray-200 shadow-sm $\{hover ? 'hover:shadow-md transition-shadow duration-200' : ''\} $\{className\}`\}>\
      \{children\}\
    </div>\
  );\
\};\
\
const Badge = (\{ children, variant = 'default', size = 'sm' \}) => \{\
  const variants = \{\
    default: 'bg-gray-100 text-gray-800',\
    success: 'bg-green-100 text-green-800',\
    warning: 'bg-yellow-100 text-yellow-800',\
    danger: 'bg-red-100 text-red-800',\
    info: 'bg-blue-100 text-blue-800',\
    purple: 'bg-purple-100 text-purple-800'\
  \};\
  \
  const sizes = \{\
    sm: 'px-2 py-1 text-xs',\
    md: 'px-3 py-1.5 text-sm'\
  \};\
  \
  return (\
    <span className=\{`inline-flex items-center rounded-full font-medium $\{variants[variant]\} $\{sizes[size]\}`\}>\
      \{children\}\
    </span>\
  );\
\};\
\
const Modal = (\{ isOpen, onClose, title, children \}) => \{\
  if (!isOpen) return null;\
\
  return (\
    <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">\
      <div className="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto">\
        <div className="flex items-center justify-between p-6 border-b border-gray-200">\
          <h2 className="text-lg font-semibold text-gray-900">\{title\}</h2>\
          <button\
            onClick=\{onClose\}\
            className="text-gray-400 hover:text-gray-600 transition-colors"\
          >\
            <X className="w-5 h-5" />\
          </button>\
        </div>\
        <div className="p-6">\
          \{children\}\
        </div>\
      </div>\
    </div>\
  );\
\};\
\
// Navigation Components\
const Sidebar = (\{ isOpen, onClose, currentView, setCurrentView \}) => \{\
  const \{ user, logout \} = useAuth();\
  \
  const adminNavItems = [\
    \{ icon: BarChart3, label: 'Dashboard', id: 'dashboard' \},\
    \{ icon: TrendingUp, label: 'Analytics', id: 'analytics' \},\
    \{ icon: Users, label: 'Clients', id: 'clients' \},\
    \{ icon: User, label: 'Contractors', id: 'contractors' \},\
    \{ icon: Briefcase, label: 'Jobs', id: 'jobs' \},\
    \{ icon: Calendar, label: 'Schedule', id: 'schedule' \},\
    \{ icon: FileText, label: 'Invoices', id: 'invoices' \},\
    \{ icon: Upload, label: 'Files', id: 'files' \},\
    \{ icon: MessageSquare, label: 'Messages', id: 'messages' \},\
    \{ icon: Settings, label: 'Settings', id: 'settings' \}\
  ];\
  \
  const clientNavItems = [\
    \{ icon: BarChart3, label: 'Dashboard', id: 'dashboard' \},\
    \{ icon: Briefcase, label: 'My Jobs', id: 'jobs' \},\
    \{ icon: Calendar, label: 'Book Service', id: 'schedule' \},\
    \{ icon: FileText, label: 'Invoices', id: 'invoices' \},\
    \{ icon: Upload, label: 'Files', id: 'files' \},\
    \{ icon: MessageSquare, label: 'Support', id: 'support' \},\
    \{ icon: Settings, label: 'Profile', id: 'profile' \}\
  ];\
  \
  const contractorNavItems = [\
    \{ icon: BarChart3, label: 'Dashboard', id: 'dashboard' \},\
    \{ icon: Briefcase, label: 'Assigned Jobs', id: 'jobs' \},\
    \{ icon: Calendar, label: 'Schedule', id: 'schedule' \},\
    \{ icon: Upload, label: 'Files', id: 'files' \},\
    \{ icon: MessageSquare, label: 'Messages', id: 'messages' \},\
    \{ icon: Settings, label: 'Profile', id: 'profile' \}\
  ];\
  \
  const navItems = user?.role === 'admin' ? adminNavItems : \
                   user?.role === 'contractor' ? contractorNavItems : clientNavItems;\
  \
  return (\
    <>\
      \{/* Mobile overlay */\}\
      \{isOpen && (\
        <div \
          className="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"\
          onClick=\{onClose\}\
        />\
      )\}\
      \
      \{/* Sidebar */\}\
      <div className=\{`fixed inset-y-0 left-0 z-50 w-64 bg-white border-r border-gray-200 transform transition-transform duration-300 ease-in-out lg:translate-x-0 $\{isOpen ? 'translate-x-0' : '-translate-x-full'\}`\}>\
        <div className="flex flex-col h-full">\
          \{/* Logo */\}\
          <div className="flex items-center justify-between p-6 border-b border-gray-200">\
            <div className="flex items-center gap-3">\
              <div className="w-8 h-8 bg-gradient-to-br from-[#3B0A69] to-purple-600 rounded-lg flex items-center justify-center">\
                <Zap className="w-5 h-5 text-white" />\
              </div>\
              <div>\
                <h1 className="text-lg font-bold text-gray-900">Tech Ephi</h1>\
                <p className="text-xs text-gray-500 capitalize">\{user?.role\} Portal</p>\
              </div>\
            </div>\
            <button onClick=\{onClose\} className="lg:hidden">\
              <X className="w-5 h-5 text-gray-500" />\
            </button>\
          </div>\
          \
          \{/* Navigation */\}\
          <nav className="flex-1 p-4 space-y-2">\
            \{navItems.map((item) => (\
              <button\
                key=\{item.id\}\
                onClick=\{() => \{\
                  setCurrentView(item.id);\
                  onClose();\
                \}\}\
                className=\{`flex items-center gap-3 w-full px-3 py-2.5 text-left rounded-lg transition-colors duration-150 $\{\
                  currentView === item.id \
                    ? 'bg-[#3B0A69] text-white' \
                    : 'text-gray-700 hover:bg-gray-50 hover:text-[#3B0A69]'\
                \}`\}\
              >\
                <item.icon className="w-5 h-5" />\
                <span className="font-medium">\{item.label\}</span>\
              </button>\
            ))\}\
          </nav>\
          \
          \{/* User Profile */\}\
          <div className="p-4 border-t border-gray-200">\
            <div className="flex items-center gap-3 p-3 rounded-lg bg-gray-50">\
              <div className="w-10 h-10 bg-[#3B0A69] rounded-full flex items-center justify-center">\
                <span className="text-white font-semibold text-sm">\
                  \{user?.displayName?.charAt(0)?.toUpperCase() || user?.email?.charAt(0)?.toUpperCase()\}\
                </span>\
              </div>\
              <div className="flex-1 min-w-0">\
                <p className="text-sm font-medium text-gray-900 truncate">\{user?.displayName || user?.email\}</p>\
                <p className="text-xs text-gray-500 truncate">\{user?.email\}</p>\
              </div>\
              <button\
                onClick=\{logout\}\
                className="text-gray-400 hover:text-red-500 transition-colors"\
                title="Logout"\
              >\
                <LogOut className="w-4 h-4" />\
              </button>\
            </div>\
          </div>\
        </div>\
      </div>\
    </>\
  );\
\};\
\
const Header = (\{ onMenuClick, title = 'Dashboard', currentView \}) => \{\
  const \{ user \} = useAuth();\
  \
  const getPageTitle = (view) => \{\
    const titles = \{\
      dashboard: 'Dashboard',\
      clients: 'Client Management',\
      contractors: 'Contractor Management',\
      jobs: user?.role === 'admin' ? 'Job Management' : user?.role === 'contractor' ? 'Assigned Jobs' : 'My Jobs',\
      invoices: 'Invoices',\
      messages: 'Messages',\
      support: 'Support',\
      schedule: 'Schedule Management',\
      booking: 'Book Service',\
      profile: 'Profile',\
      settings: 'Settings',\
      analytics: 'Business Analytics',\
      files: 'File Management'\
    \};\
    return titles[view] || title;\
  \};\
  \
  return (\
    <header className="bg-white border-b border-gray-200 px-6 py-4">\
      <div className="flex items-center justify-between">\
        <div className="flex items-center gap-4">\
          <button\
            onClick=\{onMenuClick\}\
            className="lg:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors"\
          >\
            <Menu className="w-5 h-5 text-gray-600" />\
          </button>\
          <div>\
            <h1 className="text-2xl font-bold text-gray-900">\{getPageTitle(currentView)\}</h1>\
            <p className="text-sm text-gray-500">Welcome back, \{user?.displayName || user?.email\}</p>\
          </div>\
        </div>\
        \
        <div className="flex items-center gap-4">\
          <div className="relative">\
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />\
            <input\
              type="text"\
              placeholder="Search..."\
              className="pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            />\
          </div>\
          \
          <NotificationDropdown />\
        </div>\
      </div>\
    </header>\
  );\
\};\
\
// Dashboard Components\
const MetricCard = (\{ title, value, change, icon: Icon, color = 'blue' \}) => \{\
  const colors = \{\
    blue: 'text-blue-600 bg-blue-100',\
    green: 'text-green-600 bg-green-100',\
    purple: 'text-purple-600 bg-purple-100',\
    yellow: 'text-yellow-600 bg-yellow-100',\
    red: 'text-red-600 bg-red-100'\
  \};\
  \
  return (\
    <Card className="p-6">\
      <div className="flex items-center justify-between">\
        <div>\
          <p className="text-sm font-medium text-gray-600">\{title\}</p>\
          <p className="text-3xl font-bold text-gray-900 mt-2">\{value\}</p>\
          \{change && (\
            <div className="flex items-center mt-2 gap-1">\
              <TrendingUp className="w-4 h-4 text-green-500" />\
              <span className="text-sm text-green-600">\{change\}</span>\
              <span className="text-sm text-gray-500">vs last month</span>\
            </div>\
          )\}\
        </div>\
        <div className=\{`w-12 h-12 rounded-xl $\{colors[color]\} flex items-center justify-center`\}>\
          <Icon className="w-6 h-6" />\
        </div>\
      </div>\
    </Card>\
  );\
\};\
\
const JobCard = (\{ job, onStatusChange, userRole \}) => \{\
  const statusColors = \{\
    pending: 'warning',\
    'in-progress': 'info',\
    completed: 'success',\
    cancelled: 'danger'\
  \};\
  \
  const priorityColors = \{\
    low: 'success',\
    medium: 'warning',\
    high: 'danger'\
  \};\
  \
  return (\
    <Card className="p-6">\
      <div className="flex items-start justify-between mb-4">\
        <div>\
          <h3 className="font-semibold text-gray-900 mb-1">\{job.title\}</h3>\
          <p className="text-sm text-gray-600 mb-2">\{job.description\}</p>\
          <div className="flex items-center gap-2">\
            <Badge variant=\{statusColors[job.status]\}>\{job.status\}</Badge>\
            <Badge variant=\{priorityColors[job.priority]\}>\{job.priority\} priority</Badge>\
          </div>\
        </div>\
        <div className="flex items-center gap-2">\
          <Button variant="ghost" size="sm">\
            <Eye className="w-4 h-4" />\
          </Button>\
          \{userRole === 'admin' && (\
            <Button variant="ghost" size="sm">\
              <Edit className="w-4 h-4" />\
            </Button>\
          )\}\
        </div>\
      </div>\
      \
      <div className="flex items-center justify-between text-sm text-gray-500">\
        <div className="flex items-center gap-4">\
          <div className="flex items-center gap-1">\
            <User className="w-4 h-4" />\
            <span>\{job.client\}</span>\
          </div>\
          <div className="flex items-center gap-1">\
            <Calendar className="w-4 h-4" />\
            <span>\{new Date(job.dueDate).toLocaleDateString()\}</span>\
          </div>\
        </div>\
        <div className="flex items-center gap-1">\
          <DollarSign className="w-4 h-4" />\
          <span>$\{job.value?.toLocaleString()\}</span>\
        </div>\
      </div>\
    </Card>\
  );\
\};\
\
// Form Components\
const CreateJobModal = (\{ isOpen, onClose, onSubmit \}) => \{\
  const [formData, setFormData] = useState(\{\
    title: '',\
    description: '',\
    client: '',\
    clientEmail: '',\
    priority: 'medium',\
    dueDate: '',\
    value: '',\
    estimatedHours: ''\
  \});\
\
  const handleSubmit = (e) => \{\
    e.preventDefault();\
    onSubmit(formData);\
    setFormData(\{\
      title: '',\
      description: '',\
      client: '',\
      clientEmail: '',\
      priority: 'medium',\
      dueDate: '',\
      value: '',\
      estimatedHours: ''\
    \});\
    onClose();\
  \};\
\
  return (\
    <Modal isOpen=\{isOpen\} onClose=\{onClose\} title="Create New Job">\
      <form onSubmit=\{handleSubmit\} className="space-y-4">\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">\
            Job Title\
          </label>\
          <input\
            type="text"\
            value=\{formData.title\}\
            onChange=\{(e) => setFormData(\{...formData, title: e.target.value\})\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            required\
          />\
        </div>\
\
        <div>\
          <label className="block text-sm font-medium text-gray-700 mb-1">\
            Description\
          </label>\
          <textarea\
            value=\{formData.description\}\
            onChange=\{(e) => setFormData(\{...formData, description: e.target.value\})\}\
            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            rows=\{3\}\
            required\
          />\
        </div>\
\
        <div className="grid grid-cols-2 gap-4">\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Client Name\
            </label>\
            <input\
              type="text"\
              value=\{formData.client\}\
              onChange=\{(e) => setFormData(\{...formData, client: e.target.value\})\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              required\
            />\
          </div>\
\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Client Email\
            </label>\
            <input\
              type="email"\
              value=\{formData.clientEmail\}\
              onChange=\{(e) => setFormData(\{...formData, clientEmail: e.target.value\})\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              required\
            />\
          </div>\
        </div>\
\
        <div className="grid grid-cols-2 gap-4">\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Priority\
            </label>\
            <select\
              value=\{formData.priority\}\
              onChange=\{(e) => setFormData(\{...formData, priority: e.target.value\})\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
            >\
              <option value="low">Low</option>\
              <option value="medium">Medium</option>\
              <option value="high">High</option>\
            </select>\
          </div>\
\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Due Date\
            </label>\
            <input\
              type="date"\
              value=\{formData.dueDate\}\
              onChange=\{(e) => setFormData(\{...formData, dueDate: e.target.value\})\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              required\
            />\
          </div>\
        </div>\
\
        <div className="grid grid-cols-2 gap-4">\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Project Value ($)\
            </label>\
            <input\
              type="number"\
              value=\{formData.value\}\
              onChange=\{(e) => setFormData(\{...formData, value: e.target.value\})\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              required\
            />\
          </div>\
\
          <div>\
            <label className="block text-sm font-medium text-gray-700 mb-1">\
              Estimated Hours\
            </label>\
            <input\
              type="number"\
              value=\{formData.estimatedHours\}\
              onChange=\{(e) => setFormData(\{...formData, estimatedHours: e.target.value\})\}\
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
              required\
            />\
          </div>\
        </div>\
\
        <div className="flex gap-3 pt-4">\
          <Button type="submit" className="flex-1">\
            Create Job\
          </Button>\
          <Button type="button" variant="secondary" onClick=\{onClose\}>\
            Cancel\
          </Button>\
        </div>\
      </form>\
    </Modal>\
  );\
\};\
\
// Dashboard Views\
const AdminDashboard = () => \{\
  const [jobs, setJobs] = useState([]);\
  const [showCreateJob, setShowCreateJob] = useState(false);\
  const [loading, setLoading] = useState(true);\
\
  useEffect(() => \{\
    loadJobs();\
  \}, []);\
\
  const loadJobs = async () => \{\
    try \{\
      const jobsData = await firebase.getJobs();\
      setJobs(jobsData);\
    \} catch (error) \{\
      console.error('Error loading jobs:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  const handleCreateJob = async (jobData) => \{\
    try \{\
      await firebase.createJob(jobData);\
      loadJobs();\
    \} catch (error) \{\
      console.error('Error creating job:', error);\
    \}\
  \};\
\
  const metrics = [\
    \{ title: 'Active Jobs', value: jobs.filter(j => j.status !== 'completed').length.toString(), change: '+12%', icon: Briefcase, color: 'blue' \},\
    \{ title: 'Total Clients', value: '156', change: '+8%', icon: Users, color: 'green' \},\
    \{ title: 'Monthly Revenue', value: '$45,280', change: '+23%', icon: DollarSign, color: 'purple' \},\
    \{ title: 'Open Tickets', value: '8', change: '-15%', icon: AlertCircle, color: 'yellow' \}\
  ];\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading dashboard...</div>\
    </div>;\
  \}\
  \
  return (\
    <div className="space-y-8">\
      \{/* Metrics */\}\
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">\
        \{metrics.map((metric, index) => (\
          <MetricCard key=\{index\} \{...metric\} />\
        ))\}\
      </div>\
      \
      \{/* Quick Actions */\}\
      <Card className="p-6">\
        <div className="flex items-center justify-between mb-6">\
          <h2 className="text-lg font-semibold text-gray-900">Quick Actions</h2>\
        </div>\
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">\
          <Button \
            className="justify-start h-auto p-4"\
            onClick=\{() => setShowCreateJob(true)\}\
          >\
            <Plus className="w-5 h-5" />\
            <div className="text-left">\
              <div className="font-medium">Create Job</div>\
              <div className="text-sm opacity-75">Add new client project</div>\
            </div>\
          </Button>\
          <Button variant="secondary" className="justify-start h-auto p-4">\
            <Users className="w-5 h-5" />\
            <div className="text-left">\
              <div className="font-medium">Add Client</div>\
              <div className="text-sm opacity-75">Register new customer</div>\
            </div>\
          </Button>\
          <Button variant="ghost" className="justify-start h-auto p-4 border border-gray-200">\
            <FileText className="w-5 h-5" />\
            <div className="text-left">\
              <div className="font-medium">Generate Invoice</div>\
              <div className="text-sm opacity-75">Create billing document</div>\
            </div>\
          </Button>\
        </div>\
      </Card>\
      \
      \{/* Recent Jobs */\}\
      <div>\
        <div className="flex items-center justify-between mb-6">\
          <h2 className="text-lg font-semibold text-gray-900">Recent Jobs</h2>\
          <Button variant="ghost" size="sm">\
            View All <ArrowRight className="w-4 h-4" />\
          </Button>\
        </div>\
        <div className="space-y-4">\
          \{jobs.slice(0, 3).map((job) => (\
            <JobCard key=\{job.id\} job=\{job\} userRole="admin" />\
          ))\}\
        </div>\
      </div>\
\
      <CreateJobModal \
        isOpen=\{showCreateJob\}\
        onClose=\{() => setShowCreateJob(false)\}\
        onSubmit=\{handleCreateJob\}\
      />\
    </div>\
  );\
\};\
\
const ClientDashboard = () => \{\
  const \{ user \} = useAuth();\
  const [jobs, setJobs] = useState([]);\
  const [invoices, setInvoices] = useState([]);\
  const [loading, setLoading] = useState(true);\
\
  useEffect(() => \{\
    loadClientData();\
  \}, [user]);\
\
  const loadClientData = async () => \{\
    try \{\
      const [jobsData, invoicesData] = await Promise.all([\
        firebase.getJobs(),\
        firebase.getInvoices()\
      ]);\
\
      // Filter data for current client\
      const clientJobs = jobsData.filter(job => job.clientEmail === user?.email);\
      const clientInvoices = invoicesData.filter(invoice => invoice.clientEmail === user?.email);\
\
      setJobs(clientJobs);\
      setInvoices(clientInvoices);\
    \} catch (error) \{\
      console.error('Error loading client data:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  const clientMetrics = [\
    \{ title: 'Active Projects', value: jobs.filter(j => j.status !== 'completed').length.toString(), icon: Briefcase, color: 'blue' \},\
    \{ title: 'Completed Jobs', value: jobs.filter(j => j.status === 'completed').length.toString(), icon: CheckCircle, color: 'green' \},\
    \{ title: 'Open Tickets', value: '1', icon: AlertCircle, color: 'yellow' \},\
    \{ title: 'Total Spent', value: `$\{invoices.reduce((sum, inv) => sum + inv.amount, 0).toLocaleString()\}`, icon: DollarSign, color: 'purple' \}\
  ];\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading dashboard...</div>\
    </div>;\
  \}\
  \
  return (\
    <div className="space-y-8">\
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">\
        \{clientMetrics.map((metric, index) => (\
          <MetricCard key=\{index\} \{...metric\} />\
        ))\}\
      </div>\
      \
      <Card className="p-6">\
        <h2 className="text-lg font-semibold text-gray-900 mb-4">Request New Service</h2>\
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">\
          <Button className="justify-start h-auto p-4">\
            <Plus className="w-5 h-5" />\
            <div className="text-left">\
              <div className="font-medium">New Project</div>\
              <div className="text-sm opacity-75">Start a new IT project</div>\
            </div>\
          </Button>\
          <Button variant="secondary" className="justify-start h-auto p-4">\
            <MessageSquare className="w-5 h-5" />\
            <div className="text-left">\
              <div className="font-medium">Support Ticket</div>\
              <div className="text-sm opacity-75">Get help with existing services</div>\
            </div>\
          </Button>\
        </div>\
      </Card>\
\
      \{jobs.length > 0 && (\
        <div>\
          <h2 className="text-lg font-semibold text-gray-900 mb-4">Your Projects</h2>\
          <div className="space-y-4">\
            \{jobs.map((job) => (\
              <JobCard key=\{job.id\} job=\{job\} userRole="client" />\
            ))\}\
          </div>\
        </div>\
      )\}\
    </div>\
  );\
\};\
\
const ContractorDashboard = () => \{\
  const \{ user \} = useAuth();\
  const [jobs, setJobs] = useState([]);\
  const [loading, setLoading] = useState(true);\
\
  useEffect(() => \{\
    loadContractorData();\
  \}, [user]);\
\
  const loadContractorData = async () => \{\
    try \{\
      const jobsData = await firebase.getJobs();\
      // Filter jobs assigned to current contractor\
      const contractorJobs = jobsData.filter(job => job.contractorEmail === user?.email);\
      setJobs(contractorJobs);\
    \} catch (error) \{\
      console.error('Error loading contractor data:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  const contractorMetrics = [\
    \{ title: 'Assigned Jobs', value: jobs.filter(j => j.status !== 'completed').length.toString(), icon: Briefcase, color: 'blue' \},\
    \{ title: 'Completed This Month', value: jobs.filter(j => j.status === 'completed').length.toString(), icon: CheckCircle, color: 'green' \},\
    \{ title: 'Hours Logged', value: '124', icon: Clock, color: 'purple' \},\
    \{ title: 'Earnings', value: '$8,450', icon: DollarSign, color: 'yellow' \}\
  ];\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading dashboard...</div>\
    </div>;\
  \}\
  \
  return (\
    <div className="space-y-8">\
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">\
        \{contractorMetrics.map((metric, index) => (\
          <MetricCard key=\{index\} \{...metric\} />\
        ))\}\
      </div>\
      \
      <Card className="p-6">\
        <h2 className="text-lg font-semibold text-gray-900 mb-4">Today's Schedule</h2>\
        <div className="space-y-3">\
          \{[\
            \{ time: '09:00 AM', task: 'Network Setup - Acme Corp', location: 'Downtown Office' \},\
            \{ time: '02:00 PM', task: 'Server Maintenance - Tech Solutions', location: 'Remote' \},\
            \{ time: '04:30 PM', task: 'Security Review - Finance Pro', location: 'Midtown' \}\
          ].map((item, index) => (\
            <div key=\{index\} className="flex items-center gap-4 p-3 bg-gray-50 rounded-lg">\
              <div className="text-sm font-medium text-[#3B0A69] min-w-[80px]">\{item.time\}</div>\
              <div className="flex-1">\
                <div className="font-medium text-gray-900">\{item.task\}</div>\
                <div className="text-sm text-gray-500 flex items-center gap-1">\
                  <MapPin className="w-3 h-3" />\
                  \{item.location\}\
                </div>\
              </div>\
            </div>\
          ))\}\
        </div>\
      </Card>\
\
      \{jobs.length > 0 && (\
        <div>\
          <h2 className="text-lg font-semibold text-gray-900 mb-4">Your Assigned Jobs</h2>\
          <div className="space-y-4">\
            \{jobs.map((job) => (\
              <JobCard key=\{job.id\} job=\{job\} userRole="contractor" />\
            ))\}\
          </div>\
        </div>\
      )\}\
    </div>\
  );\
\};\
\
// Additional Views\
const JobsView = () => \{\
  const \{ user \} = useAuth();\
  const [jobs, setJobs] = useState([]);\
  const [loading, setLoading] = useState(true);\
  const [showCreateJob, setShowCreateJob] = useState(false);\
\
  useEffect(() => \{\
    loadJobs();\
  \}, [user]);\
\
  const loadJobs = async () => \{\
    try \{\
      const jobsData = await firebase.getJobs();\
      \
      // Filter based on user role\
      let filteredJobs = jobsData;\
      if (user?.role === 'client') \{\
        filteredJobs = jobsData.filter(job => job.clientEmail === user?.email);\
      \} else if (user?.role === 'contractor') \{\
        filteredJobs = jobsData.filter(job => job.contractorEmail === user?.email);\
      \}\
      \
      setJobs(filteredJobs);\
    \} catch (error) \{\
      console.error('Error loading jobs:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  const handleCreateJob = async (jobData) => \{\
    try \{\
      await firebase.createJob(jobData);\
      loadJobs();\
    \} catch (error) \{\
      console.error('Error creating job:', error);\
    \}\
  \};\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading jobs...</div>\
    </div>;\
  \}\
\
  return (\
    <div className="space-y-6">\
      \{user?.role === 'admin' && (\
        <div className="flex justify-between items-center">\
          <div>\
            <h2 className="text-2xl font-bold text-gray-900">Job Management</h2>\
            <p className="text-gray-600">Manage all client projects and assignments</p>\
          </div>\
          <Button onClick=\{() => setShowCreateJob(true)\}>\
            <Plus className="w-4 h-4" />\
            Create Job\
          </Button>\
        </div>\
      )\}\
\
      <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">\
        \{jobs.map((job) => (\
          <JobCard key=\{job.id\} job=\{job\} userRole=\{user?.role\} />\
        ))\}\
      </div>\
\
      \{jobs.length === 0 && (\
        <Card className="p-12 text-center">\
          <Briefcase className="w-12 h-12 text-gray-400 mx-auto mb-4" />\
          <h3 className="text-lg font-medium text-gray-900 mb-2">No jobs found</h3>\
          <p className="text-gray-600 mb-4">\
            \{user?.role === 'admin' \
              ? 'Create your first job to get started' \
              : 'No jobs assigned to you yet'\}\
          </p>\
          \{user?.role === 'admin' && (\
            <Button onClick=\{() => setShowCreateJob(true)\}>\
              <Plus className="w-4 h-4" />\
              Create First Job\
            </Button>\
          )\}\
        </Card>\
      )\}\
\
      \{user?.role === 'admin' && (\
        <CreateJobModal \
          isOpen=\{showCreateJob\}\
          onClose=\{() => setShowCreateJob(false)\}\
          onSubmit=\{handleCreateJob\}\
        />\
      )\}\
    </div>\
  );\
\};\
\
const ClientsView = () => \{\
  const [clients, setClients] = useState([]);\
  const [loading, setLoading] = useState(true);\
\
  useEffect(() => \{\
    loadClients();\
  \}, []);\
\
  const loadClients = async () => \{\
    try \{\
      const clientsData = await firebase.getClients();\
      setClients(clientsData);\
    \} catch (error) \{\
      console.error('Error loading clients:', error);\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
\
  if (loading) \{\
    return <div className="flex items-center justify-center h-64">\
      <div className="text-lg text-gray-600">Loading clients...</div>\
    </div>;\
  \}\
\
  return (\
    <div className="space-y-6">\
      <div className="flex justify-between items-center">\
        <div>\
          <h2 className="text-2xl font-bold text-gray-900">Client Management</h2>\
          <p className="text-gray-600">Manage your client relationships and accounts</p>\
        </div>\
        <Button>\
          <Plus className="w-4 h-4" />\
          Add Client\
        </Button>\
      </div>\
\
      <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">\
        \{clients.map((client) => (\
          <Card key=\{client.id\} className="p-6">\
            <div className="flex items-start justify-between mb-4">\
              <div>\
                <h3 className="font-semibold text-gray-900 mb-1">\{client.name\}</h3>\
                <p className="text-sm text-gray-600 mb-2">\{client.email\}</p>\
                <p className="text-sm text-gray-500">\{client.phone\}</p>\
              </div>\
              <div className="flex items-center gap-2">\
                <Button variant="ghost" size="sm">\
                  <Eye className="w-4 h-4" />\
                </Button>\
                <Button variant="ghost" size="sm">\
                  <Edit className="w-4 h-4" />\
                </Button>\
              </div>\
            </div>\
            \
            <div className="space-y-2 text-sm">\
              <div className="flex justify-between">\
                <span className="text-gray-600">Total Jobs:</span>\
                <span className="font-medium">\{client.totalJobs\}</span>\
              </div>\
              <div className="flex justify-between">\
                <span className="text-gray-600">Active Jobs:</span>\
                <span className="font-medium">\{client.activeJobs\}</span>\
              </div>\
              <div className="flex justify-between">\
                <span className="text-gray-600">Total Spent:</span>\
                <span className="font-medium">$\{client.totalSpent?.toLocaleString()\}</span>\
              </div>\
            </div>\
          </Card>\
        ))\}\
      </div>\
    </div>\
  );\
\};\
\
// Login Components\
const LoginForm = () => \{\
  const [email, setEmail] = useState('');\
  const [password, setPassword] = useState('');\
  const [isLogin, setIsLogin] = useState(true);\
  const [role, setRole] = useState('client');\
  const [loading, setLoading] = useState(false);\
  const [error, setError] = useState('');\
  const \{ login, register \} = useAuth();\
  \
  const handleSubmit = async (e) => \{\
    e.preventDefault();\
    setLoading(true);\
    setError('');\
    \
    try \{\
      if (isLogin) \{\
        await login(email, password);\
      \} else \{\
        await register(email, password, role);\
      \}\
    \} catch (error) \{\
      setError(error.message || 'Authentication failed');\
    \} finally \{\
      setLoading(false);\
    \}\
  \};\
  \
  return (\
    <div className="min-h-screen bg-gradient-to-br from-[#3B0A69] via-purple-700 to-purple-900 flex items-center justify-center p-4">\
      <div className="max-w-md w-full">\
        <Card className="p-8">\
          <div className="text-center mb-8">\
            <div className="w-16 h-16 bg-gradient-to-br from-[#3B0A69] to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4">\
              <Zap className="w-8 h-8 text-white" />\
            </div>\
            <h1 className="text-2xl font-bold text-gray-900">Welcome to Tech Ephi</h1>\
            <p className="text-gray-600 mt-2">\
              \{isLogin ? 'Sign in to your account' : 'Create your account'\}\
            </p>\
          </div>\
          \
          \{error && (\
            <div className="mb-4 p-3 bg-red-100 border border-red-300 rounded-lg text-red-700 text-sm">\
              \{error\}\
            </div>\
          )\}\
          \
          <form onSubmit=\{handleSubmit\} className="space-y-6">\
            \{!isLogin && (\
              <div>\
                <label className="block text-sm font-medium text-gray-700 mb-2">\
                  Account Type\
                </label>\
                <select\
                  value=\{role\}\
                  onChange=\{(e) => setRole(e.target.value)\}\
                  className="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
                >\
                  <option value="client">Client</option>\
                  <option value="contractor">Contractor</option>\
                  <option value="admin">Administrator</option>\
                </select>\
              </div>\
            )\}\
            \
            <div>\
              <label className="block text-sm font-medium text-gray-700 mb-2">\
                Email Address\
              </label>\
              <input\
                type="email"\
                value=\{email\}\
                onChange=\{(e) => setEmail(e.target.value)\}\
                className="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
                placeholder="Enter your email"\
                required\
              />\
            </div>\
            \
            <div>\
              <label className="block text-sm font-medium text-gray-700 mb-2">\
                Password\
              </label>\
              <input\
                type="password"\
                value=\{password\}\
                onChange=\{(e) => setPassword(e.target.value)\}\
                className="w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
                placeholder="Enter your password"\
                required\
              />\
            </div>\
            \
            <Button type="submit" className="w-full" loading=\{loading\}>\
              \{isLogin ? 'Sign In' : 'Create Account'\}\
            </Button>\
          </form>\
          \
          <div className="mt-6 pt-6 border-t border-gray-200 text-center">\
            <button\
              type="button"\
              onClick=\{() => setIsLogin(!isLogin)\}\
              className="text-sm text-[#3B0A69] hover:text-purple-700 font-medium"\
            >\
              \{isLogin ? "Don't have an account? Sign up" : "Already have an account? Sign in"\}\
            </button>\
          </div>\
\
          <div className="mt-4 pt-4 border-t border-gray-200">\
            <p className="text-center text-xs text-gray-500 mb-2">Demo Accounts:</p>\
            <div className="space-y-1 text-xs text-gray-600">\
              <div>Admin: admin@techephi.com</div>\
              <div>Client: client@acme.com</div>\
              <div>Contractor: john@techephi.com</div>\
            </div>\
          </div>\
        </Card>\
      </div>\
    </div>\
  );\
\};\
\
// Public Website Component\
const PublicWebsite = () => \{\
  const \{ login \} = useAuth();\
  \
  return (\
    <div className="min-h-screen bg-[#F9FAFB]">\
      \{/* Navigation */\}\
      <nav className="bg-white border-b border-gray-200">\
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">\
          <div className="flex justify-between items-center h-16">\
            <div className="flex items-center gap-3">\
              <div className="w-8 h-8 bg-gradient-to-br from-[#3B0A69] to-purple-600 rounded-lg flex items-center justify-center">\
                <Zap className="w-5 h-5 text-white" />\
              </div>\
              <span className="text-xl font-bold text-gray-900">Tech Ephi</span>\
            </div>\
            <Button onClick=\{() => login('client@acme.com', 'password')\}>\
              Client Portal\
            </Button>\
          </div>\
        </div>\
      </nav>\
      \
      \{/* Hero Section */\}\
      <section className="py-20 bg-gradient-to-br from-[#3B0A69] via-purple-700 to-purple-900 text-white">\
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">\
          <h1 className="text-4xl md:text-6xl font-bold mb-6">\
            Professional IT Solutions for\
            <span className="text-[#FFD700]"> Modern Businesses</span>\
          </h1>\
          <p className="text-xl md:text-2xl mb-8 text-purple-100 max-w-3xl mx-auto">\
            Comprehensive technology services, expert support, and innovative solutions \
            to power your business forward.\
          </p>\
          <div className="flex flex-col sm:flex-row gap-4 justify-center">\
            <Button \
              variant="secondary" \
              size="lg"\
              onClick=\{() => login('client@acme.com', 'password')\}\
            >\
              Get Started <ArrowRight className="w-5 h-5" />\
            </Button>\
            <Button variant="ghost" size="lg" className="text-white border-white hover:bg-white hover:text-[#3B0A69]">\
              Learn More\
            </Button>\
          </div>\
        </div>\
      </section>\
      \
      \{/* Services */\}\
      <section className="py-20">\
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">\
          <div className="text-center mb-16">\
            <h2 className="text-3xl md:text-4xl font-bold text-gray-900 mb-4">\
              Our Services\
            </h2>\
            <p className="text-xl text-gray-600 max-w-2xl mx-auto">\
              From network infrastructure to cybersecurity, we provide comprehensive IT solutions tailored to your business needs.\
            </p>\
          </div>\
          \
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">\
            \{[\
              \{\
                icon: Shield,\
                title: 'Cybersecurity',\
                description: 'Protect your business with advanced security solutions and monitoring.'\
              \},\
              \{\
                icon: Globe,\
                title: 'Network Solutions',\
                description: 'Design and implement robust network infrastructure for optimal performance.'\
              \},\
              \{\
                icon: Activity,\
                title: 'IT Support',\
                description: '24/7 technical support to keep your systems running smoothly.'\
              \},\
              \{\
                icon: Zap,\
                title: 'Cloud Services',\
                description: 'Migrate and manage your cloud infrastructure with expert guidance.'\
              \},\
              \{\
                icon: Settings,\
                title: 'System Integration',\
                description: 'Seamlessly integrate new technology with your existing systems.'\
              \},\
              \{\
                icon: Users,\
                title: 'Consulting',\
                description: 'Strategic IT consulting to align technology with your business goals.'\
              \}\
            ].map((service, index) => (\
              <Card key=\{index\} className="p-6 text-center">\
                <div className="w-12 h-12 bg-[#3B0A69] rounded-xl flex items-center justify-center mx-auto mb-4">\
                  <service.icon className="w-6 h-6 text-white" />\
                </div>\
                <h3 className="text-xl font-semibold text-gray-900 mb-3">\{service.title\}</h3>\
                <p className="text-gray-600">\{service.description\}</p>\
              </Card>\
            ))\}\
          </div>\
        </div>\
      </section>\
      \
      \{/* Contact */\}\
      <section className="py-20 bg-white">\
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">\
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">\
            <div>\
              <h2 className="text-3xl md:text-4xl font-bold text-gray-900 mb-6">\
                Ready to Transform Your IT Infrastructure?\
              </h2>\
              <p className="text-xl text-gray-600 mb-8">\
                Contact us today for a free consultation and discover how we can help your business thrive.\
              </p>\
              \
              <div className="space-y-4">\
                <div className="flex items-center gap-3">\
                  <div className="w-10 h-10 bg-[#3B0A69] rounded-lg flex items-center justify-center">\
                    <Phone className="w-5 h-5 text-white" />\
                  </div>\
                  <div>\
                    <p className="font-semibold text-gray-900">+1 (555) 123-4567</p>\
                    <p className="text-gray-600">Call us anytime</p>\
                  </div>\
                </div>\
                \
                <div className="flex items-center gap-3">\
                  <div className="w-10 h-10 bg-[#3B0A69] rounded-lg flex items-center justify-center">\
                    <Mail className="w-5 h-5 text-white" />\
                  </div>\
                  <div>\
                    <p className="font-semibold text-gray-900">info@techephi.com</p>\
                    <p className="text-gray-600">Email us your questions</p>\
                  </div>\
                </div>\
                \
                <div className="flex items-center gap-3">\
                  <div className="w-10 h-10 bg-[#3B0A69] rounded-lg flex items-center justify-center">\
                    <MapPin className="w-5 h-5 text-white" />\
                  </div>\
                  <div>\
                    <p className="font-semibold text-gray-900">Severn, Maryland</p>\
                    <p className="text-gray-600">Serving the DMV area</p>\
                  </div>\
                </div>\
              </div>\
            </div>\
            \
            <div className="bg-gray-50 rounded-2xl p-8">\
              <h3 className="text-2xl font-bold text-gray-900 mb-6">Get a Free Quote</h3>\
              <form className="space-y-4">\
                <div>\
                  <input\
                    type="text"\
                    placeholder="Your Name"\
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
                  />\
                </div>\
                <div>\
                  <input\
                    type="email"\
                    placeholder="Email Address"\
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
                  />\
                </div>\
                <div>\
                  <select className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent">\
                    <option>Select Service</option>\
                    <option>Cybersecurity</option>\
                    <option>Network Solutions</option>\
                    <option>IT Support</option>\
                    <option>Cloud Services</option>\
                    <option>System Integration</option>\
                    <option>Consulting</option>\
                  </select>\
                </div>\
                <div>\
                  <textarea\
                    placeholder="Tell us about your project..."\
                    rows=\{4\}\
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B0A69] focus:border-transparent"\
                  ></textarea>\
                </div>\
                <Button className="w-full">\
                  Send Message <Send className="w-4 h-4" />\
                </Button>\
              </form>\
            </div>\
          </div>\
        </div>\
      </section>\
      \
      \{/* Footer */\}\
      <footer className="bg-gray-900 text-white py-12">\
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">\
          <div className="grid grid-cols-1 md:grid-cols-4 gap-8">\
            <div className="col-span-1 md:col-span-2">\
              <div className="flex items-center gap-3 mb-4">\
                <div className="w-8 h-8 bg-gradient-to-br from-[#3B0A69] to-purple-600 rounded-lg flex items-center justify-center">\
                  <Zap className="w-5 h-5 text-white" />\
                </div>\
                <span className="text-xl font-bold">Tech Ephi</span>\
              </div>\
              <p className="text-gray-400 mb-4">\
                Professional IT solutions for modern businesses. We help companies leverage technology to achieve their goals.\
              </p>\
              <div className="flex items-center gap-4">\
                <Button variant="ghost" size="sm" className="text-white border-gray-600 hover:bg-gray-800">\
                  <Star className="w-4 h-4" />\
                  Reviews\
                </Button>\
              </div>\
            </div>\
            \
            <div>\
              <h4 className="font-semibold mb-4">Services</h4>\
              <ul className="space-y-2 text-gray-400">\
                <li>Cybersecurity</li>\
                <li>Network Solutions</li>\
                <li>IT Support</li>\
                <li>Cloud Services</li>\
              </ul>\
            </div>\
            \
            <div>\
              <h4 className="font-semibold mb-4">Company</h4>\
              <ul className="space-y-2 text-gray-400">\
                <li>About Us</li>\
                <li>Careers</li>\
                <li>Contact</li>\
                <li>Privacy Policy</li>\
              </ul>\
            </div>\
          </div>\
          \
          <div className="border-t border-gray-800 mt-12 pt-8 text-center text-gray-400">\
            <p>&copy; 2025 Tech Ephi. All rights reserved.</p>\
          </div>\
        </div>\
      </footer>\
    </div>\
  );\
\};\
\
// Main App Component\
const App = () => \{\
  const \{ user, loading \} = useAuth();\
  const [sidebarOpen, setSidebarOpen] = useState(false);\
  const [currentView, setCurrentView] = useState('dashboard');\
  \
  if (loading) \{\
    return (\
      <div className="min-h-screen bg-[#F9FAFB] flex items-center justify-center">\
        <div className="text-center">\
          <div className="w-16 h-16 bg-gradient-to-br from-[#3B0A69] to-purple-600 rounded-2xl flex items-center justify-center mx-auto mb-4">\
            <Zap className="w-8 h-8 text-white" />\
          </div>\
          <div className="text-xl font-semibold text-gray-900">Loading...</div>\
        </div>\
      </div>\
    );\
  \}\
  \
  if (!user) \{\
    return <LoginForm />;\
  \}\
  \
  const renderView = () => \{\
    switch (currentView) \{\
      case 'dashboard':\
        switch (user.role) \{\
          case 'admin':\
            return <AdminDashboard />;\
          case 'contractor':\
            return <ContractorDashboard />;\
          default:\
            return <ClientDashboard />;\
        \}\
      case 'analytics':\
        return user.role === 'admin' ? <AnalyticsView /> : <ClientDashboard />;\
      case 'jobs':\
        return <EnhancedJobsView />;\
      case 'clients':\
        return user.role === 'admin' ? <ClientsView /> : <ClientDashboard />;\
      case 'contractors':\
        return user.role === 'admin' ? <div>Contractor Management Coming Soon</div> : <ContractorDashboard />;\
      case 'invoices':\
        return <InvoicesView />;\
      case 'messages':\
        return <MessagesView />;\
      case 'support':\
        return <MessagesView />;\
      case 'files':\
        return <FileManagementView />;\
      case 'schedule':\
        return user?.role === 'client' ? <ClientBookingView /> : <ScheduleViewEnhanced />;\
      case 'booking':\
        return <ClientBookingView />;\
      case 'profile':\
        return user?.role === 'client' ? <NotificationPreferencesView /> : <NotificationPreferencesView />;\
      case 'settings':\
        return user?.role === 'admin' ? <div className="space-y-8">\
          <NotificationPreferencesView />\
          <NotificationAnalyticsView />\
          <NotificationTestCenter />\
        </div> : <NotificationPreferencesView />;\
      default:\
        return <AdminDashboard />;\
    \}\
  \};\
  \
  return (\
    <div className="min-h-screen bg-[#F9FAFB] flex">\
      <Sidebar \
        isOpen=\{sidebarOpen\} \
        onClose=\{() => setSidebarOpen(false)\}\
        currentView=\{currentView\}\
        setCurrentView=\{setCurrentView\}\
      />\
      \
      <div className="flex-1 lg:ml-64">\
        <Header \
          onMenuClick=\{() => setSidebarOpen(true)\} \
          currentView=\{currentView\}\
        />\
        \
        <main className="p-6">\
          \{renderView()\}\
        </main>\
      </div>\
    </div>\
  );\
\};\
\
// Root Component with Enhanced Error Handling and Providers\
export default function TechEphiCRM() \{\
  return (\
    <ErrorBoundary name="App">\
      <ToastProvider>\
        <AuthProvider>\
          <NotificationProvider>\
            <ErrorBoundary name="Main">\
              <App />\
            </ErrorBoundary>\
          </NotificationProvider>\
        </AuthProvider>\
      </ToastProvider>\
    </ErrorBoundary>\
  );\
\}}